var ri=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var H=(t,e,n)=>(ri(t,e,"read from private field"),n?n.call(t):e.get(t)),tt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},de=(t,e,n,r)=>(ri(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);var Fn=(t,e,n)=>(ri(t,e,"access private method"),n);function qo(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function $(){}function ht(t,e){for(const n in e)t[n]=e[n];return t}function jo(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function la(t){return t()}function ds(){return Object.create(null)}function ot(t){t.forEach(la)}function wr(t){return typeof t=="function"}function re(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let vr;function ft(t,e){return vr||(vr=document.createElement("a")),vr.href=e,t===vr.href}function Wo(t){return Object.keys(t).length===0}function ca(t,...e){if(t==null)return $;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Ze(t,e,n){t.$$.on_destroy.push(ca(e,n))}function we(t,e,n,r){if(t){const i=ha(t,e,n,r);return t[0](i)}}function ha(t,e,n,r){return t[1]&&r?ht(n.ctx.slice(),t[1](r(e))):n.ctx}function be(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const s=[],u=Math.max(e.dirty.length,i.length);for(let a=0;a<u;a+=1)s[a]=e.dirty[a]|i[a];return s}return e.dirty|i}return e.dirty}function ye(t,e,n,r,i,s){if(i){const u=ha(e,n,r,s);t.p(u,i)}}function Ae(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function Fi(t){const e={};for(const n in t)n[0]!=="$"&&(e[n]=t[n]);return e}function ps(t,e){const n={};e=new Set(e);for(const r in t)!e.has(r)&&r[0]!=="$"&&(n[r]=t[r]);return n}function Vo(t){return t&&wr(t.destroy)?t.destroy:$}function v(t,e){t.appendChild(e)}function b(t,e,n){t.insertBefore(e,n||null)}function w(t){t.parentNode&&t.parentNode.removeChild(t)}function Un(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function E(t){return document.createElement(t)}function Qo(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function j(t){return document.createTextNode(t)}function U(){return j(" ")}function ae(){return j("")}function oe(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function B(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Ko(t){return Array.from(t.childNodes)}function ve(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function Pr(t,e){t.value=e??""}function fa(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Ds(t,e,n){t.classList[n?"add":"remove"](e)}function Go(t,e,{bubbles:n=!1,cancelable:r=!1}={}){const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,n,r,e),i}class Zo{constructor(e=!1){this.is_svg=!1,this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,n,r=null){this.e||(this.is_svg?this.e=Qo(n.nodeName):this.e=E(n.nodeName),this.t=n,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.childNodes)}i(e){for(let n=0;n<this.n.length;n+=1)b(this.t,this.n[n],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(w)}}function _e(t,e){return new t(e)}let cr;function Ht(t){cr=t}function br(){if(!cr)throw new Error("Function called outside component initialization");return cr}function yr(t){br().$$.on_mount.push(t)}function zn(){const t=br();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const s=Go(e,n,{cancelable:r});return i.slice().forEach(u=>{u.call(t,s)}),!s.defaultPrevented}return!0}}function Xo(t,e){return br().$$.context.set(t,e),e}function Yo(t){return br().$$.context.get(t)}function Mr(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Tn=[],Or=[],Ir=[],ms=[],Jo=Promise.resolve();let ki=!1;function el(){ki||(ki=!0,Jo.then(Wi))}function vi(t){Ir.push(t)}const ii=new Set;let kn=0;function Wi(){if(kn!==0)return;const t=cr;do{try{for(;kn<Tn.length;){const e=Tn[kn];kn++,Ht(e),tl(e.$$)}}catch(e){throw Tn.length=0,kn=0,e}for(Ht(null),Tn.length=0,kn=0;Or.length;)Or.pop()();for(let e=0;e<Ir.length;e+=1){const n=Ir[e];ii.has(n)||(ii.add(n),n())}Ir.length=0}while(Tn.length);for(;ms.length;)ms.pop()();ki=!1,ii.clear(),Ht(t)}function tl(t){if(t.fragment!==null){t.update(),ot(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(vi)}}const Tr=new Set;let fn;function ee(){fn={r:0,c:[],p:fn}}function te(){fn.r||ot(fn.c),fn=fn.p}function y(t,e){t&&t.i&&(Tr.delete(t),t.i(e))}function C(t,e,n,r){if(t&&t.o){if(Tr.has(t))return;Tr.add(t),fn.c.push(()=>{Tr.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function mn(t,e){const n=e.token={};function r(i,s,u,a){if(e.token!==n)return;e.resolved=a;let o=e.ctx;u!==void 0&&(o=o.slice(),o[u]=a);const l=i&&(e.current=i)(o);let c=!1;e.block&&(e.blocks?e.blocks.forEach((h,f)=>{f!==s&&h&&(ee(),C(h,1,1,()=>{e.blocks[f]===h&&(e.blocks[f]=null)}),te())}):e.block.d(1),l.c(),y(l,1),l.m(e.mount(),e.anchor),c=!0),e.block=l,e.blocks&&(e.blocks[s]=l),c&&Wi()}if(jo(t)){const i=br();if(t.then(s=>{Ht(i),r(e.then,1,e.value,s),Ht(null)},s=>{if(Ht(i),r(e.catch,2,e.error,s),Ht(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Qr(t,e,n){const r=e.slice(),{resolved:i}=t;t.current===t.then&&(r[t.value]=i),t.current===t.catch&&(r[t.error]=i),t.block.p(r,n)}function Vi(t,e){C(t,1,1,()=>{e.delete(t.key)})}function Qi(t,e,n,r,i,s,u,a,o,l,c,h){let f=t.length,d=s.length,p=f;const D={};for(;p--;)D[t[p].key]=p;const m=[],A=new Map,F=new Map;for(p=d;p--;){const k=h(i,s,p),x=n(k);let R=u.get(x);R?r&&R.p(k,e):(R=l(x,k),R.c()),A.set(x,m[p]=R),x in D&&F.set(x,Math.abs(p-D[x]))}const _=new Set,g=new Set;function S(k){y(k,1),k.m(a,c),u.set(k.key,k),c=k.first,d--}for(;f&&d;){const k=m[d-1],x=t[f-1],R=k.key,z=x.key;k===x?(c=k.first,f--,d--):A.has(z)?!u.has(R)||_.has(R)?S(k):g.has(z)?f--:F.get(R)>F.get(z)?(g.add(R),S(k)):(_.add(z),f--):(o(x,u),f--)}for(;f--;){const k=t[f];A.has(k.key)||o(k,u)}for(;d;)S(m[d-1]);return m}function wn(t,e){const n={},r={},i={$$scope:1};let s=t.length;for(;s--;){const u=t[s],a=e[s];if(a){for(const o in u)o in a||(r[o]=1);for(const o in a)i[o]||(n[o]=a[o],i[o]=1);t[s]=a}else for(const o in u)i[o]=1}for(const u in r)u in n||(n[u]=void 0);return n}function bn(t){return typeof t=="object"&&t!==null?t:{}}function X(t){t&&t.c()}function W(t,e,n,r){const{fragment:i,after_update:s}=t.$$;i&&i.m(e,n),r||vi(()=>{const u=t.$$.on_mount.map(la).filter(wr);t.$$.on_destroy?t.$$.on_destroy.push(...u):ot(u),t.$$.on_mount=[]}),s.forEach(vi)}function V(t,e){const n=t.$$;n.fragment!==null&&(ot(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function nl(t,e){t.$$.dirty[0]===-1&&(Tn.push(t),el(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function se(t,e,n,r,i,s,u,a=[-1]){const o=cr;Ht(t);const l=t.$$={fragment:null,ctx:[],props:s,update:$,not_equal:i,bound:ds(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(o?o.$$.context:[])),callbacks:ds(),dirty:a,skip_bound:!1,root:e.target||o.$$.root};u&&u(l.root);let c=!1;if(l.ctx=n?n(t,e.props||{},(h,f,...d)=>{const p=d.length?d[0]:f;return l.ctx&&i(l.ctx[h],l.ctx[h]=p)&&(!l.skip_bound&&l.bound[h]&&l.bound[h](p),c&&nl(t,h)),f}):[],l.update(),c=!0,ot(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const h=Ko(e.target);l.fragment&&l.fragment.l(h),h.forEach(w)}else l.fragment&&l.fragment.c();e.intro&&y(t.$$.fragment),W(t,e.target,e.anchor,e.customElement),Wi()}Ht(o)}class ue{$destroy(){V(this,1),this.$destroy=$}$on(e,n){if(!wr(n))return $;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Wo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var rl=Object.defineProperty,Ki=(t,e)=>{for(var n in e)rl(t,n,{get:e[n],enumerable:!0})},Xe=class extends Error{constructor(e){super(e||""),this.name="EarthstarError"}},M=class extends Xe{constructor(e){super(e||"Validation error"),this.name="ValidationError"}},Ce=class extends Xe{constructor(e){super(e||"a Replica or ReplicaDriver was used after being closed"),this.name="ReplicaIsClosedError"}},sn=class extends Xe{constructor(t){super(t||"a ReplicaCache was used after being closed"),this.name="ReplicaCacheIsClosedError"}},nr=class extends Xe{constructor(t){super(t||"Not supported"),this.name="NotSupportedError"}};function P(t){return t instanceof Xe}function da(t){return!(t instanceof Xe)}function pa(t,e){if(t===e)return!0;if(!t||!e)return!1;var n=t.length;if(e.length!==n)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}function Nr(t,e){if(t===e)return!0;if(!t||!e)return!1;var n=Object.keys(t),r=Object.keys(e),i=n.length;if(r.length!==i)return!1;for(var s=0;s<i;s++){var u=n[s];if(t[u]!==e[u]||!Object.prototype.hasOwnProperty.call(e,u))return!1}return!0}var il=Object.create,Da=Object.defineProperty,sl=Object.getOwnPropertyDescriptor,ul=Object.getOwnPropertyNames,al=Object.getPrototypeOf,ol=Object.prototype.hasOwnProperty,ll=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),cl=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ul(e))!ol.call(t,i)&&i!==n&&Da(t,i,{get:()=>e[i],enumerable:!(r=sl(e,i))||r.enumerable});return t},hl=(t,e,n)=>(n=t!=null?il(al(t)):{},cl(e||!t||!t.__esModule?Da(n,"default",{value:t,enumerable:!0}):n,t)),fl=ll((t,e)=>{e.exports=function(n,r){r||(r={}),typeof r=="function"&&(r={cmp:r});var i=typeof r.cycles=="boolean"?r.cycles:!1,s=r.cmp&&function(a){return function(o){return function(l,c){var h={key:l,value:o[l]},f={key:c,value:o[c]};return a(h,f)}}}(r.cmp),u=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var l,c;if(Array.isArray(o)){for(c="[",l=0;l<o.length;l++)l&&(c+=","),c+=a(o[l])||"null";return c+"]"}if(o===null)return"null";if(u.indexOf(o)!==-1){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var h=u.push(o)-1,f=Object.keys(o).sort(s&&s(o));for(c="",l=0;l<f.length;l++){var d=f[l],p=a(o[d]);!p||(c&&(c+=","),c+=JSON.stringify(d)+":"+p)}return u.splice(h,1),"{"+c+"}"}}(n)}}),dl=hl(fl()),{default:gs,...pl}=dl,Dl=gs!==void 0?gs:pl,ma={};Ki(ma,{base16:()=>Fl,base32:()=>kl,base32hex:()=>vl,base64:()=>Bl,base64url:()=>Sl,codec:()=>xl,default:()=>Il});var ml=Object.create,ga=Object.defineProperty,gl=Object.getOwnPropertyDescriptor,wl=Object.getOwnPropertyNames,bl=Object.getPrototypeOf,yl=Object.prototype.hasOwnProperty,Al=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),_l=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of wl(e))!yl.call(t,i)&&i!==n&&ga(t,i,{get:()=>e[i],enumerable:!(r=gl(e,i))||r.enumerable});return t},Cl=(t,e,n)=>(n=t!=null?ml(bl(t)):{},_l(e||!t||!t.__esModule?ga(n,"default",{value:t,enumerable:!0}):n,t)),El=Al(t=>{Object.defineProperty(t,"__esModule",{value:!0});function e(p,D,m){var A;if(m===void 0&&(m={}),!D.codes){D.codes={};for(var F=0;F<D.chars.length;++F)D.codes[D.chars[F]]=F}if(!m.loose&&p.length*D.bits&7)throw new SyntaxError("Invalid padding");for(var _=p.length;p[_-1]==="=";)if(--_,!m.loose&&!((p.length-_)*D.bits&7))throw new SyntaxError("Invalid padding");for(var g=new((A=m.out)!=null?A:Uint8Array)(_*D.bits/8|0),S=0,k=0,x=0,R=0;R<_;++R){var z=D.codes[p[R]];if(z===void 0)throw new SyntaxError("Invalid character "+p[R]);k=k<<D.bits|z,S+=D.bits,S>=8&&(S-=8,g[x++]=255&k>>S)}if(S>=D.bits||255&k<<8-S)throw new SyntaxError("Unexpected end of data");return g}function n(p,D,m){m===void 0&&(m={});for(var A=m,F=A.pad,_=F===void 0?!0:F,g=(1<<D.bits)-1,S="",k=0,x=0,R=0;R<p.length;++R)for(x=x<<8|255&p[R],k+=8;k>D.bits;)k-=D.bits,S+=D.chars[g&x>>k];if(k&&(S+=D.chars[g&x<<D.bits-k]),_)for(;S.length*D.bits&7;)S+="=";return S}var r={chars:"0123456789ABCDEF",bits:4},i={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},s={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},u={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},a={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},o={parse:function(p,D){return e(p.toUpperCase(),r,D)},stringify:function(p,D){return n(p,r,D)}},l={parse:function(p,D){return D===void 0&&(D={}),e(D.loose?p.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):p,i,D)},stringify:function(p,D){return n(p,i,D)}},c={parse:function(p,D){return e(p,s,D)},stringify:function(p,D){return n(p,s,D)}},h={parse:function(p,D){return e(p,u,D)},stringify:function(p,D){return n(p,u,D)}},f={parse:function(p,D){return e(p,a,D)},stringify:function(p,D){return n(p,a,D)}},d={parse:e,stringify:n};t.base16=o,t.base32=l,t.base32hex=c,t.base64=h,t.base64url=f,t.codec=d}),yn=Cl(El(),1),Fl=yn.default.base16,kl=yn.default.base32,vl=yn.default.base32hex,Bl=yn.default.base64,Sl=yn.default.base64url,xl=yn.default.codec,Il=yn.default,wa={};Ki(wa,{Hash:()=>Hl,__esModule:()=>zl,createHash:()=>ql,default:()=>Wl});var Tl=Object.create,ba=Object.defineProperty,$l=Object.getOwnPropertyDescriptor,Rl=Object.getOwnPropertyNames,Pl=Object.getPrototypeOf,Ml=Object.prototype.hasOwnProperty,Ol=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Nl=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Rl(e))!Ml.call(t,i)&&i!==n&&ba(t,i,{get:()=>e[i],enumerable:!(r=$l(e,i))||r.enumerable});return t},Ll=(t,e,n)=>(n=t!=null?Tl(Pl(t)):{},Nl(e||!t||!t.__esModule?ba(n,"default",{value:t,enumerable:!0}):n,t)),Ul=Ol(t=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Hash=t.createHash=void 0;var e=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],n={sha256:1};function r(_){if(_&&!n[_]&&!n[_.toLowerCase()])throw new Error("Digest method not supported");return new i}t.createHash=r;var i=class{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!u||a>=8e3)&&(u=new ArrayBuffer(8e3),a=0),this._byte=new Uint8Array(u,a,80),this._word=new Int32Array(u,a,20),a+=80}update(_){if(typeof _=="string")return this._utf8(_);if(_==null)throw new TypeError("Invalid type: "+typeof _);let g=_.byteOffset,S=_.byteLength,k=S/64|0,x=0;if(k&&!(g&3)&&!(this._size%64)){let R=new Int32Array(_.buffer,g,k*16);for(;k--;)this._int32(R,x>>2),x+=64;this._size+=x}if(_.BYTES_PER_ELEMENT!==1&&_.buffer){let R=new Uint8Array(_.buffer,g+x,S-x);return this._uint8(R)}return x===S?this:this._uint8(_,x)}_uint8(_,g){let{_byte:S,_word:k}=this,x=_.length;for(g=g|0;g<x;){let R=this._size%64,z=R;for(;g<x&&z<64;)S[z++]=_[g++];z>=64&&this._int32(k),this._size+=z-R}return this}_utf8(_){let{_byte:g,_word:S}=this,k=_.length,x=this._sp;for(let R=0;R<k;){let z=this._size%64,L=z;for(;R<k&&L<64;){let Q=_.charCodeAt(R++)|0;Q<128?g[L++]=Q:Q<2048?(g[L++]=192|Q>>>6,g[L++]=128|Q&63):Q<55296||Q>57343?(g[L++]=224|Q>>>12,g[L++]=128|Q>>>6&63,g[L++]=128|Q&63):x?(Q=((x&1023)<<10)+(Q&1023)+65536,g[L++]=240|Q>>>18,g[L++]=128|Q>>>12&63,g[L++]=128|Q>>>6&63,g[L++]=128|Q&63,x=0):x=Q}L>=64&&(this._int32(S),S[0]=S[16]),this._size+=L-z}return this._sp=x,this}_int32(_,g){let{A:S,B:k,C:x,D:R,E:z,F:L,G:Q,H:De}=this,he=0;for(g=g|0;he<16;)s[he++]=h(_[g++]);for(he=16;he<64;he++)s[he]=A(s[he-2])+s[he-7]+m(s[he-15])+s[he-16]|0;for(he=0;he<64;he++){let Ue=De+D(z)+f(z,L,Q)+e[he]+s[he]|0,tn=p(S)+d(S,k,x)|0;De=Q,Q=L,L=z,z=R+Ue|0,R=x,x=k,k=S,S=Ue+tn|0}this.A=S+this.A|0,this.B=k+this.B|0,this.C=x+this.C|0,this.D=R+this.D|0,this.E=z+this.E|0,this.F=L+this.F|0,this.G=Q+this.G|0,this.H=De+this.H|0}digest(_){let{_byte:g,_word:S}=this,k=this._size%64|0;for(g[k++]=128;k&3;)g[k++]=0;if(k>>=2,k>14){for(;k<16;)S[k++]=0;k=0,this._int32(S)}for(;k<16;)S[k++]=0;let x=this._size*8,R=(x&4294967295)>>>0,z=(x-R)/4294967296;return z&&(S[14]=h(z)),R&&(S[15]=h(R)),this._int32(S),_==="hex"?this._hex():this._bin()}_hex(){let{A:_,B:g,C:S,D:k,E:x,F:R,G:z,H:L}=this;return o(_)+o(g)+o(S)+o(k)+o(x)+o(R)+o(z)+o(L)}_bin(){let{A:_,B:g,C:S,D:k,E:x,F:R,G:z,H:L,_byte:Q,_word:De}=this;return De[0]=h(_),De[1]=h(g),De[2]=h(S),De[3]=h(k),De[4]=h(x),De[5]=h(R),De[6]=h(z),De[7]=h(L),Q.slice(0,32)}};t.Hash=i;var s=new Int32Array(64),u,a=0,o=_=>(_+4294967296).toString(16).substr(-8),l=_=>_<<24&4278190080|_<<8&16711680|_>>8&65280|_>>24&255,c=_=>_,h=F()?c:l,f=(_,g,S)=>S^_&(g^S),d=(_,g,S)=>_&g|S&(_|g),p=_=>(_>>>2|_<<30)^(_>>>13|_<<19)^(_>>>22|_<<10),D=_=>(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7),m=_=>(_>>>7|_<<25)^(_>>>18|_<<14)^_>>>3,A=_=>(_>>>17|_<<15)^(_>>>19|_<<13)^_>>>10;function F(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}}),ya=Ll(Ul()),zl=!0,{Hash:Hl,createHash:ql}=ya,{default:ws,...jl}=ya,Wl=ws!==void 0?ws:jl,rr={};Ki(rr,{CURVE:()=>me,ExtendedPoint:()=>je,Point:()=>Le,RistrettoPoint:()=>Lr,getPublicKey:()=>nc,sign:()=>rc,utils:()=>Zr,verify:()=>ic});var Te=BigInt(0),le=BigInt(1),Ke=BigInt(2),Aa=BigInt(255),bs=Ke**BigInt(252)+BigInt("27742317777372353535851937790883648493"),me={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ke**Aa-BigInt(19),l:bs,n:bs,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},_a=Ke**BigInt(256),ur=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");var Vl=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ql=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Kl=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Gl=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Me=class{constructor(t,e,n,r){this.x=t,this.y=e,this.z=n,this.t=r}static fromAffine(t){if(!(t instanceof Le))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(Le.ZERO)?Me.ZERO:new Me(t.x,t.y,le,I(t.x*t.y))}static toAffineBatch(t){let e=Yl(t.map(n=>n.z));return t.map((n,r)=>n.toAffine(e[r]))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){ys(t);let{x:e,y:n,z:r}=this,{x:i,y:s,z:u}=t,a=I(e*u),o=I(i*r),l=I(n*u),c=I(s*r);return a===o&&l===c}negate(){return new Me(I(-this.x),this.y,this.z,I(-this.t))}double(){let{x:t,y:e,z:n}=this,{a:r}=me,i=I(t**Ke),s=I(e**Ke),u=I(Ke*I(n**Ke)),a=I(r*i),o=I(I((t+e)**Ke)-i-s),l=a+s,c=l-u,h=a-s,f=I(o*c),d=I(l*h),p=I(o*h),D=I(c*l);return new Me(f,d,D,p)}add(t){ys(t);let{x:e,y:n,z:r,t:i}=this,{x:s,y:u,z:a,t:o}=t,l=I((n-e)*(u+s)),c=I((n+e)*(u-s)),h=I(c-l);if(h===Te)return this.double();let f=I(r*Ke*o),d=I(i*Ke*a),p=d+f,D=c+l,m=d-f,A=I(p*h),F=I(D*m),_=I(p*m),g=I(h*D);return new Me(A,F,g,_)}subtract(t){return this.add(t.negate())}precomputeWindow(t){let e=1+256/t,n=[],r=this,i=r;for(let s=0;s<e;s++){i=r,n.push(i);for(let u=1;u<2**(t-1);u++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(t,e){!e&&this.equals(Me.BASE)&&(e=Le.BASE);let n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&Bi.get(e);r||(r=this.precomputeWindow(n),e&&n!==1&&(r=Me.normalizeZ(r),Bi.set(e,r)));let i=Me.ZERO,s=Me.ZERO,u=1+256/n,a=2**(n-1),o=BigInt(2**n-1),l=2**n,c=BigInt(n);for(let h=0;h<u;h++){let f=h*a,d=Number(t&o);if(t>>=c,d>a&&(d-=l,t+=le),d===0){let p=r[f];h%2&&(p=p.negate()),s=s.add(p)}else{let p=r[f+Math.abs(d)-1];d<0&&(p=p.negate()),i=i.add(p)}}return Me.normalizeZ([i,s])[0]}multiply(t,e){return this.wNAF(zr(t,me.l),e)}multiplyUnsafe(t){let e=zr(t,me.l,!1),n=Me.BASE,r=Me.ZERO;if(e===Te)return r;if(this.equals(r)||e===le)return this;if(this.equals(n))return this.wNAF(e);let i=r,s=this;for(;e>Te;)e&le&&(i=i.add(s)),s=s.double(),e>>=le;return i}isSmallOrder(){return this.multiplyUnsafe(me.h).equals(Me.ZERO)}isTorsionFree(){return this.multiplyUnsafe(me.l).equals(Me.ZERO)}toAffine(t=Kr(this.z)){let{x:e,y:n,z:r}=this,i=I(e*t),s=I(n*t);if(I(r*t)!==le)throw new Error("invZ was invalid");return new Le(i,s)}fromRistrettoBytes(){ui()}toRistrettoBytes(){ui()}fromRistrettoHash(){ui()}},je=Me;je.BASE=new Me(me.Gx,me.Gy,le,I(me.Gx*me.Gy)),je.ZERO=new Me(Te,le,le,Te);function ys(t){if(!(t instanceof je))throw new TypeError("ExtendedPoint expected")}function si(t){if(!(t instanceof Lr))throw new TypeError("RistrettoPoint expected")}function ui(){throw new Error("Legacy method: switch to RistrettoPoint")}var Lt=class{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){let{d:e}=me,n=I(ur*t*t),r=I((n+le)*Kl),i=BigInt(-1),s=I((i-e*n)*I(n+e)),{isValid:u,value:a}=Gi(r,s),o=I(a*t);Zt(o)||(o=I(-o)),u||(a=o),u||(i=n);let l=I(i*(n-le)*Gl-s),c=a*a,h=I((a+a)*s),f=I(l*Vl),d=I(le-c),p=I(le+c);return new je(I(h*p),I(d*f),I(f*p),I(h*d))}static hashToCurve(t){t=Jt(t,64);let e=ai(t.slice(0,32)),n=this.calcElligatorRistrettoMap(e),r=ai(t.slice(32,64)),i=this.calcElligatorRistrettoMap(r);return new Lt(n.add(i))}static fromHex(t){t=Jt(t,32);let{a:e,d:n}=me,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=ai(t);if(!ec(fr(i),t)||Zt(i))throw new Error(r);let s=I(i*i),u=I(le+e*s),a=I(le-e*s),o=I(u*u),l=I(a*a),c=I(e*n*o-l),{isValid:h,value:f}=As(I(c*l)),d=I(f*a),p=I(f*d*c),D=I((i+i)*d);Zt(D)&&(D=I(-D));let m=I(u*p),A=I(D*m);if(!h||Zt(A)||m===Te)throw new Error(r);return new Lt(new je(D,m,le,A))}toRawBytes(){let{x:t,y:e,z:n,t:r}=this.ep,i=I(I(n+e)*I(n-e)),s=I(t*e),{value:u}=As(I(i*s**Ke)),a=I(u*i),o=I(u*s),l=I(a*o*r),c;if(Zt(r*l)){let f=I(e*ur),d=I(t*ur);t=f,e=d,c=I(a*Ql)}else c=o;Zt(t*l)&&(e=I(-e));let h=I((n-e)*c);return Zt(h)&&(h=I(-h)),fr(h)}toHex(){return Ar(this.toRawBytes())}toString(){return this.toHex()}equals(t){si(t);let e=this.ep,n=t.ep,r=I(e.x*n.y)===I(e.y*n.x),i=I(e.y*n.y)===I(e.x*n.x);return r||i}add(t){return si(t),new Lt(this.ep.add(t.ep))}subtract(t){return si(t),new Lt(this.ep.subtract(t.ep))}multiply(t){return new Lt(this.ep.multiply(t))}multiplyUnsafe(t){return new Lt(this.ep.multiplyUnsafe(t))}},Lr=Lt;Lr.BASE=new Lt(je.BASE),Lr.ZERO=new Lt(je.ZERO);var Bi=new WeakMap,hr=class{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,Bi.delete(this)}static fromHex(t,e=!0){let{d:n,P:r}=me;t=Jt(t,32);let i=t.slice();i[31]=t[31]&-129;let s=Hn(i);if(e&&s>=r)throw new Error("Expected 0 < hex < P");if(!e&&s>=_a)throw new Error("Expected 0 < hex < 2**256");let u=I(s*s),a=I(u-le),o=I(n*u+le),{isValid:l,value:c}=Gi(a,o);if(!l)throw new Error("Point.fromHex: invalid y coordinate");let h=(c&le)===le;return(t[31]&128)!==0!==h&&(c=I(-c)),new hr(c,s)}static async fromPrivateKey(t){return(await Gr(t)).point}toRawBytes(){let t=fr(this.y);return t[31]|=this.x&le?128:0,t}toHex(){return Ar(this.toRawBytes())}toX25519(){let{y:t}=this,e=I((le+t)*Kr(le-t));return fr(e)}isTorsionFree(){return je.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new hr(I(-this.x),this.y)}add(t){return je.fromAffine(this).add(je.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return je.fromAffine(this).multiply(t,this).toAffine()}},Le=hr;Le.BASE=new hr(me.Gx,me.Gy),Le.ZERO=new hr(Te,le);var Ur=class{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){let e=Jt(t,64),n=Le.fromHex(e.slice(0,32),!1),r=Hn(e.slice(32,64));return new Ur(n,r)}assertValidity(){let{r:t,s:e}=this;if(!(t instanceof Le))throw new Error("Expected Point instance");return zr(e,me.l,!1),this}toRawBytes(){let t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(fr(this.s),32),t}toHex(){return Ar(this.toRawBytes())}};function Zl(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((r,i)=>r+i.length,0),n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){let s=t[r];n.set(s,i),i+=s.length}return n}var Xl=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ar(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Xl[t[n]];return e}function Ca(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){let r=n*2,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[n]=s}return e}function Ea(t){let e=t.toString(16).padStart(64,"0");return Ca(e)}function fr(t){return Ea(t).reverse()}function Zt(t){return(I(t)&le)===le}function Hn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Ar(Uint8Array.from(t).reverse()))}function ai(t){return I(Hn(t)&Ke**Aa-le)}function I(t,e=me.P){let n=t%e;return n>=Te?n:e+n}function Kr(t,e=me.P){if(t===Te||e<=Te)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=I(t,e),r=e,i=Te,s=le;for(;n!==Te;){let u=r/n,a=r%n,o=i-s*u;r=n,n=a,i=s,s=o}if(r!==le)throw new Error("invert: does not exist");return I(i,e)}function Yl(t,e=me.P){let n=new Array(t.length),r=t.reduce((s,u,a)=>u===Te?s:(n[a]=s,I(s*u,e)),le),i=Kr(r,e);return t.reduceRight((s,u,a)=>u===Te?s:(n[a]=I(s*n[a],e),I(s*u,e)),i),n}function wt(t,e){let{P:n}=me,r=t;for(;e-- >Te;)r*=r,r%=n;return r}function Jl(t){let{P:e}=me,n=BigInt(5),r=BigInt(10),i=BigInt(20),s=BigInt(40),u=BigInt(80),a=t*t%e*t%e,o=wt(a,Ke)*a%e,l=wt(o,le)*t%e,c=wt(l,n)*l%e,h=wt(c,r)*c%e,f=wt(h,i)*h%e,d=wt(f,s)*f%e,p=wt(d,u)*d%e,D=wt(p,u)*d%e,m=wt(D,r)*c%e;return{pow_p_5_8:wt(m,Ke)*t%e,b2:a}}function Gi(t,e){let n=I(e*e*e),r=I(n*n*e),i=Jl(t*r).pow_p_5_8,s=I(t*n*i),u=I(e*s*s),a=s,o=I(s*ur),l=u===t,c=u===I(-t),h=u===I(-t*ur);return l&&(s=a),(c||h)&&(s=o),Zt(s)&&(s=I(-s)),{isValid:l||c,value:s}}function As(t){return Gi(le,t)}async function Si(...t){let e=await Zr.sha512(Zl(...t)),n=Hn(e);return I(n,me.l)}function ec(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Jt(t,e){let n=t instanceof Uint8Array?Uint8Array.from(t):Ca(t);if(typeof e=="number"&&n.length!==e)throw new Error(`Expected ${e} bytes`);return n}function zr(t,e,n=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(n){if(Te<t)return t}else if(Te<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function tc(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function Gr(t){if(t=typeof t=="bigint"||typeof t=="number"?Ea(zr(t,_a)):Jt(t),t.length!==32)throw new Error("Expected 32 bytes");let e=await Zr.sha512(t),n=tc(e.slice(0,32)),r=e.slice(32,64),i=I(Hn(n),me.l),s=Le.BASE.multiply(i),u=s.toRawBytes();return{head:n,prefix:r,scalar:i,point:s,pointBytes:u}}async function nc(t){return(await Gr(t)).pointBytes}async function rc(t,e){t=Jt(t);let{prefix:n,scalar:r,pointBytes:i}=await Gr(e),s=await Si(n,t),u=Le.BASE.multiply(s),a=await Si(u.toRawBytes(),i,t),o=I(s+a*r,me.l);return new Ur(u,o).toRawBytes()}async function ic(t,e,n){e=Jt(e),n instanceof Le||(n=Le.fromHex(n,!1));let{r,s:i}=t instanceof Ur?t.assertValidity():Ur.fromHex(t),s=je.BASE.multiplyUnsafe(i),u=await Si(r.toRawBytes(),n.toRawBytes(),e),a=je.fromAffine(n).multiplyUnsafe(u);return je.fromAffine(r).add(a).subtract(s).multiplyUnsafe(me.h).equals(je.ZERO)}Le.BASE._setWindowSize(8);var Zr={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Ar,getExtendedPublicKey:Gr,mod:I,invert:Kr,hashToPrivateScalar:t=>{if(t=Jt(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=I(Hn(t),me.l);if(e===Te||e===le)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>crypto.getRandomValues(new Uint8Array(t)),randomPrivateKey:()=>Zr.randomBytes(32),sha512:async t=>{let e=await crypto.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)},precompute(t=8,e=Le.BASE){let n=e.equals(Le.BASE)?e:new Le(e.x,e.y);return n._setWindowSize(t),n.multiply(Ke),n}},Ee=11400714785074694791n,Re=14029467366897019727n,_s=1609587929392839161n,Gn=9650029242287828579n,Cs=2870177450012600261n,Fa=64n,sc=2n**Fa-1n,uc=new TextEncoder;function Es(t,e,n,r){return BigInt(t)|BigInt(e)<<16n|BigInt(n)<<32n|BigInt(r)<<48n}function It(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function Se(t,e){return t<<e&sc|t>>Fa-e}function Y(t){return BigInt.asUintN(64,t)}var yt,At,_t,Ct,Et,Ft,dn,qe,aa,Zi=(aa=class{constructor(t=0){tt(this,yt,void 0);tt(this,At,void 0);tt(this,_t,void 0);tt(this,Ct,void 0);tt(this,Et,void 0);tt(this,Ft,void 0);tt(this,dn,void 0);tt(this,qe,void 0);this.reset(t)}reset(t=H(this,yt)){return de(this,yt,BigInt.asUintN(32,BigInt(t))),de(this,At,Y(H(this,yt)+Ee+Re)),de(this,_t,Y(H(this,yt)+Re)),de(this,Ct,H(this,yt)),de(this,Et,Y(H(this,yt)-Ee)),de(this,Ft,null),de(this,dn,0),de(this,qe,0),this}update(t){typeof t=="string"&&(t=uc.encode(t));let e=0,n=t.length,r=e+n;if(n===0)return this;if(de(this,dn,H(this,dn)+n),H(this,qe)===0&&de(this,Ft,new Uint8Array(32)),H(this,qe)+n<32)return H(this,Ft).set(t.subarray(0,n),H(this,qe)),de(this,qe,H(this,qe)+n),this;if(H(this,qe)>0){H(this,Ft).set(t.subarray(0,32-H(this,qe)),H(this,qe));let i=0,s;s=It(H(this,Ft),i),de(this,At,Y(Se(Y(H(this,At)+s*Re),31n)*Ee)),i+=8,s=It(this.memory,i),de(this,_t,Y(Se(Y(H(this,_t)+s*Re),31n)*Ee)),i+=8,s=It(this.memory,i),de(this,Ct,Y(Se(Y(H(this,Ct)+s*Re),31n)*Ee)),i+=8,s=It(this.memory,i),de(this,Et,Y(Se(Y(H(this,Et)+s*Re),31n)*Ee)),e+=32-H(this,qe),de(this,qe,0)}if(e<=r-32){let i=r-32;do{let s;s=It(t,e),de(this,At,Y(Se(Y(H(this,At)+s*Re),31n)*Ee)),e+=8,s=It(t,e),de(this,_t,Y(Se(Y(H(this,_t)+s*Re),31n)*Ee)),e+=8,s=It(t,e),de(this,Ct,Y(Se(Y(H(this,Ct)+s*Re),31n)*Ee)),e+=8,s=It(t,e),de(this,Et,Y(Se(Y(H(this,Et)+s*Re),31n)*Ee)),e+=8}while(e<=i)}return e<r&&(H(this,Ft).set(t.subarray(e,r),H(this,qe)),de(this,qe,r-e)),this}digest(){let t=H(this,Ft),e=H(this,qe),n=0,r=0n,i=0n,s=0n;for(H(this,dn)>=32?(r=Se(H(this,At),1n)+Se(H(this,_t),7n)+Se(H(this,Ct),12n)+Se(H(this,Et),18n),r=Y(r^Se(Y(H(this,At)*Re),31n)*Ee),r=Y(r*Ee+Gn),r=Y(r^Se(Y(H(this,_t)*Re),31n)*Ee),r=Y(r*Ee+Gn),r=Y(r^Se(Y(H(this,Ct)*Re),31n)*Ee),r=Y(r*Ee+Gn),r=Y(r^Se(Y(H(this,Et)*Re),31n)*Ee),r=Y(r*Ee+Gn)):r=Y(H(this,yt)+Cs),r+=BigInt(H(this,dn));n<=e-8;)s=It(t,n),s=Y(Se(Y(s*Re),31n)*Ee),r=Y(Se(r^s,27n)*Ee+Gn),n+=8;for(n+4<=e&&(s=Es(t[n+1]<<8|t[n],t[n+3]<<8|t[n+2],0,0),r=Y(Se(r^Y(s*Ee),23n)*Re+_s),n+=4);n<e;)s=Es(t[n++],0,0,0),r=Y(Se(r^Y(s*Cs),11n)*Ee);return i=Y(r>>33n),r=Y((r^i)*Re),i=Y(r>>29n),r=Y((r^i)*_s),i=Y(r>>32n),r=Y(r^i),r}},yt=new WeakMap,At=new WeakMap,_t=new WeakMap,Ct=new WeakMap,Et=new WeakMap,Ft=new WeakMap,dn=new WeakMap,qe=new WeakMap,aa);function ac(t,e=0){return new Zi(e).update(t).digest()}function ka(t,e){return t<e?-1:t>e?1:0}var Pn=class{constructor(t,e){this.parent=t,this.value=e,this.left=null,this.right=null}static from(t){let e=new Pn(t.parent,t.value);return e.left=t.left,e.right=t.right,e}directionFromParent(){return this.parent===null?null:this===this.parent.left?"left":this===this.parent.right?"right":null}findMinNode(){let t=this.left;for(;t!=null&&t.left;)t=t.left;return t??this}findMaxNode(){let t=this.right;for(;t!=null&&t.right;)t=t.right;return t??this}findSuccessorNode(){if(this.right!==null)return this.right.findMinNode();let t=this.parent,e=this.directionFromParent();for(;t&&e==="right";)e=t.directionFromParent(),t=t.parent;return t}},ir=class{constructor(t=ka){this.compare=t,this.root=null,this._size=0}static from(t,e){let n,r=[];if(t instanceof ir)if(n=new ir((e==null?void 0:e.compare)??t.compare),(e==null?void 0:e.compare)||(e==null?void 0:e.map))r=t;else{let s=[];for(t.root&&(n.root=Pn.from(t.root),s.push(n.root));s.length;){let u=s.pop(),a=u.left?Pn.from(u.left):null,o=u.right?Pn.from(u.right):null;a&&(a.parent=u,s.push(a)),o&&(o.parent=u,s.push(o))}}else n=e!=null&&e.compare?new ir(e.compare):new ir,r=t;let i=e!=null&&e.map?Array.from(r,e.map,e.thisArg):r;for(let s of i)n.insert(s);return n}get size(){return this._size}findNode(t){let e=this.root;for(;e;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";e=e[r]}return e}rotateNode(t,e){let n=e==="left"?"right":"left";if(!t[n])throw new TypeError(`cannot rotate ${e} without ${n} child`);let r=t[n];if(t[n]=r[e]??null,r[e]&&(r[e].parent=t),r.parent=t.parent,t.parent){let i=t===t.parent[e]?e:n;t.parent[i]=r}else this.root=r;r[e]=t,t.parent=r}insertNode(t,e){if(this.root){let n=this.root;for(;;){let r=this.compare(e,n.value);if(r===0)break;let i=r<0?"left":"right";if(n[i])n=n[i];else return n[i]=new t(n,e),this._size++,n[i]}}else return this.root=new t(null,e),this._size++,this.root;return null}removeNode(t){let e=this.findNode(t);if(e){let n=!e.left||!e.right?e:e.findSuccessorNode(),r=n.left??n.right;r&&(r.parent=n.parent),n.parent?n.parent[n.directionFromParent()]=r:this.root=r,n!==e&&(e.value=n.value,e=n),this._size--}return e}insert(t){return!!this.insertNode(Pn,t)}remove(t){return!!this.removeNode(t)}find(t){var e;return((e=this.findNode(t))==null?void 0:e.value)??null}min(){return this.root?this.root.findMinNode().value:null}max(){return this.root?this.root.findMaxNode().value:null}clear(){this.root=null,this._size=0}isEmpty(){return this.size===0}*lnrValues(){let t=[],e=this.root;for(;t.length||e;)e?(t.push(e),e=e.left):(e=t.pop(),yield e.value,e=e.right)}*rnlValues(){let t=[],e=this.root;for(;t.length||e;)e?(t.push(e),e=e.right):(e=t.pop(),yield e.value,e=e.left)}*nlrValues(){let t=[];for(this.root&&t.push(this.root);t.length;){let e=t.pop();yield e.value,e.right&&t.push(e.right),e.left&&t.push(e.left)}}*lrnValues(){let t=[],e=this.root,n=null;for(;t.length||e;)if(e)t.push(e),e=e.left;else{let r=t[t.length-1];r.right&&r.right!==n?e=r.right:(yield r.value,n=t.pop())}}*lvlValues(){let t=[],e=this.root;for(;e;)yield e.value,e.left&&t.push(e.left),e.right&&t.push(e.right),e=t.shift()??null}*[Symbol.iterator](){yield*this.lnrValues()}},Mn=class extends Pn{constructor(t,e){super(t,e),this.red=!0}static from(t){let e=new Mn(t.parent,t.value);return e.left=t.left,e.right=t.right,e.red=t.red,e}},sr=class extends ir{constructor(t=ka){super(t)}static from(t,e){let n,r=[];if(t instanceof sr)if(n=new sr((e==null?void 0:e.compare)??t.compare),(e==null?void 0:e.compare)||(e==null?void 0:e.map))r=t;else{let s=[];for(t.root&&(n.root=Mn.from(t.root),s.push(n.root));s.length;){let u=s.pop(),a=u.left?Mn.from(u.left):null,o=u.right?Mn.from(u.right):null;a&&(a.parent=u,s.push(a)),o&&(o.parent=u,s.push(o))}}else n=e!=null&&e.compare?new sr(e.compare):new sr,r=t;let i=e!=null&&e.map?Array.from(r,e.map,e.thisArg):r;for(let s of i)n.insert(s);return n}removeFixup(t,e){var n,r,i;for(;t&&!(e!=null&&e.red);){let s=t.left===e?"left":"right",u=s==="right"?"left":"right",a=t[u];a!=null&&a.red&&(a.red=!1,t.red=!0,this.rotateNode(t,s),a=t[u]),a&&(!((n=a.left)!=null&&n.red)&&!((r=a.right)!=null&&r.red)?(a.red=!0,e=t,t=e.parent):((i=a[u])!=null&&i.red||(a[s].red=!1,a.red=!0,this.rotateNode(a,u),a=t[u]),a.red=t.red,t.red=!1,a[u].red=!1,this.rotateNode(t,s),e=this.root,t=null))}e&&(e.red=!1)}insert(t){var n;let e=this.insertNode(Mn,t);if(e){for(;(n=e.parent)!=null&&n.red;){let r=e.parent,i=r.directionFromParent(),s=i==="right"?"left":"right",u=r.parent[s]??null;u!=null&&u.red?(r.red=!1,u.red=!1,r.parent.red=!0,e=r.parent):(e===r[s]&&(e=r,this.rotateNode(e,i),r=e.parent),r.red=!1,r.parent.red=!0,this.rotateNode(r.parent,s))}this.root.red=!1}return!!e}remove(t){let e=this.removeNode(t);return e&&!e.red&&this.removeFixup(e.parent,e.left??e.right),!!e}};function Fs(t,e){return{lift:n=>[t.lift(n),e.lift(n)],combine:(n,r)=>{let i=t.combine(n[0],r[0]),s=e.combine(n[1],r[1]);return[i,s]},neutral:[t.neutral,e.neutral]}}var oc={lift:t=>1,combine:(t,e)=>t+e,neutral:0},ks=class extends Mn{constructor(t,e,n){super(t,e),this.label=n.neutral,this.liftedValue=n.lift(e),this.monoid=n}updateLabel(t=!0,e){var n,r,i;this.left!==null&&this.right===null?this.label=this.monoid.combine(this.left.label,this.liftedValue):this.left===null&&this.right!==null?this.label=this.monoid.combine(this.liftedValue,this.right.label):this.left&&this.right?this.label=this.monoid.combine(((n=this.left)==null?void 0:n.label)||this.monoid.neutral,this.monoid.combine(this.liftedValue,((r=this.right)==null?void 0:r.label)||this.monoid.neutral)):this.label=this.liftedValue,t&&((i=this.parent)==null||i.updateLabel(!0,"Updated by child"))}},lc=class extends sr{constructor(t,e){super(e),this.monoid=Fs(t,Fs(oc,{lift:n=>[n],combine:(n,r)=>n.concat(r),neutral:[]}))}getLowestValue(){if(!this.root)throw new Error("Can't get a range from a tree with no items");return this.root.findMinNode().value}rotateNode(t,e){var i;let n=e==="left"?"right":"left";if(!t[n])throw new TypeError(`cannot rotate ${e} without ${n} child`);let r=t[n];if(t[n]=r[e]??null,r[e]&&(r[e].parent=t),r.parent=t.parent,t.parent){let s=t===t.parent[e]?e:n;t.parent[s]=r}else this.root=r;r[e]=t,t.parent=r,(i=r[e])==null||i.updateLabel(!1,"Node rotated"),console.groupEnd()}removeFixup(t,e){var n,r,i;for(;t&&!(e!=null&&e.red);){let s=t.left===e?"left":"right",u=s==="right"?"left":"right",a=t[u];a!=null&&a.red&&(a.red=!1,t.red=!0,this.rotateNode(t,s),a=t[u]),a&&(!((n=a.left)!=null&&n.red)&&!((r=a.right)!=null&&r.red)?(a.red=!0,e=t,t=e.parent):((i=a[u])!=null&&i.red||(a[s].red=!1,a.red=!0,this.rotateNode(a,u),a=t[u]),a.red=t.red,t.red=!1,a[u].red=!1,this.rotateNode(t,s),e=this.root,t=null))}e&&(e.red=!1)}insertFingerprintNode(t){if(this.root){let e=this.root;for(;;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";if(e[r])e=e[r];else return e[r]=new ks(e,t,this.monoid),this._size++,e[r]}}else return this.root=new ks(null,t,this.monoid),this._size++,this.root;return null}insert(t){var r;let e=this.insertFingerprintNode(t),n=e;if(n){for(;(r=n.parent)!=null&&r.red;){let i=n.parent,s=i.directionFromParent(),u=s==="right"?"left":"right",a=i.parent[u]??null;a!=null&&a.red?(i.red=!1,a.red=!1,i.parent.red=!0,n=i.parent):(n===i[u]&&(n=i,this.rotateNode(n,s),i=n.parent),i.red=!1,i.parent.red=!0,this.rotateNode(i.parent,u))}this.root.red=!1}return e==null||e.updateLabel(!0,"Node inserted"),!!n}remove(t){var n;let e=this.removeNode(t);return e&&!e.red&&this.removeFixup(e.parent,e.left??e.right),e&&((n=e.parent)==null||n.updateLabel(!0,"Child node removed")),!!e}getFingerprint(t,e,n){if(this.root===null)return{fingerprint:this.monoid.neutral[0],size:0,items:[],nextTree:null};let r=n||this.findGteNode(t),i=this.compare(t,e);if(i===0)return{fingerprint:this.root.label[0],size:this.root.label[1][0],items:this.root.label[1][1],nextTree:null};if(i<0){let{label:s,nextTree:u}=this.aggregateUntil(r,t,e);return{fingerprint:s[0],size:s[1][0],items:s[1][1],nextTree:u}}else{let s=this.root.findMinNode(),u=this.root.findMaxNode(),{label:a,nextTree:o}=this.aggregateUntil(r,t,u.value),l=this.monoid.combine(a,this.compare(u.value,t)>=0?this.monoid.lift(u.value):this.monoid.neutral);if(s.value===e)return{fingerprint:l[0],size:l[1][0],items:l[1][1],nextTree:o};let{label:c,nextTree:h}=this.aggregateUntil(s,s.value,e),f=this.monoid.combine(c,l);return{fingerprint:f[0],size:f[1][0],items:f[1][1],nextTree:h}}}findGteNode(t){let e=this.root;for(;e;){let n=this.compare(t,e.value);if(n===0)break;let r=n<0?"left":"right";if(e[r])e=e[r];else break}return e}aggregateUntil(t,e,n){let{label:r,nextTree:i}=this.aggregateUp(t,e,n);return i===null||this.compare(i.value,n)>=0?{label:r,nextTree:i}:this.aggregateDown(i.right,n,this.monoid.combine(r,i.liftedValue))}aggregateUp(t,e,n){var s;let r=this.monoid.neutral,i=t;for(;this.compare(i.findMaxNode().value,n)<0;){if(this.compare(i.value,e)>=0&&(r=this.monoid.combine(r,this.monoid.combine(i.liftedValue,((s=i.right)==null?void 0:s.label)||this.monoid.neutral))),i.parent===null)return{label:r,nextTree:null};i=i.parent}return{label:r,nextTree:i}}aggregateDown(t,e,n){var s,u;let r=t,i=n;for(;r!==null;)if(this.compare(r.value,e)<0)i=this.monoid.combine(i,this.monoid.combine(((s=r.left)==null?void 0:s.label)||this.monoid.neutral,r.liftedValue)),r=r.right;else{if(r.left===null||this.compare(r.left.findMaxNode().value,e)<0)return{label:this.monoid.combine(i,((u=r.left)==null?void 0:u.label)||this.monoid.neutral),nextTree:r};r=r.left}return{label:i,nextTree:null}}};function cc(){let t,e="pending",n=new Promise((r,i)=>{t={async resolve(s){await s,e="fulfilled",r(s)},reject(s){e="rejected",i(s)}}});return Object.defineProperty(n,"state",{get:()=>e}),Object.assign(n,t)}var hc=class{constructor(){this.deferreds=new Set,this.state="pending"}resolve(t){if(this.state==="pending"){this.state="fulfilled";for(let e of this.deferreds)e.resolve(t)}}reject(t){if(this.state==="pending"){this.state="rejected";for(let e of this.deferreds)e.reject(t)}}tee(){let t=cc();return this.state==="fulfilled"?t.resolve():this.state==="rejected"?t.reject():this.deferreds.add(t),t}},fc=class{constructor(t){this.isDoneTee=new hc,this.insertionCallbacks=new Set,this.lowerBoundFromPrev=null,this.collatedPayload=null,this.collatePayloads=e=>{switch(e.type){case"payload":{let n=this.collatedPayload;if(n===null&&(n={type:"payload",lowerBound:e.lowerBound,payload:[],end:{canRespond:!1,upperBound:e.payload}}),n.payload.push(e.payload),this.collatedPayload=n,e.end)return e.end.upperBound?n.end=e.end:n.end={...e.end,upperBound:e.payload},this.collatedPayload=null,n;break}default:return this.collatedPayload&&(this.collatedPayload=null),e}},this.reusableTree=void 0,this.lastAdjacentDoneUpperBound=null,this.isDoneSoFar=!0,this.tree=t.tree,this.fingerprintEquals=t.fingerprintEquals,this.encoding=t.encoding,this.payloadThreshold=t.payloadThreshold,this.rangeDivision=t.rangeDivision}decode(t){let e=this.lowerBoundFromPrev;try{return{type:"emptySet",canRespond:this.encoding.decode.emptySet(t)}}catch{}try{let n=this.encoding.decode.lowerBound(t);return this.lowerBoundFromPrev=n,{type:"lowerBound",value:n}}catch{}try{return this.encoding.decode.terminal(t),{type:"terminal"}}catch{}try{let n=this.encoding.decode.done(t);return this.lowerBoundFromPrev=n,{lowerBound:e,type:"done",upperBound:n}}catch{}try{let n=this.encoding.decode.fingerprint(t);return this.lowerBoundFromPrev=n.upperBound,{type:"fingerprint",lowerBound:e,fingerprint:n.fingerprint,upperBound:n.upperBound}}catch{}try{let n=this.encoding.decode.payload(t);return n.end&&(this.lowerBoundFromPrev=n.end.upperBound),{type:"payload",lowerBound:e,payload:n.value,...n.end?{end:n.end}:{}}}catch{}try{let n=this.encoding.decode.emptyPayload(t);return this.lowerBoundFromPrev=n,{lowerBound:e,type:"emptyPayload",upperBound:n}}catch{}return null}setReusableTree(t){this.reusableTree=t||void 0}process(t){let e=this.reusableTree;switch(t.type){case"lowerBound":case"terminal":case"done":return this.setReusableTree(null),[t];case"emptySet":{if(t.canRespond===!1&&this.isDoneTee.resolve(),this.tree.size===0)return[{type:"emptySet",canRespond:!1}];let n=this.tree.getLowestValue(),r=[{type:"lowerBound",value:n}],i=Array.from(this.tree.lnrValues());for(let s=0;s<i.length;s++){let u=i[s];s===i.length-1?r.push({type:"payload",payload:u,end:{upperBound:n,canRespond:!1}}):r.push({type:"payload",payload:u})}return r.push({type:"terminal"}),r}case"fingerprint":{let{fingerprint:n,size:r,items:i,nextTree:s}=this.tree.getFingerprint(t.lowerBound,t.upperBound,e);if(this.setReusableTree(s),this.fingerprintEquals(n,t.fingerprint))return[{type:"done",upperBound:t.upperBound}];if(r<=this.payloadThreshold){if(r===0)return[{type:"emptyPayload",upperBound:t.upperBound}];let u=[];for(let a=0;a<r;a++)u.push({type:"payload",payload:i[a],...a===i.length-1?{end:{upperBound:t.upperBound,canRespond:!0}}:{}});return u}else{let u=Math.ceil(r/this.rangeDivision),a=[];if(u<=this.payloadThreshold){for(let h=0;h<i.length;h++)a.push({type:"payload",payload:i[h],...h===i.length-1?{end:{upperBound:t.upperBound,canRespond:!0}}:{}});return a}let o,l=i,c=!1;if(t.lowerBound>=t.upperBound){let h=i.findIndex(f=>f>=t.lowerBound);if(h>0){let f=l.splice(0,h);l.push(...f),c=!0}}for(let h=0;h<r;h+=u){let f=l[h],d=l[h+u]||t.upperBound,{fingerprint:p,nextTree:D}=this.tree.getFingerprint(f,d,o);o=c?void 0:D||void 0,a.push({type:"fingerprint",fingerprint:p,upperBound:d})}return a}}case"payload":{for(let n of t.payload){this.tree.insert(n);for(let r of this.insertionCallbacks)r(n)}if(t.end.canRespond){let{items:n,size:r,nextTree:i}=this.tree.getFingerprint(t.lowerBound,t.end.upperBound,e);if(this.setReusableTree(i),r===0)return[{type:"emptyPayload",upperBound:t.end.upperBound}];let s=[];for(let u=0;u<r;u++)s.push({type:"payload",payload:n[u],...u===n.length-1?{end:{upperBound:t.end.upperBound,canRespond:!1}}:{}});return s}else return this.setReusableTree(null),[{type:"done",upperBound:t.end.upperBound}]}case"emptyPayload":{this.setReusableTree(null);let{items:n,size:r,nextTree:i}=this.tree.getFingerprint(t.lowerBound,t.upperBound);if(this.setReusableTree(i),r===0)return this.setReusableTree(null),[];let s=[];for(let u=0;u<r;u++)s.push({type:"payload",payload:n[u],...u===n.length-1?{end:{upperBound:t.upperBound,canRespond:!1}}:{}});return s}}}consolidateAdjacentDones(t){switch(t.type){case"done":{this.lastAdjacentDoneUpperBound=t.upperBound;break}default:{let e=this.lastAdjacentDoneUpperBound;return e?(this.lastAdjacentDoneUpperBound=null,[{type:"done",upperBound:e},t]):[t]}}}checkIsDone(t){var e;switch(t.type){case"emptySet":{t.canRespond&&(this.isDoneSoFar=!1);break}case"lowerBound":break;case"fingerprint":this.isDoneSoFar=!1;break;case"emptyPayload":this.isDoneSoFar=!1;break;case"payload":((e=t.end)==null?void 0:e.canRespond)===!0&&(this.isDoneSoFar=!1);break;case"terminal":this.isDoneSoFar?this.isDoneTee.resolve():this.isDoneSoFar=!0}}encode(t){let e;switch(t.type){case"emptySet":{e=this.encoding.encode.emptySet(t.canRespond);break}case"lowerBound":{e=this.encoding.encode.lowerBound(t.value);break}case"done":{e=this.encoding.encode.done(t.upperBound);break}case"fingerprint":{e=this.encoding.encode.fingerprint(t.fingerprint,t.upperBound);break}case"payload":{e=this.encoding.encode.payload(t.payload,t.end);break}case"emptyPayload":{e=this.encoding.encode.emptyPayload(t.upperBound);break}case"terminal":{e=this.encoding.encode.terminal();break}}return e}respond(t){if(this.isDone().state==="fulfilled")return[];let e=this.decode(t),n=this.collatePayloads(e);if(n===void 0)return[];let r=this.process(n||[]),i=[];for(let u of r){let a=this.consolidateAdjacentDones(u);a&&i.push(...a)}for(let u of i)this.checkIsDone(u);let s=[];for(let u of i)s.push(this.encode(u));return s}isDone(){return this.isDoneTee.tee()}initialMessages(t){let{tree:e,encoding:n,payloadThreshold:r,rangeDivision:i}=this;function*s(){if(e.size===0){yield n.encode.emptySet(!0);return}let u=e.getLowestValue();yield n.encode.lowerBound(u);let{items:a}=e.getFingerprint(u,u),o=(t||(c=>{let h=Math.ceil(c.length/i),f=[];for(let d=0;d<c.length;d+=h){let p=c.slice(d,d+h);f.push(p)}return f}))(a),l;for(let c=0;c<o.length;c++){let h=o[c+1]?o[c+1][0]:u,f=o[c];if(f.length<=r)for(let d=0;d<f.length;d++)yield n.encode.payload(f[d],d===f.length-1?{upperBound:h,canRespond:!0}:void 0);else{let d=f[0],{fingerprint:p,nextTree:D}=e.getFingerprint(d,h,l);l=D||void 0,yield n.encode.fingerprint(p,h)}}yield n.encode.terminal()}return s()}onInsertion(t){return this.insertionCallbacks.add(t),()=>{this.insertionCallbacks.delete(t)}}},vs=Symbol("Stream ended."),oi=Symbol("Stream errored."),zt,pn,kt,gr,xi,On,$r,oa,qt=(oa=class{constructor(t){tt(this,gr);tt(this,On);tt(this,zt,void 0);tt(this,pn,void 0);tt(this,kt,void 0);var e,n,r;de(this,zt,[]),de(this,pn,null),this.push=(...i)=>{i.length?Fn(this,On,$r).call(this,!1,i):(Fn(this,On,$r).call(this,!1,[oi]),Fn(this,gr,xi).call(this,new Error("AsyncQueueError: queue.push was called with no arguments")))},this.close=({immediately:i=!1,withError:s}={})=>{s&&Fn(this,gr,xi).call(this,s),Fn(this,On,$r).call(this,i,[s?oi:vs]),this.push=this.close=()=>{}},(r=(n=(e=t==null?void 0:t.catch)==null?void 0:e.call(t,i=>this.close({withError:i})))==null?void 0:n.finally)==null||r.call(n,()=>this.close())}get length(){return H(this,zt).length}async*[Symbol.asyncIterator](){for(;;){let t=H(this,zt).length?H(this,zt).shift():await new Promise(e=>{de(this,pn,e)});if(t===oi)throw H(this,kt);if(t===vs)break;yield t}}},zt=new WeakMap,pn=new WeakMap,kt=new WeakMap,gr=new WeakSet,xi=function(t){H(this,kt)instanceof AggregateError?H(this,kt).errors.push(t):H(this,kt)?de(this,kt,new AggregateError([H(this,kt),t])):de(this,kt,t)},On=new WeakSet,$r=function(t,e){var n;H(this,zt)[t?"unshift":"push"](...e),(n=H(this,pn))==null||n.call(this,H(this,zt).shift()),de(this,pn,null)},oa);function G(){let t,e="pending",n=new Promise((r,i)=>{t={async resolve(s){await s,e="fulfilled",r(s)},reject(s){e="rejected",i(s)}}});return Object.defineProperty(n,"state",{get:()=>e}),Object.assign(n,t)}new TextDecoder;var dc=new TextEncoder;function Ii(t){return dc.encode(t)}function pc(t){return Ii(t).length}function Ti(t,e){for(let n of t)if(e.indexOf(n)===-1)return!1;return!0}function Bs(t){return t===""?!1:_r.indexOf(t)!==-1}var qn="abcdefghijklmnopqrstuvwxyz",Dc=qn.toUpperCase(),_r="0123456789",jt=qn+"234567",va=qn+_r,mc=jt,Ba=va+jt+"@.",Sa=qn+_r,gc=qn+_r,xa=Sa+jt+"+.",wc="/'()-._~!$&+,:=@%",Ia=qn+Dc+_r+wc;function bc(t,e){return`@${t}.${e}`}function yc(t,e){return`+${t}.${e}`}function Xi(t){let e=Ta(t);return da(e)?!0:e}function Cr(t){let e=$a(t);return da(e)?!0:e}function $i(t){return t.startsWith("@")?Ta(t):t.startsWith("+")?$a(t):new M("address must start with either @ or +")}function Ta(t){return Ra(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:va,allowedPubkeyCharacters:mc,pubkeyMustStartWithB:!0})}function $a(t){return Ra(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:Sa,allowedPubkeyCharacters:gc,pubkeyMustStartWithB:!1})}function Ra(t,e){let{sigil:n,separator:r,minNameLength:i,maxNameLength:s,minPubkeyLength:u,maxPubkeyLength:a,allowedNameCharacters:o,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof t!="string")return new M("address must be a string");if(t.length<4)return new M("address is too short");if(t[0]!==n)return new M(`address must start with a sigil: "${n}"`);if(t.indexOf(r)===-1)return new M(`address must contain a separator character: "${r}"`);let h=t.slice(1).split(r);if(h.length!==2)return new M(`address must have exactly 2 parts separated by a "${r}" separator`);let[f,d]=h;return f.length<i||f.length>s?new M(`name must be between ${i} and ${s} characters long, but is ${f.length}`):d.length<u||d.length>a?new M(`pubkey must be between ${u} and ${a} characters long, but is ${d.length}`):Ti(f,o)?Ti(d,l)?Bs(f[0])?new M(`name "${f}" must not start with a digit`):Bs(d[0])?new M(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new M(`pubkey "${d}" must start with 'b'`):{address:t,name:f,pubkey:d}:new M(`pubkey "${d}" must only have allowed characters`):new M(`name "${f}" must only have allowed characters`)}function Yi(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function Pa(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function rt(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let n=pc(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&n<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&n>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&n!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!Ti(e,t.allowedChars)?"contains disallowed characters":null}}function ar(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function Ma(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!Yi(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[n,r]of Object.entries(e))if(r===void 0)return`${n} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let n=Object.keys(e),r=Object.keys(t.objSchema),i=n.filter(s=>r.indexOf(s)===-1);if(i.length>0)return`object has extra keys not in the schema: ${i.join(", ")}`}for(let[n,r]of Object.entries(t.objSchema)){let i=r(e[n]);if(i!==null)return`${n}: ${i}`}}return null}}var{codec:Oa}=ma,Na={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function vn(t){return"b"+Oa.stringify(t,Na,{pad:!1})}function Hr(t){if(!t.startsWith("b"))throw new M("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new M("can't decode base32 string - it contains padding characters ('=')");return Oa.parse(t.slice(1),Na,{loose:!0})}var Ac=(t=>(t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug",t))(Ac||{}),_c=0,li={_default:_c};function Cc(t){return t in li?li[t]:li._default}var We=class{constructor(e,n){this.color=void 0,this.source=e,this.color=n||"aqua"}_print(e,n,r,...i){if(e<=Cc(this.source))if(n){let s=`[${this.source}]`;if(this.color!==void 0){let u=[`%c ${s}`,`color: ${this.color}`];console.log(r,...u,...i)}else console.log(r,s,...i)}else console.log(r,...i)}error(...e){this._print(0,!0,"!!",...e)}warn(...e){this._print(1,!0,"! ",...e)}log(...e){this._print(2,!0,"  ",...e)}info(...e){this._print(3,!0,"    ",...e)}debug(...e){this._print(4,!0,"      ",...e)}blank(){this._print(3,!1,"")}},Ec=class{constructor(t){this.hash=t.hash,this.internalUpdate=t.update,this.internalDigest=t.digest}update(t){return this.hash=this.internalUpdate(this.hash,t),this.hash}digest(){return this.internalDigest(this.hash)}},{createHash:ci}=wa,hi=new We("crypto-driver-noble","cyan"),Fc=class{static sha256(t){return typeof t=="string"?Promise.resolve(ci("sha256").update(t,"utf-8").digest()):Promise.resolve(ci("sha256").update(t).digest())}static updatableSha256(){return new Ec({hash:ci("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){hi.debug("generateKeypairBytes");let t=rr.utils.randomPrivateKey();return{pubkey:await rr.getPublicKey(t),secret:t}}static sign(t,e){return hi.debug("sign"),typeof e=="string"&&(e=Ii(e)),rr.sign(e,t.secret)}static async verify(t,e,n){hi.debug("verify");try{return typeof n=="string"&&(n=Ii(n)),await rr.verify(e,n,t)}catch{return!1}}};function Ss(){return Date.now()*1e3}function La(t){return new Promise(e=>{setTimeout(e,t)})}function Wt(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function kc(t){try{let e=Ua(t)?t.address:t.shareAddress,n=$i(e);if(P(n))return n;let r={pubkey:Hr(n.pubkey),secret:Hr(t.secret)};return r.pubkey.length!==32?new M(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new M(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new M("crash while decoding author keypair: "+e.message)}}function Ua(t){return"address"in t}var vc=Fc;new We("crypto","cyan");var Bn=vc,Zn=new We("crypto","cyan"),Ie=class{static async sha256base32(e){let n=await Bn.sha256(e);return vn(n)}static updatableSha256(){return Bn.updatableSha256()}static async generateAuthorKeypair(e){Zn.debug(`generateAuthorKeypair("${e}")`);let n=await Bn.generateKeypairBytes(),r={address:bc(e,vn(n.pubkey)),secret:vn(n.secret)},i=Xi(r.address);return P(i)?i:r}static async generateShareKeypair(e){Zn.debug(`generateAuthorKeypair("${e}")`);let n=await Bn.generateKeypairBytes(),r={shareAddress:yc(e,vn(n.pubkey)),secret:vn(n.secret)},i=Cr(r.shareAddress);return P(i)?i:r}static async sign(e,n){Zn.debug("sign");try{let r=kc(e);if(P(r))return r;let i=await Bn.sign(r,n);return vn(i)}catch(r){return new M("unexpected error while signing: "+r.message)}}static verify(e,n,r){Zn.debug("verify");try{let i=$i(e);return P(i)?Promise.resolve(!1):Bn.verify(Hr(i.pubkey),Hr(n),r)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(e){Zn.debug("checkAuthorKeypairIsValid");let n=Ua(e)?e.address:e.shareAddress;try{if(typeof n!="string"||typeof e.secret!="string")return new M("address and secret must be strings");let r=$i(n);if(P(r))return r;let i="a test message to sign. "+Wt(),s=await this.sign(e,i);return P(s)?s:await this.verify(n,s,i)===!1?new M("pubkey does not match secret"):!0}catch(r){return new M("unexpected error in checkAuthorKeypairIsValid: "+r.message)}}};new We("validator es.4","red");var Bc=10,Sc=Bc*60*1e3*1e3,xs=1e13,Is=9007199254740990,xc=4e6,Ic=53,Tc=104,Ts={objSchema:{format:Pa("es.4"),author:rt({allowedChars:Ba}),content:rt({maxLen:xc}),contentHash:rt({allowedChars:jt,len:Ic}),deleteAfter:ar({min:xs,max:Is,nullable:!0}),path:rt({allowedChars:Ia,minLen:2,maxLen:512}),signature:rt({allowedChars:jt,len:Tc}),timestamp:ar({min:xs,max:Is}),workspace:rt({allowedChars:xa})},allowLiteralUndefined:!1,allowExtraKeys:!1},fi;fi=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return P(n)?Promise.resolve(n):Ie.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r}){let i={format:"es.4",author:e.address,content:t.content,contentHash:await Ie.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:n,signature:"?"},s=await this.signDocument(e,i);return P(s)?s:{doc:s}}static async signDocument(t,e){let n=await this.hashDocument(e);if(P(n))return n;let r=await Ie.sign(t,n);return P(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;let n=this.removeExtraFields(e);if(P(n))return n;let r={...n.doc,content:"",contentHash:await Ie.sha256base32(""),signature:"?"};return this.signDocument(t,r)}static removeExtraFields(t){if(!Yi(t))return new M("doc is not a plain javascript object");let e=new Set(Object.keys(Ts.objSchema||{})),n={},r={};for(let[i,s]of Object.entries(t))if(e.has(i))n[i]=s;else{if(!i.startsWith("_"))return new M("extra document fields must have names starting with an underscore");r[i]=s}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let n=this._checkBasicDocumentValidity(t);if(P(n))return n;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(P(r))return r;let i=this._checkAuthorCanWriteToPath(t.author,t.path);if(P(i))return i;let s=this._checkPathIsValid(t.path,t.deleteAfter);if(P(s))return s;let u=Xi(t.author);if(P(u))return u;let a=Cr(t.workspace);if(P(a))return a;let o=await this._checkAuthorSignatureIsValid(t);if(P(o))return o;let l=await this._checkContentMatchesHash(t.content,t.contentHash);return P(l)?l:!0}static _checkBasicDocumentValidity(t){let e=Ma(Ts)(t);return e!==null?new M(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new M(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+Sc)return new M("timestamp too far in the future");if(e!==null){if(n>e)return new M("ephemeral doc has expired");if(e<=t)return new M("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new M("invalid path: must start with /");if(t.endsWith("/"))return new M("invalid path: must not end with /");if(t.startsWith("/@"))return new M('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new M("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new M("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new M("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return P(e)?e:await Ie.verify(t.author,t.signature,e)!==!0?new M("signature is invalid"):!0}catch{return new M("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Ie.sha256base32(t)!==e?new M("content does not match contentHash"):!0}static getAttachmentInfo(t){return new M("es.4 does not support attachments")}static updateAttachmentFields(t,e,n,r){return Promise.resolve(new M("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},fi.id="es.4";new We("validator es.5","red");var $c=10,Rc=$c*60*1e3*1e3,$s=1e13,Rs=9007199254740990,Pc=8e3,Ps=53,Ms=104,Mc=0,Oc=Number.MAX_SAFE_INTEGER,Os={objSchema:{format:Pa("es.5"),author:rt({allowedChars:Ba}),text:rt({maxLen:Pc}),textHash:rt({allowedChars:jt,len:Ps}),deleteAfter:ar({min:$s,max:Rs,optional:!0}),path:rt({allowedChars:Ia,minLen:2,maxLen:512}),signature:rt({allowedChars:jt,len:Ms}),shareSignature:rt({allowedChars:jt,len:Ms}),timestamp:ar({min:$s,max:Rs}),share:rt({allowedChars:xa}),attachmentSize:ar({min:Mc,max:Oc,optional:!0}),attachmentHash:rt({allowedChars:jt,len:Ps,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1},di,Nc=(di=class{static hashDocument(t){let e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return P(n)?Promise.resolve(n):Ie.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r,prevLatestDoc:i,config:s}){if(t.text===void 0&&(i==null?void 0:i.text)===void 0)return new M("Couldn't determine document text from given input or previous version's text.");let u=t.text!==void 0?t.text:i==null?void 0:i.text,a={...i,format:"es.5",author:e.address,text:u,textHash:await Ie.sha256base32(u),path:t.path,timestamp:r,share:n,signature:"?",shareSignature:"?"};t.deleteAfter&&(a.deleteAfter=t.deleteAfter);let o=await this.signDocument(e,a,s);return P(o)?o:t.attachment?{doc:o,attachment:t.attachment}:{doc:o}}static async signDocument(t,e,n){let r=await this.hashDocument(e);if(P(r))return r;let i=await Ie.sign(t,r);if(n.shareSecret===void 0)return new Xe(`Tried to write a document to ${e.share} without the secret.`);let s=await Ie.sign({shareAddress:e.share,secret:n.shareSecret},r);return P(i)?i:P(s)?s:{...e,signature:i,shareSignature:s}}static async wipeDocument(t,e,n){if(e.text.length===0)return e;let r=this.removeExtraFields(e);if(P(r))return r;let i=r.doc;if(i.attachmentHash){let u={...i,text:"",textHash:await Ie.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Ie.sha256base32(""),attachmentSize:0};return this.signDocument(t,u,n)}let s={...i,text:"",textHash:await Ie.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,s,n)}static removeExtraFields(t){if(!Yi(t))return new M("doc is not a plain javascript object");let e=new Set(Object.keys(Os.objSchema||{})),n={},r={};for(let[i,s]of Object.entries(t))if(e.has(i))n[i]=s;else{if(!i.startsWith("_"))return new M("extra document fields must have names starting with an underscore");r[i]=s}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);let n=this._checkBasicDocumentValidity(t);if(P(n))return n;let r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(P(r))return r;let i=this._checkAuthorCanWriteToPath(t.author,t.path);if(P(i))return i;let s=this._checkAttachmentFieldsConsistent(t);if(P(s))return s;let u=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(P(u))return u;let a=Xi(t.author);if(P(a))return a;let o=Cr(t.share);if(P(o))return o;let l=await this._checkAuthorSignatureIsValid(t);if(P(l))return l;let c=await this._checkShareSignatureIsValid(t);if(P(c))return c;let h=await this._checkContentMatchesHash(t.text,t.textHash);return P(h)?h:!0}static _checkBasicDocumentValidity(t){let e=Ma(Os)(t);return e!==null?new M(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new M("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new M("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new M("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new M(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+Rc)return new M("timestamp too far in the future");if(e!==null){if(n>e)return new M("ephemeral doc has expired");if(e<=t)return new M("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,n){if(!t.startsWith("/"))return new M("invalid path: must start with /");if(t.endsWith("/"))return new M("invalid path: must not end with /");if(t.startsWith("/@"))return new M('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new M("invalid path: must not contain two consecutive slashes");if(n!==void 0){if(t.indexOf("!")===-1&&n!==null)return new M("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&n===null)return new M("when deleteAfter is null, path must not contain '!'")}return!Ns(t)&&e?new M("when a attachment is provided, the path must end with a file extension"):Ns(t)&&e===!1?new M("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{let e=await this.hashDocument(t);return P(e)?e:await Ie.verify(t.author,t.signature,e)!==!0?new M("signature is invalid"):!0}catch{return new M("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{let e=await this.hashDocument(t);return P(e)?e:await Ie.verify(t.share,t.shareSignature,e)!==!0?new M("share signature is invalid"):!0}catch{return new M("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Ie.sha256base32(t)!==e?new M("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new M("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new M("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,n,r,i){let s={...e,attachmentHash:r,attachmentSize:n};return this.signDocument(t,s,i)}static authorFromCredentials(t){return t.address}},di.id="es.5",di),Lc=/^.*\.(\w+)$/,Uc=/^.*~@\w{4}\.\w{53}$/;function Ns(t){if(t.indexOf(".")===-1)return!1;let e=t.match(Lc);return!(e===null||e[1].length===53&&t.match(Uc))}var vt=Nc,Xr=[vt];function Ls(t){return t||vt}function Nn(t){return t||Xr}function zc(t,e){let n=[];for(let r of e)t.includes(r.id)&&n.push(r);return n}function Ln(t){let e=t||Xr,n={};for(let r of e)n[r.id]=r;return n}var Yr=class{constructor(){this.deferreds=new Set,this.state="pending"}resolve(t){if(this.state==="pending"){this.state="fulfilled";for(let e of this.deferreds)e.resolve(t)}}reject(t){if(this.state==="pending"){this.state="rejected";for(let e of this.deferreds)e.reject(t)}}getPromise(){let t=G();return this.state==="fulfilled"?t.resolve():this.state==="rejected"?t.reject():this.deferreds.add(t),t}},dr=class{constructor(t=!1){this.promises=new Set,this.sealed=!1,this.multiDeferred=new Yr,this.allowRejectedPromises=t}enrol(t){if(this.sealed)throw new Xe("Tried to enrol a promise when enrolment was already sealed.");this.promises.add(t),t.then(()=>{this.checkAllDone()}).catch(e=>{if(!this.allowRejectedPromises)throw e})}checkAllDone(){!this.sealed||(this.allowRejectedPromises?Promise.allSettled(this.promises).then(()=>{this.multiDeferred.resolve()}):Promise.all(this.promises).then(()=>{this.multiDeferred.resolve()}).catch(()=>{this.multiDeferred.reject()}))}seal(){this.sealed||(this.sealed=!0,this.checkAllDone())}isSealed(){return this.sealed}isDone(){return this.multiDeferred.getPromise()}},Hc=class{constructor(){this.closed=!1,this.transform=new TransformStream({transform(t,e){e.enqueue(t)}}),this.writer=this.transform.writable.getWriter(),this.readable=this.transform.readable,this.writables=[]}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){this.checkClosed();let t=this.writer,e=new WritableStream({async write(n){await t.ready,await t.write(n)}});return this.writables.push(e),e}async close(){this.checkClosed();for(let t of this.writables)await t.abort();this.transform.writable.abort(),this.closed=!0}isClosed(){return this.closed}},qc=class{constructor(){this.transformStream=new TransformStream(new Vc),this.sourceReadable=this.transformStream.readable,this.writable=this.transformStream.writable}getReadableStream(){let[t,e]=this.sourceReadable.tee();return this.sourceReadable=t,e}},jc=class{constructor(){this.closed=!1,this.subscribers=[],this.writables=[];let t=this.subscribers;this.writable=new WritableStream({write(e){let n=t.map(({writer:r})=>new Promise(i=>{r.ready.then(()=>{r.write(e).then(i)})}));Promise.all(n)}})}checkClosed(){if(this.closed)throw"Closed"}getReadableStream(){this.checkClosed();let t=new TransformStream({transform(e,n){n.enqueue(e)}});return this.subscribers.push({transform:t,writer:t.writable.getWriter()}),t.readable}async close(){this.checkClosed();for(let t of this.writables)await t.abort();for(let{transform:t}of this.subscribers)await t.writable.abort(),await t.readable.cancel();this.closed=!0}isClosed(){return this.closed}},Wc=class{constructor(t){this.closed=!1,this.combineStream=new Hc,t?this.cloneStream=new jc:this.cloneStream=new qc,this.combineStream.readable.pipeTo(this.cloneStream.writable)}checkClosed(){if(this.closed)throw"Closed"}getWritableStream(){return this.combineStream.getWritableStream()}getReadableStream(){return this.cloneStream.getReadableStream()}close(){this.checkClosed(),this.combineStream.close(),this.closed=!0}isClosed(){return this.closed}},za=class{constructor(){this.callbacks=new Set}onWrite(t){return this.callbacks.add(t),()=>{this.callbacks.delete(t)}}async write(t){for(let e of this.callbacks)await e(t)}close(){this.callbacks.clear()}},An=class{constructor(){this.callbacks=new Set,this.lock=new Ha}on(t){return this.callbacks.add(t),()=>{this.callbacks.delete(t)}}async send(t){for(let e of this.callbacks)await this.lock.run(()=>e(t))}},Vc=class{transform(t,e){e.enqueue(t)}},Ha=class{constructor(){this.doneEnroller=new dr,this.writable=new WritableStream({async write(t){await t()}}),this.writer=this.writable.getWriter(),this.closed=!1}checkClosed(){if(this.closed)throw"Closed"}async run(t){this.checkClosed(),await this.writer.ready;let e=this.writer.write(t);return this.doneEnroller.enrol(e),e}async close(){this.checkClosed(),this.doneEnroller.seal(),await this.doneEnroller.isDone(),this.writer.releaseLock(),await this.writable.abort(),this.closed=!0}isClosed(){return this.closed}},Qc=class{constructor(t,e){this.channel=t,this.channelKey=e}transform(t,e){if(this.channel==="*"||this.channel===t[this.channelKey]){e.enqueue(t);return}}},Kc=class{constructor(t,e){this.multistream=new Wc(e),this.channelKey=t}getWritableStream(){return this.multistream.getWritableStream()}getReadableStream(t){let e=new TransformStream(new Qc(t,this.channelKey));return this.multistream.getReadableStream().pipeThrough(e)}};function Gc(t,e){let n=G(),r=G(),i=()=>{if(r.state==="pending"){let s;t instanceof WebSocket?s=t:s=new WebSocket(t),r.resolve(s),s.binaryType="arraybuffer",s.readyState===s.OPEN&&n.resolve(),s.onopen=()=>{n.resolve()}}};return new WritableStream({async write(s,u){i();let a=await r;await n;try{let o=e(s);a.send(o)}catch(o){u.error(o)}a.onclose=()=>{u.error("Socket closed before we were done")}},async close(){i();let s=await r;await n,s.close()},async abort(){i();let s=await r;await n,s.close()}})}function Zc(t,e){let n=G(),r=!1,i=()=>{if(n.state==="pending")if(t instanceof WebSocket)n.resolve(t);else try{let s=new WebSocket(t);n.resolve(s)}catch(s){n.reject(s)}};return new ReadableStream({async start(s){i();let u=await n;u.binaryType="arraybuffer",u.onmessage=a=>{let o=e(a);try{s.enqueue(o)}catch{}},u.onclose=()=>{if(!r)try{s.close()}catch{}},u.onerror=a=>{r=!0,s.error(a)}},async cancel(){i(),(await n).close()}})}function Xc(t){let e=t.toString(16);return e.length%2&&(e="0"+e),e}function Yc(t){return BigInt("0x"+t)}var Jc={encode:{emptySet:t=>({type:"EMPTY_SET",canRespond:t}),lowerBound:t=>({type:"LOWER_BOUND",value:t}),payload:(t,e)=>({type:"PAYLOAD",payload:t,...e?{end:e}:{}}),emptyPayload:t=>({type:"EMPTY_PAYLOAD",upperBound:t}),done:t=>({type:"DONE",upperBound:t}),fingerprint:(t,e)=>({type:"FINGERPRINT",fingerprint:Xc(t),upperBound:e}),terminal:()=>({type:"TERMINAL"})},decode:{emptySet:t=>{if(t.type==="EMPTY_SET")return t.canRespond;throw"Can't decode"},lowerBound:t=>{if(t.type==="LOWER_BOUND")return t.value;throw"Can't decode"},payload:t=>{if(t.type==="PAYLOAD")return{value:t.payload,...t.end?{end:t.end}:{}};throw"Can't decode"},emptyPayload:t=>{if(t.type==="EMPTY_PAYLOAD")return t.upperBound;throw"Can't decode"},done:t=>{if(t.type==="DONE")return t.upperBound;throw"Can't decode"},fingerprint:t=>{if(t.type==="FINGERPRINT")return{fingerprint:Yc(t.fingerprint),upperBound:t.upperBound};throw"Can't decode"},terminal:t=>{if(t.type==="TERMINAL")return!0;throw"Can't decode"}}},eh=class extends fc{constructor(t,e,n){super({tree:t,encoding:Jc,fingerprintEquals:(r,i)=>r===i,payloadThreshold:e,rangeDivision:n})}},th=class{constructor(t){this.statusBus=new An,this.isDoneMultiDeferred=new Yr,this.inboundEventQueue=new qt,this.outboundEventQueue=new qt,this.gossiperInboundQueue=new qt,this.reconcilerInboundQueue=new qt,this.hasPrepared=G(),this.hasReconciled=G(),this.hasCheckedAllExistingDocsForAttachments=G(),this.requestedCount=0,this.sentDocsCount=0,this.receivedDocsCount=0,this.counterpartId=Wt(),this.replica=t.replica,t.replica.onEvent(i=>{i.kind==="willClose"&&this.cancel()});let{treeIsReady:e}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,Nn(t.formats));e.then(()=>{this.hasPrepared.resolve()}),(async()=>{for await(let i of this.inboundEventQueue)switch(i.kind){case"RANGE_MSG":{this.reconcilerInboundQueue.push(i.message);break}default:this.gossiperInboundQueue.push(i)}})(),new ih({outboundEventQueue:this.outboundEventQueue,formats:t.formats,replica:t.replica,counterpartId:this.counterpartId,transferManager:t.transferManager,hasCheckedAllExistingDocsForAttachments:this.hasCheckedAllExistingDocsForAttachments});let n=new sh,r=new rh({inboundEventQueue:this.reconcilerInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:t.syncerManager,formats:t.formats,replica:t.replica,initiateMessaging:t.initiateMessaging,wantTracker:n,payloadThreshold:t.payloadThreshold,rangeDivision:t.rangeDivision,onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}});r.isDone.then(()=>{this.hasReconciled.resolve()}),new nh({inboundEventQueue:this.gossiperInboundQueue,outboundEventQueue:this.outboundEventQueue,syncerManager:t.syncerManager,formats:t.formats,replica:t.replica,counterpartId:this.counterpartId,transferManager:t.transferManager,cancel:this.cancel.bind(this),reconciliationIsDone:r.isDone,wantTracker:n,syncAppetite:t.syncAppetite,onDocReceived:async()=>{this.receivedDocsCount++,await this.statusBus.send(this.getStatus())},onDocSent:async()=>{this.sentDocsCount++,await this.statusBus.send(this.getStatus())},onDocRequested:async()=>{this.requestedCount++,await this.statusBus.send(this.getStatus())}}).isDone.then(async()=>{await this.hasCheckedAllExistingDocsForAttachments,this.isDoneMultiDeferred.resolve()}),this.statusBus.send(this.getStatus())}sendEvent(t){return this.inboundEventQueue.push(t)}events(){return this.outboundEventQueue}getStatus(){return{requestedCount:this.requestedCount,receivedCount:this.receivedDocsCount,sentCount:this.sentDocsCount,status:this.isDoneMultiDeferred.state==="rejected"?"aborted":this.hasPrepared.state==="pending"?"preparing":this.hasReconciled.state==="pending"?"reconciling":this.isDoneMultiDeferred.state==="fulfilled"?"done":"gossiping"}}onStatusUpdate(t){return this.statusBus.on(t)}async cancel(t){this.isDoneMultiDeferred.state==="fulfilled"||this.isDoneMultiDeferred.state==="rejected"||(this.isDoneMultiDeferred.reject(),await this.statusBus.send(this.getStatus()),this.outboundEventQueue.push({kind:"ABORT"}),this.outboundEventQueue.close(),this.inboundEventQueue.close({immediately:!0}),this.gossiperInboundQueue.close({immediately:!0}),this.reconcilerInboundQueue.close({immediately:!0}))}isDone(){return this.isDoneMultiDeferred.getPromise()}},nh=class{constructor(t){this.isPartnerFulfilled=G(),this.isFulfilled=G();let e=Ln(t.formats),n=t.syncerManager.getPlumTree(t.replica.share);if(t.syncAppetite==="continuous"){let s=t.replica.getQueryStream(void 0,"new",t.formats),u=new Zi;s.pipeTo(new WritableStream({async write(a){if(a.kind==="success"&&a.sourceId!==t.counterpartId){let o=n.getMode(a.sourceId);u.reset(),u.update(`${a.doc.path} ${a.doc.author}`);let l=u.digest().toString(16),c=`${a.doc.timestamp} ${l}`;if(o==="EAGER"){let h=e[a.doc.format],f=h.getAttachmentInfo(a.doc),d=!P(f),p=!1;d&&await t.replica.getAttachment(a.doc,h)&&(p=!0),t.outboundEventQueue.push({kind:"DOC",thumbnail:c,doc:a.doc,attachmentHeld:p}),t.onDocSent()}else t.outboundEventQueue.push({kind:"HAVE",thumbnail:c})}}})).catch(()=>{})}let r=t.replica.onEvent(s=>{s.kind==="attachment_ingest"&&s.sourceId!==t.counterpartId&&t.outboundEventQueue.push({kind:"NEW_ATTACHMENT",path:s.doc.path,author:s.doc.author,format:s.doc.format,hash:s.hash})}),{lookup:i}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,Nn(t.formats));(async()=>{for await(let s of t.inboundEventQueue)switch(s.kind){case"PRUNE":{n.onPrune(t.counterpartId);break}case"HAVE":{if(t.reconciliationIsDone.state==="fulfilled"&&t.syncAppetite==="once")break;t.wantTracker.addWantedThumbnail(s.thumbnail),n.onLazyMessage(s,u=>{t.outboundEventQueue.push({kind:"WANT",thumbnail:u})}),t.onDocRequested();break}case"WANT":{n.onGraftMessage(t.counterpartId);let[,u]=s.thumbnail.split(" "),a=i[u];if(!a)return;let[,o,l]=a,c=(await t.replica.getAllDocsAtPath(o,t.formats)).find(h=>h.author===l);if(c){let h=e[c.format],f=h.getAttachmentInfo(c),d=!P(f),p=!1;d&&await t.replica.getAttachment(c,h)&&(p=!0),t.outboundEventQueue.push({kind:"DOC",thumbnail:s.thumbnail,doc:c,attachmentHeld:p}),await t.onDocSent()}else console.error("Got a WANT event for a document not on record.");break}case"DOC":{if(this.isFulfilled.state==="fulfilled"&&t.syncAppetite==="once"||(n.onEagerMessage(t.counterpartId,s)&&t.outboundEventQueue.push({kind:"PRUNE"}),t.wantTracker.isReceived(s.thumbnail)))break;let u=e[s.doc.format];if(!u){console.error(`Was sent a doc with a format we don't know about (${s.doc.format})`);break}if(s.attachmentHeld&&await t.replica.getAttachment(s.doc,e[s.doc.format])===void 0){let a=await t.transferManager.handleDownload(s.doc,t.replica,t.counterpartId);if(P(a)){let o=u.getAttachmentInfo(s.doc);t.transferManager.registerExpectedTransfer(t.replica.share,o.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:o.hash,doc:s.doc,shareAddress:t.replica.share})}}await t.replica.ingest(u,s.doc,t.counterpartId),t.wantTracker.receivedWantedThumbnail(s.thumbnail),await t.onDocReceived();break}case"NEW_ATTACHMENT":{if(t.transferManager.isAlreadyQueued(s.hash,"download"))break;let u=e[s.format],a=(await t.replica.getAllDocsAtPath(s.path,[u])).find(o=>s.author===o.author);if(!a)break;if(await t.replica.getAttachment(a,e[a.format])===void 0){let o=await t.transferManager.handleDownload(a,t.replica,t.counterpartId);if(P(o)){let l=u.getAttachmentInfo(a);t.transferManager.registerExpectedTransfer(t.replica.share,l.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:l.hash,doc:a,shareAddress:t.replica.share})}}break}case"FULFILLED":this.isPartnerFulfilled.resolve(!0);break;case"WANT_ATTACHMENT":t.transferManager.handleUpload(s,t.replica);break;case"ABORT":await t.cancel()}})(),t.reconciliationIsDone.then(async()=>{t.syncAppetite==="once"&&(r(),t.wantTracker.seal(),await t.wantTracker.isDone(),t.outboundEventQueue.push({kind:"FULFILLED"}),this.isFulfilled.resolve())})}get isDone(){return Promise.all([this.isPartnerFulfilled,this.isFulfilled])}},rh=class{constructor(t){this.communicationRoundsCount=0,this.isDone=G();let{tree:e,lookup:n,treeIsReady:r}=t.syncerManager.getDocThumbnailTreeAndDocLookup(t.replica.share,Nn(t.formats));t.initiateMessaging&&r.then(()=>{for(let s of i.initialMessages(u=>{let a=Date.now()-6048e5,o=u.findIndex(c=>{let[h]=c.split(" ");return parseInt(h)/1e3>a});if(o>0&&o>u.length/2)return[u.slice(0,o),u.slice(o)];let l=Math.round(u.length/2);return[u.slice(0,l),u.slice(l)]}))t.outboundEventQueue.push({kind:"RANGE_MSG",message:s})});let i=new eh(e,t.payloadThreshold,t.rangeDivision);i.onInsertion(s=>{let[u,a]=s.split(" "),o=n[a];o&&o[0]>=parseInt(u)||(t.wantTracker.addWantedThumbnail(s),t.outboundEventQueue.push({kind:"WANT",thumbnail:s}),t.onDocRequested())}),(async()=>{await r;for await(let s of t.inboundEventQueue){if(this.isDone.state==="fulfilled")return;s.type==="TERMINAL"&&this.communicationRoundsCount++;let u=i.respond(s);for(let a of u)t.outboundEventQueue.push({kind:"RANGE_MSG",message:a})}})(),i.isDone().then(()=>{this.isDone.resolve(this.communicationRoundsCount)})}},ih=class{constructor(t){let e=t.replica.getQueryStream({orderBy:"localIndex ASC"},"existing",t.formats),n=Ln(t.formats),r=t.transferManager.handleDownload.bind(t.transferManager);e.pipeTo(new WritableStream({start(i){t.replica.onEvent(s=>{s.kind==="willClose"&&i.error()})},async write(i){if(i.kind==="existing"||i.kind==="success"){let s=n[i.doc.format],u=await t.replica.getAttachment(i.doc,s);if(P(u))return;if(u===void 0){let a=await r(i.doc,t.replica,t.counterpartId);if(P(a)){let o=s.getAttachmentInfo(i.doc);t.transferManager.registerExpectedTransfer(t.replica.share,o.hash),t.outboundEventQueue.push({kind:"WANT_ATTACHMENT",attachmentHash:o.hash,doc:i.doc,shareAddress:t.replica.share})}}}}})).then(()=>{t.hasCheckedAllExistingDocsForAttachments.resolve()}).catch(()=>{t.hasCheckedAllExistingDocsForAttachments.resolve()})}},sh=class{constructor(){this.isSealed=!1,this.wantedThumbnails=new Map,this.enroller=new dr,this.received=0,this.id=Wt()}addWantedThumbnail(t){if(!this.isSealed&&!this.wantedThumbnails.has(t)){let e=G();this.wantedThumbnails.set(t,e),this.enroller.enrol(e)}}receivedWantedThumbnail(t){let e=this.wantedThumbnails.get(t);e&&(e.resolve(),this.received++)}isRequested(t){return this.wantedThumbnails.has(t)}isReceived(t){let e=this.wantedThumbnails.get(t);return e?e.state==="fulfilled":!1}seal(){this.enroller.seal()}isDone(){return this.enroller.isDone()}get requestedCount(){return this.wantedThumbnails.size}get receivedCount(){return this.received}},qa=class{constructor(t,e){this.closed=!1,this.cb=t,this.ms=e,this.timeout=setTimeout(t,e)}bump(){this.closed||(clearTimeout(this.timeout),this.timeout=setTimeout(this.cb,this.ms))}close(){this.closed=!0,clearTimeout(this.timeout)}},pi=class{constructor({stream:t,replica:e,doc:n,format:r,requester:i,counterpartId:s}){this.status="ready",this.loaded=0,this.statusBus=new An,this.transferOp=G(),this.multiDeferred=new Yr,this.sourceDoc=n,this.share=e.share,this.requester=i;let u=r.getAttachmentInfo(n);if(P(u))throw new M("AttachmentTransfer was given a doc which has no attachment!");this.hash=u.hash,this.expectedSize=u.size;let a=this.updateLoaded.bind(this);if(t instanceof ReadableStream){this.kind="download";let o;this.abortCb=()=>{o?o.cancel():t.cancel()};let l=null,c=new ReadableStream({async start(h){let f=t.getReader();for(o=f,l=new qa(()=>{h.error("Attachment download timed out.")},1e4);;){let{done:d,value:p}=await f.read();if(l.bump(),d)break;a(p.byteLength),h.enqueue(p)}l.close(),h.close()}});this.transferOp.resolve(()=>{let h=G();return e.ingestAttachment(r,n,c,s).then(f=>{if(P(f)&&this.loaded===0){this.changeStatus("missing_attachment");return}if(P(f)){console.warn(`Couldn't ingest the attachment for ${n.path} by ${n.author}: ${f.message}`),h.reject(f);return}h.resolve()}).catch(f=>{h.reject(f)}),h})}else this.kind="upload",this.abortCb=()=>{t.abort().catch(()=>{})},e.getAttachment(n,r).then(async o=>{if(!o){await this.changeStatus("missing_attachment"),await t.abort();return}if(P(o)){await this.changeStatus("failed"),await t.abort();return}let l=new TransformStream({transform(c,h){a(c.byteLength),h.enqueue(c)}});this.transferOp.resolve(()=>o.stream().then(c=>c.pipeThrough(l).pipeTo(t)))})}async start(){if(this.status!=="ready")return;let t=await this.transferOp;await this.changeStatus("in_progress"),t().then(async()=>{await this.changeStatus("complete")}).catch(async()=>{await this.changeStatus("failed")})}updateLoaded(t){this.loaded+=t,this.statusBus.send({status:this.status,bytesLoaded:this.loaded,totalBytes:this.expectedSize})}async changeStatus(t){this.status==="complete"||this.status==="failed"||this.status==="missing_attachment"||(this.status=t,await this.statusBus.send({status:t,bytesLoaded:this.loaded,totalBytes:this.expectedSize}),t==="complete"&&this.multiDeferred.resolve(),t==="failed"&&this.multiDeferred.reject("Attachment transfer failed"),t==="missing_attachment"&&this.multiDeferred.reject("The other peer does not have this attachment"))}get doc(){return this.sourceDoc}onProgress(t){return this.statusBus.on(t)}abort(){this.abortCb()}isDone(){return this.multiDeferred.getPromise()}},uh=class{constructor(t){this.waiting=[],this.active=new Set,this.failed=new Set,this.completed=new Set,this.transfersRequestedByUsEnroller=new dr(!0),this.reports={},this.reportBus=new An,this.activeLimit=t}async activate(t){this.active.add(t),t.isDone().then(()=>{this.completed.add(t)}).catch(()=>{this.failed.add(t)}).finally(()=>{this.active.delete(t),this.admitNext()}),await t.start()}queue(t){this.waiting.push(t)}admitNext(){if(this.waiting.length===0||this.active.size>=this.activeLimit)return;let t=this.waiting.shift();t&&this.activate(t)}async addTransfer(t){t.onProgress(()=>{this.updateTransferStatus(t)}),t.requester==="us"&&this.transfersRequestedByUsEnroller.enrol(t.isDone()),this.active.size<this.activeLimit?await this.activate(t):this.queue(t)}gotAllTransfersRequestedByUs(){this.transfersRequestedByUsEnroller.seal()}cancel(){this.transfersRequestedByUsEnroller.seal();for(let t of this.active)t.abort()}updateTransferStatus(t){this.reports[t.share]||(this.reports[t.share]={}),this.reports[t.share][t.hash+t.kind]={author:t.doc.author,path:t.doc.path,format:t.doc.format,hash:t.hash,kind:t.kind,status:t.status,bytesLoaded:t.loaded,totalBytes:t.expectedSize},this.reportBus.send(this.getReport())}getReport(){let t={};for(let e in this.reports){let n=[],r=this.reports[e];for(let i in r){let s=r[i];n.push(s)}t[e]=n}return t}hasQueuedTransfer(t,e){for(let n of this.waiting)if(n.hash===t&&n.kind===e)return!0;for(let n of this.active)if(n.hash===t&&n.kind===e)return!0;for(let n of this.completed)if(n.hash===t&&n.kind===e)return!0;return!1}onReportUpdate(t){return this.reportBus.on(t)}transfersRequestedByUsFinished(){return this.transfersRequestedByUsEnroller.isDone()}},ah=class{constructor(t){this.otherSyncerId=G(),this.receivedAllExpectedTransfersEnroller=new dr,this.madeAllAttachmentRequestsEnroller=new dr(!0),this.reportDidUpdateBus=new An,this.expectedTransferPromises=new Map,this.partner=t.partner,this.queue=new uh(this.partner.concurrentTransfers),this.formats=t.formats,this.formatsLookup=Ln(this.formats),this.queue.onReportUpdate(async e=>{await this.reportDidUpdateBus.send(e)}),this.madeAllAttachmentRequestsEnroller.isDone().then(()=>{this.receivedAllExpectedTransfersEnroller.seal()}),this.receivedAllExpectedTransfersEnroller.isDone().then(()=>{this.queue.gotAllTransfersRequestedByUs()})}registerSyncAgent(t){this.madeAllAttachmentRequestsEnroller.enrol(t.isDone())}allSyncAgentsKnown(){this.madeAllAttachmentRequestsEnroller.seal()}registerExpectedTransfer(t,e){let n=`${t}_${e}`;if(this.expectedTransferPromises.has(n))return;let r=G();this.expectedTransferPromises.set(n,r),this.receivedAllExpectedTransfersEnroller.enrol(r)}async queueTransfer(t){this.queue.hasQueuedTransfer(t.hash,t.kind)||await this.queue.addTransfer(t)}async handleDownload(t,e,n){let r=this.formatsLookup[t.format],i=r.getAttachmentInfo(t);if(P(i))throw new Xe("TransferManager: attempted to download doc with no attachment.");let s=await this.partner.getDownload({doc:t,shareAddress:e.share,syncerId:await this.otherSyncerId,attachmentHash:i.hash});if(s===void 0)return"no_attachment";if(P(s))return s;let u=new pi({replica:e,doc:t,format:r,stream:s,requester:"us",counterpartId:n});return await this.queueTransfer(u),"queued"}async handleUpload(t,e){let n=this.formatsLookup[t.doc.format];if(!await e.getAttachment(t.doc,n))return!1;let r=await this.partner.handleUploadRequest({shareAddress:t.shareAddress,syncerId:await this.otherSyncerId,doc:t.doc,attachmentHash:t.attachmentHash});if(P(r))return!1;try{let i=new pi({doc:t.doc,format:n,replica:e,stream:r,requester:"them",counterpartId:"unused"});await this.queueTransfer(i)}catch{return!1}return!0}async handleTransferRequest({replica:t,path:e,author:n,source:r,kind:i,formatName:s,counterpartId:u}){let a=await this.partner.handleTransferRequest(r,i);if(a===void 0||P(a))return;let o=Ln(this.formats)[s];if(!o)return;let l=(await t.getAllDocsAtPath(e,[o])).find(h=>h.author===n);if(!l)return;let c=new pi({doc:l,format:o,replica:t,stream:a,requester:i==="upload"?"us":"them",counterpartId:u});if(c.requester==="us"){let h=`${c.share}_${c.hash}`,f=this.expectedTransferPromises.get(h);f&&f.resolve()}await this.queueTransfer(c)}cancel(){this.queue.cancel()}getReport(){return this.queue.getReport()}onReportUpdate(t){return this.reportDidUpdateBus.on(t)}transfersRequestedByUsFinished(){return this.queue.transfersRequestedByUsFinished()}registerOtherSyncerId(t){this.otherSyncerId.resolve(t)}isAlreadyQueued(t,e){return this.queue.hasQueuedTransfer(t,e)}},ja=class{constructor(t){this.id=Wt(),this.syncAgents=new Map,this.syncAgentQueues=new Map,this.statusBus=new An,this.partnerIsFulfilled=G(),this.isDoneMultiDeferred=new Yr,this.manager=t.manager,this.peer=t.manager.peer,this.appetite=t.partner.syncAppetite,this.formats=Nn(t.formats),this.partner=t.partner,this.transferManager=new ah({partner:this.partner,formats:this.formats}),this.transferManager.onReportUpdate(async()=>{await this.statusBus.send(this.getStatus())}),this.heartbeatInterval=setInterval(()=>{this.partner.sendEvent({kind:"HEARTBEAT"})},1e3),(async()=>{try{for await(let n of t.partner.getEvents())this.handleIncomingEvent(n)}catch(n){this.cancel(n||"Partner disconnected")}})();let e=Wt();Promise.all(this.peer.shares().map(n=>Br(e,n))).then(n=>{this.partner.sendEvent({kind:"DISCLOSE",salt:e,syncerId:this.id,shares:n,formats:this.formats?this.formats.map(r=>r.id):[vt.id],canRespond:!1})}),this.transferManager.transfersRequestedByUsFinished().then(async()=>{t.partner.syncAppetite!=="continuous"&&(await this.partner.sendEvent({kind:"SYNCER_FULFILLED"}),await this.partnerIsFulfilled,clearInterval(this.heartbeatInterval),await this.partner.closeConnection(),this.bumpingTimeout.close(),this.isDoneMultiDeferred.resolve())}),this.peer.onReplicasChange(async n=>{if(this.appetite==="once")return;let r=Array.from(n.keys());for(let[s,u]of this.syncAgents)r.includes(s)===!1&&(await u.cancel("Replica was removed from peer."),this.syncAgents.delete(s));let i=Wt();Promise.all(r.map(s=>Br(i,s))).then(s=>{this.partner.sendEvent({kind:"DISCLOSE",salt:i,syncerId:this.id,shares:s,formats:this.formats?this.formats.map(u=>u.id):[vt.id],canRespond:!0})})}),this.bumpingTimeout=new qa(()=>{this.cancel("No communication from the other peer in the last three seconds.")},1e4)}addShare(t,e,n){if(this.syncAgents.has(t))return;let r=this.peer.getReplica(t);if(!r){console.error("Couldn't get the replica for a share we had in common.");return}let i=new th({replica:r,formats:e,syncerManager:this.manager,transferManager:this.transferManager,initiateMessaging:n,payloadThreshold:this.partner.payloadThreshold,rangeDivision:this.partner.rangeDivision,syncAppetite:this.appetite});i.onStatusUpdate(()=>{this.statusBus.send(this.getStatus())}),this.syncAgents.set(t,i),this.transferManager.registerSyncAgent(i);let s=this.syncAgentQueues.get(t),u;if(s)u=s;else{let a=new qt;u=a,this.syncAgentQueues.set(t,a)}(async()=>{for await(let a of u)i.sendEvent(a)})(),(async()=>{for await(let a of i.events())this.partner.sendEvent({to:t,...a})})()}async handleIncomingEvent(t){switch(this.bumpingTimeout.bump(),t.kind){case"DISCLOSE":{let e=zc(t.formats,this.formats);if(e.length===0)break;let n=new Set(t.shares),r=new Set,i=new Set;for(let u of this.peer.shares()){let a=await Br(t.salt,u);n.has(a)?r.add(u):i.add(u)}let s=this.id>t.syncerId;for(let u of r)this.addShare(u,e,s);for(let u of i){let a=this.syncAgents.get(u);a&&(a.cancel("No longer in common with the other peer."),this.syncAgents.delete(u))}if(this.transferManager.registerOtherSyncerId(t.syncerId),this.appetite==="once"&&this.transferManager.allSyncAgentsKnown(),t.canRespond){let u=Wt();Promise.all(this.peer.shares().map(a=>Br(u,a))).then(a=>{this.partner.sendEvent({kind:"DISCLOSE",salt:u,syncerId:this.id,shares:a,formats:this.formats?this.formats.map(o=>o.id):[vt.id],canRespond:!1})})}r.size===0&&this.appetite==="once"&&this.partner.sendEvent({kind:"SYNCER_FULFILLED"});break}case"SYNCER_FULFILLED":{this.partnerIsFulfilled.resolve();break}case"HEARTBEAT":break;default:{let{to:e}=t,n=this.syncAgentQueues.get(e);if(!n){let r=new qt;r.push(t),this.syncAgentQueues.set(e,r);break}n.push(t)}}}getStatus(){let t={};for(let[e,n]of this.syncAgents)t[e]={docs:n.getStatus(),attachments:this.transferManager.getReport()[e]||[]};return t}onStatusChange(t){return this.statusBus.on(t)}async cancel(t){this.bumpingTimeout.close(),this.isDoneMultiDeferred.reject(t);for(let[e,n]of this.syncAgents)await n.cancel();clearInterval(this.heartbeatInterval),this.transferManager.cancel(),await this.partner.closeConnection()}handleTransferRequest({shareAddress:t,path:e,author:n,source:r,kind:i,formatName:s}){if(this.isDoneMultiDeferred.state==="rejected")return;let u=this.peer.getReplica(t);if(!u)return;let a="unused";if(i==="upload"){let o=this.syncAgents.get(t);o&&(a=o.counterpartId)}return this.transferManager.handleTransferRequest({replica:u,author:n,formatName:s,kind:i,path:e,source:r,counterpartId:a})}isDone(){return this.isDoneMultiDeferred.getPromise()}};function Br(t,e){return Ie.sha256base32(t+e+t)}var oh=class{constructor(t,e,n,r){this.concurrentTransfers=1024,this.payloadThreshold=1,this.rangeDivision=2,this.outgoingQueue=new qt,this.incomingQueue=new qt,this.syncAppetite=n,this.partnerPeer=t;let{incomingQueue:i,outgoingQueue:s}=this;this.partnerSyncer=new ja({manager:t.syncerManager,formats:r,partner:{syncAppetite:n,getEvents(){return i},sendEvent(u){return s.push(u),Promise.resolve()},concurrentTransfers:1024,payloadThreshold:32,rangeDivision:32,async getDownload(u){let a=e.getReplica(u.shareAddress);if(!a)throw new M("Tried to get a receiving transfer for an unknown share.");let o=await a.replicaDriver.attachmentDriver.getAttachment(u.doc.format,u.attachmentHash);if(o&&!P(o))return await o.stream()},closeConnection(){return s.close(),Promise.resolve()},handleUploadRequest(u){return Promise.resolve(new nr("PartnerLocal does not support uploads."))},handleTransferRequest(u,a){return Promise.resolve(new nr("PartnerLocal does not support transfer requests."))}}})}getEvents(){return this.outgoingQueue}sendEvent(t){return this.incomingQueue.push(t),Promise.resolve()}closeConnection(){return this.incomingQueue.close(),Promise.resolve()}async getDownload(t){let e=this.partnerPeer.getReplica(t.shareAddress);if(!e)throw new M("Tried to get a receiving transfer for an unknown share.");let n=await e.replicaDriver.attachmentDriver.getAttachment(t.doc.format,t.attachmentHash);if(n&&!P(n))return await n.stream()}handleUploadRequest(t){return Promise.resolve(new nr("PartnerLocal does not support uploads."))}handleTransferRequest(t,e){return Promise.resolve(new nr("PartnerLocal does not support transfer requests."))}},lh=class{constructor(t){this.concurrentTransfers=16,this.payloadThreshold=8,this.rangeDivision=8,this.incomingQueue=new qt,this.socketIsReady=G(),this.syncAppetite=t.appetite;let e=new URL(t.url),n=`${e.host}${e.pathname==="/"?"":e.pathname}`;this.isSecure=e.protocol==="https:"||e.protocol==="wss:",this.wsUrl=`${this.isSecure?"wss://":"ws://"}${n}/'`;let r=new URL(t.appetite,this.wsUrl);this.socket=new WebSocket(r.toString()),this.socket.onopen=()=>{this.socketIsReady.resolve()},this.socket.binaryType="arraybuffer",this.socket.onmessage=i=>{this.incomingQueue.push(JSON.parse(i.data))},this.socket.onclose=()=>{this.incomingQueue.close()},this.socket.onerror=i=>{if("error"in i){this.incomingQueue.close({withError:i.error});return}this.incomingQueue.close({withError:new Xe("Websocket error.")})}}async sendEvent(t){if(await this.socketIsReady,!(this.socket.readyState===this.socket.CLOSED||this.socket.readyState===this.socket.CLOSING))return this.socket.send(JSON.stringify(t))}getEvents(){return this.incomingQueue}closeConnection(){return this.socket.close(),Promise.resolve()}getDownload(t){let e=new URL(`${t.syncerId}/download/${t.shareAddress}/${t.doc.format}/${t.doc.author}${t.doc.path}`,this.wsUrl),n=Zc(e.toString(),r=>r.data instanceof ArrayBuffer?new Uint8Array(r.data):null);return Promise.resolve(n)}handleUploadRequest(t){let e=new URL(`${t.syncerId}/upload/${t.shareAddress}/${t.doc.format}/${t.doc.author}${t.doc.path}`,this.wsUrl),n=Gc(e.toString(),r=>r);return Promise.resolve(n)}handleTransferRequest(t,e){return Promise.resolve(new nr("SyncDriverWebClient does not support external transfer requests."))}};function ch(t,e){let[n,r]=t.split(" "),[i,s]=e.split(" "),u=parseInt(n),a=parseInt(i);return u>a?1:u<a?-1:r>s?1:r<s?-1:0}var hh={lift:t=>ac(t),combine:(t,e)=>t+e,neutral:BigInt(0)},fh=class extends lc{constructor(){super(hh,ch)}},dh=class{constructor(){this.messagingModes=new Map,this.eagerMessageThumbnails=new Set,this.haveTimeouts=new Map}getMode(t){let e=this.messagingModes.get(t);if(e)return e;let n=this.messagingModes.size===0?"EAGER":"LAZY";return this.messagingModes.set(t,n),"EAGER"}onEagerMessage(t,e){let n=this.haveTimeouts.get(e.thumbnail);return n?(clearTimeout(n),!1):this.eagerMessageThumbnails.has(e.thumbnail)?(this.messagingModes.set(t,"LAZY"),!0):(this.eagerMessageThumbnails.add(e.thumbnail),!1)}onLazyMessage(t,e){if(!this.haveTimeouts.has(t.thumbnail)){let n=setTimeout(()=>{e(t.thumbnail)},5);this.haveTimeouts.set(t.thumbnail,n)}}onGraftMessage(t){this.messagingModes.set(t,"EAGER")}onPrune(t){this.messagingModes.set(t,"LAZY")}},ph=class{constructor(t){this.syncers=new Map,this.syncerEventBus=new An,this.docThumbnailTreeAndLookup=new Map,this.hasher=new Zi,this.plumTrees=new Map,this.peer=t}addPartner(t,e,n){let r=new ja({manager:this,partner:t,formats:n});return this.syncers.set(r.id,{syncer:r,description:e}),this.syncerEventBus.send(this.syncers),r}getSyncers(){return this.syncers}getDocThumbnailTreeAndDocLookup(t,e){let n=e.map(h=>h.id),r=`${t} ${n}`,i=this.docThumbnailTreeAndLookup.get(r);if(i){let[h,f]=i;return{tree:h,lookup:f,treeIsReady:Promise.resolve(!0)}}let s=this.peer.getReplica(t);if(!s)throw new Xe("A DocThumbnailTree was requested for a share the peer doesn't know about, big problem!");let u=this.hasher,a=s.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"everything",e),o=new fh,l={},c=G();return a.pipeTo(new WritableStream({write(h){if(h.kind==="processed_all_existing"){c.resolve();return}u.reset(),u.update(`${h.doc.path} ${h.doc.author}`);let f=u.digest().toString(16),d=`${h.doc.timestamp} ${f}`;(h.kind==="existing"||h.kind==="success")&&(l[f]=[h.doc.timestamp,h.doc.path,h.doc.author],o.insert(d)),h.kind==="expire"&&(delete l[f],o.remove(d))}})),{tree:o,lookup:l,treeIsReady:c}}getPlumTree(t){let e=this.plumTrees.get(t);if(e)return e;let n=new dh;return this.plumTrees.set(t,n),n}onSyncersChange(t){return this.syncerEventBus.on(t)}},un=new We("peer","orangeRed"),Xn=JSON.stringify,Wa=class{constructor(){this.replicaEventBus=new An,this.replicaMap=new Map,un.debug("constructor"),this.syncerManager=new ph(this)}hasShare(t){return this.replicaMap.has(t)}shares(){let t=[...this.replicaMap.keys()];return t.sort(),t}replicas(){let t=[...this.replicaMap.keys()];return t.sort(),t.map(e=>this.replicaMap.get(e))}size(){return this.replicaMap.size}getReplica(t){return this.replicaMap.get(t)}async addReplica(t){if(un.debug(`addReplica(${Xn(t.share)})`),this.replicaMap.has(t.share))throw un.debug("already had a replica with that share"),new Error(`Peer.addReplica: already has a replica with share ${Xn(t.share)}.  Don't add another one.`);this.replicaMap.set(t.share,t),await this.replicaEventBus.send(this.replicaMap),un.debug("    ...addReplica: done")}async removeReplicaByShare(t){un.debug(`removeReplicaByShare(${Xn(t)})`),this.replicaMap.delete(t),await this.replicaEventBus.send(this.replicaMap)}async removeReplica(t){let e=this.replicaMap.get(t.share);t===e?(un.debug(`removeReplica(${Xn(t.share)})`),await this.removeReplicaByShare(t.share)):un.debug(`removeReplica(${Xn(t.share)}) -- same share but it's a different instance now; ignoring`)}sync(t,e=!1,n){try{let r=new lh({url:t,appetite:e?"continuous":"once"});return this.syncerManager.addPartner(r,t,n)}catch{if(t instanceof Wa){let r=new oh(t,this,e?"continuous":"once",n);return this.syncerManager.addPartner(r,"Local",n)}console.error("Provided an invalid target for syncing to a peer:",t);return}}addSyncPartner(t,e,n){return this.syncerManager.addPartner(t,e,n)}getSyncers(){return this.syncerManager.getSyncers()}onReplicasChange(t){return this.replicaEventBus.on(t)}onSyncersChange(t){return this.syncerManager.onSyncersChange(t)}},Dh={historyMode:"latest",orderBy:"path ASC",startAfter:void 0,limit:void 0,filter:void 0,formats:["es.5"]},an=new We("query","green");function Va(t){var i,s,u,a;let e={...Dh,...t},n={query:{limit:0},isValid:!1,willMatch:"nothing"};if(e.limit!==void 0&&e.limit<0)return an.debug("cleanUpQuery: unreasonable limit - returning empty invalid query",n),n;if((i=e.orderBy)!=null&&i.startsWith("path")&&((s=e.startAfter)==null?void 0:s.localIndex)!==void 0)return an.debug('cleanUpQuery: orderBy is "path" but startAfter is not compatible - returning empty invalid query',n),n;if((u=e.orderBy)!=null&&u.startsWith("localIndex")&&((a=e.startAfter)==null?void 0:a.path)!==void 0)return an.debug('cleanUpQuery: orderBy is "localIndex" but startAfter is not compatible - returning empty invalid query',n),n;if(e.historyMode!==void 0&&e.historyMode!=="all"&&e.historyMode!=="latest")return an.debug(`cleanUpQuery: unknown historyMode ${JSON.stringify(e.historyMode)} - returning empty invalid query`,n),n;if(e.orderBy!==void 0&&["path ASC","path DESC","localIndex ASC","localIndex DESC"].indexOf(e.orderBy)===-1)return an.debug(`cleanUpQuery: unrecognized orderBy value ${JSON.stringify(e.orderBy)} - returning empty invalid query`,n),n;let r=e.historyMode==="all"?"all":"all-latest";if(e.filter!==void 0&&!Nr(e.filter,{})&&(r="some"),e.startAfter!==void 0&&!Nr(e.startAfter,{})&&(r="some"),e.limit!==void 0&&(e.limit>0&&(r="some"),e.limit===0&&(r="nothing")),e.filter!==void 0){let o=e.filter;o.path&&o.pathStartsWith&&!o.path.startsWith(o.pathStartsWith)&&(r="nothing"),o.path&&o.pathEndsWith&&!o.path.endsWith(o.pathEndsWith)&&(r="nothing"),o.timestamp&&o.timestampGt&&!(o.timestamp>o.timestampGt)&&(r="nothing"),o.timestamp&&o.timestampLt&&!(o.timestamp<o.timestampLt)&&(r="nothing"),o.timestampGt&&o.timestampLt&&!(o.timestampLt+1<o.timestampGt)&&(r="nothing")}if(r==="nothing"){let o={query:{limit:0},isValid:!0,willMatch:"nothing"};return an.debug("cleanUpQuery - this query will match nothing, so returning a simpler query that also matches nothing",o),o}return an.debug(`cleanUpQuery - query is ok!  willMatch = ${r}`),{query:e,isValid:!0,willMatch:r}}function Ji(t,e){return!(e.path!==void 0&&t.path!==e.path||e.pathStartsWith!==void 0&&!t.path.startsWith(e.pathStartsWith)||e.pathEndsWith!==void 0&&!t.path.endsWith(e.pathEndsWith)||e.author!==void 0&&t.author!==e.author||e.timestamp!==void 0&&t.timestamp!==e.timestamp||e.timestampGt!==void 0&&!(t.timestamp>e.timestampGt)||e.timestampLt!==void 0&&!(t.timestamp<e.timestampLt))}new We("query helpers","gold");var mh=(t=>(t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT",t))(mh||{});function Ri(t,e,n="ASC"){if(Array.isArray(t)&&pa(t,e)||typeof t=="object"&&Nr(t,e)||t===e)return 0;if(n==="ASC"||n===void 0)return t<e?-1:1;if(n==="DESC")return t>e?-1:1;throw new Error("unexpected sort order to compareBasic: "+JSON.stringify(n))}function es(t,e,n){let r=Math.min(t.length,e.length);for(let u=0;u<r;u++){let a=(n==null?void 0:n[u])??"ASC",o=Ri(t[u],e[u],a);if(o!==0)return o}if(t.length===e.length)return 0;let i=Math.min(t.length,e.length),s=(n==null?void 0:n[i])??"ASC";return Ri(t.length,e.length,s)}function Us(t,e="ASC"){return(n,r)=>Ri(n[t],r[t],e)}var gh=JSON.stringify,Ve=new We("replica","gold"),Qe=new We("replica set","gold"),ze=new We("replica ingest","gold");function zs(t,e){return es([t.timestamp,t.signature],[e.timestamp,t.signature],["DESC","ASC"])}var wh=class{constructor({driver:t,config:e}){var r;this._isClosed=!1,this.ingestLockStream=new Ha,this.eventMultiStream=new Kc("kind",!0),this.callbackSink=new za,this.expireEventTimeouts=new Map;let n=Cr(t.docDriver.share);if(P(n))throw n;Ve.debug(`constructor.  driver = ${(r=t==null?void 0:t.constructor)==null?void 0:r.name}`),this.replicaId="replica-"+Wt(),this.share=t.docDriver.share,this.replicaDriver=t,this.formatsConfig=e||{},this.eventWriter=this.eventMultiStream.getWritableStream().getWriter(),this.eventMultiStream.getReadableStream("*").pipeTo(new WritableStream(this.callbackSink)),this.eraseInterval=setInterval(()=>{this.isClosed()?clearInterval(this.eraseInterval):this.pruneExpiredDocsAndAttachments()},1e3*60*60)}isClosed(){return this._isClosed}async close(t){if(Ve.debug("closing..."),this._isClosed)throw new Ce;await this.ingestLockStream.close();for(let e of this.expireEventTimeouts.values())clearTimeout(e);return Ve.debug("    sending willClose blockingly..."),await this.eventWriter.write({kind:"willClose"}),Ve.debug("    marking self as closed..."),t===!1&&await this.pruneExpiredDocsAndAttachments(),await this.replicaDriver.attachmentDriver.clearStaging(),this._isClosed=!0,Ve.debug(`    closing ReplicaDriver (erase = ${t})...`),await this.replicaDriver.docDriver.close(t),await this.replicaDriver.attachmentDriver.close(t),clearInterval(this.eraseInterval),Ve.debug("    sending didClose nonblockingly..."),await this.eventWriter.write({kind:"didClose"}),Ve.debug("...closing done"),Promise.resolve()}async getConfig(t){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.getConfig(t)}async setConfig(t,e){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.setConfig(t,e)}async listConfigKeys(){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.listConfigKeys()}async deleteConfig(t){if(this._isClosed)throw new Ce;return await this.replicaDriver.docDriver.deleteConfig(t)}getMaxLocalIndex(){if(this._isClosed)throw new Ce;return this.replicaDriver.docDriver.getMaxLocalIndex()}getAllDocs(t){return Ve.debug("getAllDocs()"),this.queryDocs({historyMode:"all",orderBy:"path ASC"},t)}getLatestDocs(t){return Ve.debug("getLatestDocs()"),this.queryDocs({historyMode:"latest",orderBy:"path ASC"},t)}getAllDocsAtPath(t,e){return Ve.debug(`getAllDocsAtPath("${t}")`),this.queryDocs({historyMode:"all",orderBy:"path ASC",filter:{path:t}},e)}async getLatestDocAtPath(t,e){Ve.debug(`getLatestDocsAtPath("${t}")`);let n=await this.queryDocs({historyMode:"latest",orderBy:"path ASC",filter:{path:t}},e?[e]:void 0);if(n.length!==0)return n[0]}async queryDocs(t={},e){if(Ve.debug("queryDocs",t),this._isClosed)throw new Ce;let n=Nn(e);return await this.replicaDriver.docDriver.queryDocs({...t,formats:n.map(r=>r.id)})}async queryPaths(t={},e){let n=await this.queryDocs(t,e),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}async queryAuthors(t={},e){let n=await this.queryDocs(t,e),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}async set(t,e,n=vt){if(Qe.debug("set",e),this._isClosed)throw new Ce;Qe.debug("...deciding timestamp: getting latest doc at the same path (from any author)");let r=await this.getLatestDocAtPath(e.path),i;typeof e.timestamp=="number"?i=e.timestamp:r===void 0?i=Ss():i=Math.max(Ss(),r.timestamp+1),Qe.debug("...generating doc");let s;if(r){let o=n.removeExtraFields(r);P(o)||(s=o.doc)}let u=await n.generateDocument({keypair:t,input:{...e,format:n.id},share:this.share,timestamp:i,prevLatestDoc:s,config:this.formatsConfig[n.id]});if(P(u))return{kind:"failure",reason:"invalid_document",err:u};if(Qe.debug("...signature =",u.doc.signature),u.attachment){let o=await this.replicaDriver.attachmentDriver.stage(n.id,u.attachment);if(P(o))return{kind:"failure",reason:"invalid_document",err:o};let l=await n.updateAttachmentFields(t,u.doc,o.size,o.hash,this.formatsConfig[n.id]);if(P(l))return await o.reject(),{kind:"failure",reason:"invalid_document",err:l};Qe.debug("...ingesting attachment"),Qe.debug("-----------------------"),await o.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:l,hash:o.hash,size:o.size,sourceId:"local"}),Qe.debug("...done ingesting attachment"),Qe.debug("...ingesting"),Qe.debug("-----------------------");let c=await this.ingest(n,l,"local");return Qe.debug("...done ingesting"),Qe.debug("...set is done."),c}Qe.debug("...ingesting"),Qe.debug("-----------------------");let a=await this.ingest(n,u.doc,"local");return Qe.debug("...done ingesting"),Qe.debug("...set is done."),a}async ingest(t,e,n){if(ze.debug("ingest",e),this._isClosed)throw new Ce;ze.debug("...removing extra fields");let r=t.removeExtraFields(e);if(P(r))return{kind:"failure",reason:"invalid_document",err:r};e=r.doc;let i=r.extras;Object.keys(i).length>0&&ze.debug(`...extra fields found: ${gh(i)}`);let s=await t.checkDocumentIsValid(e);if(P(s))return{kind:"failure",reason:"invalid_document",err:s};let u=G();return await this.ingestLockStream.run(async()=>{ze.debug(" >> ingest: start of protected region"),ze.debug("  > getting other history docs at the same path by any author");let a=await this.getAllDocsAtPath(e.path,[t]);ze.debug(`  > ...got ${a.length}`),ze.debug("  > getting prevLatest and prevSameAuthor");let o=a[0]??null,l=a.filter(p=>p.author===e.author)[0]??null;ze.debug("  > checking if new doc is latest at this path"),a.push(e),a.sort(zs);let c=a[0]===e;if(ze.debug(`  > ...isLatest: ${c}`),!c&&l!==null){ze.debug("  > new doc is not latest and there is another one from the same author...");let p=zs(e,l);if(p===1){ze.debug("  > new doc is GT prevSameAuthor, so it is obsolete"),u.resolve({kind:"nothing_happened",reason:"obsolete_from_same_author",doc:e});return}if(p===0){ze.debug("  > new doc is EQ prevSameAuthor, so it is redundant (already_had_it)"),u.resolve({kind:"nothing_happened",reason:"already_had_it",doc:e});return}}ze.debug("  > upserting into ReplicaDriver...");let h=await this.replicaDriver.docDriver.upsert(e);ze.debug("  > ...done upserting into ReplicaDriver"),ze.debug("  > ...getting ReplicaDriver maxLocalIndex...");let f=await this.replicaDriver.docDriver.getMaxLocalIndex();ze.debug(" >> ingest: end of protected region, returning a WriteEvent from the lock");let d={kind:"success",maxLocalIndex:f,doc:h,docIsLatest:c,prevDocFromSameAuthor:l,prevLatestDoc:o,sourceId:n};if(u.resolve(d),await this.eventWriter.write(d),h.deleteAfter){let p=`${h.path}|${h.author}`,D=this.expireEventTimeouts.get(p);D&&clearTimeout(D);let m=h.deleteAfter/1e3-Date.now();this.expireEventTimeouts.set(p,setTimeout(()=>{this.eventWriter.write({kind:"expire",doc:h})},m))}}),u}async overwriteAllDocsByAuthor(t,e){let n=Ls(e);if(Ve.debug(`overwriteAllDocsByAuthor("${t.address}")`),this._isClosed)throw new Ce;let r=await this.queryDocs({filter:{author:t.address},historyMode:"all"},[n]);Ve.debug(`    ...found ${r.length} docs to overwrite`);let i=0,s=0;for(let u of r){let a=await this.wipeDocument(t,u,Ls(e));if(P(a))return a;i+=1}return Ve.debug(`    ...done; ${i} overwritten to be empty; ${s} were already empty; out of total ${r.length} docs`),i}async wipeDocAtPath(t,e,n=vt){let r=await this.getLatestDocAtPath(e,n);return r?this.wipeDocument(t,r,n):new M("No document exists at that path")}async wipeDocument(t,e,n){let r={...e,timestamp:Math.max(e.timestamp+1,Date.now()*1e3),author:t.address},i=await n.wipeDocument(t,r,this.formatsConfig[n.id]);if(P(i))return{kind:"failure",err:i,reason:"invalid_document"};let s=await this.ingest(n,i,"local");if(s.kind==="success"){let u=n.getAttachmentInfo(e);if(!P(u)){let a=await this.replicaDriver.attachmentDriver.erase(n.id,u.hash);P(a)||await this.eventWriter.write({kind:"attachment_prune",format:n.id,hash:u.hash})}}return s}async pruneExpiredDocsAndAttachments(t=Xr){let e=await this.replicaDriver.docDriver.eraseExpiredDocs();for(let s of e)await this.eventWriter.write({kind:"expire",doc:s});let n=Ln(t),r={};await this.getQueryStream({historyMode:"all",orderBy:"localIndex ASC"},"existing",t).pipeTo(new WritableStream({write(s){if(s.kind==="existing"){let u=n[s.doc.format],a=u.getAttachmentInfo(s.doc);if(!P(a)){let o=r[u.id];o?o.add(a.hash):r[u.id]=new Set([a.hash])}}}}));let i=await this.replicaDriver.attachmentDriver.filter(r);for(let s of i)await this.eventWriter.write({kind:"attachment_prune",format:s.format,hash:s.hash})}getEventStream(t="*"){return this.eventMultiStream.getReadableStream(t)}getQueryStream(t={},e,n){let r=this.queryDocs.bind(this),i=this.getEventStream.bind(this);return new ReadableStream({async start(s){if(e==="existing"||e==="everything"){let a=await r(t,n);for(let o of a)s.enqueue({kind:"existing",doc:o})}if(s.enqueue({kind:"processed_all_existing"}),e==="existing"){s.close();return}let u=i().getReader();for(;;){let{done:a,value:o}=await u.read();if(a)return;if(o.kind==="expire"||o.kind==="success"){if(t.filter&&Ji(o.doc,t.filter)){s.enqueue(o);continue}s.enqueue(o);continue}o.kind==="didClose"&&s.close()}}})}onEvent(t){return this.callbackSink.onWrite(t)}async ingestAttachment(t,e,n,r){if(this._isClosed)throw new Ce;let i=t.removeExtraFields(e);if(P(i))return Promise.resolve(i);e=i.doc;let s=await t.checkDocumentIsValid(e);if(P(s))return Promise.resolve(s);let u=await this.getAttachment(e,t);if(u&&!P(u))return!1;let a=t.getAttachmentInfo(e);if(P(a))return Promise.resolve(a);let o=await this.replicaDriver.attachmentDriver.stage(e.format,n);return P(o)?o:o.hash!==a.hash?(await o.reject(),new M("Attachment's hash did not match the document's")):o.size!==a.size?(await o.reject(),new M("Attachment's size did not match the document's")):(await o.commit(),await this.eventWriter.write({kind:"attachment_ingest",doc:e,hash:o.hash,size:o.size,sourceId:r}),!0)}getAttachment(t,e=vt){if(t.deleteAfter&&t.deleteAfter<Date.now()*1e3)return Promise.resolve(new M("This document has expired"));let n=e.getAttachmentInfo(t);return P(n)?Promise.resolve(n):this.replicaDriver.attachmentDriver.getAttachment(t.format,n.hash)}addAttachments(t,e){let n=Nn(e),r={};for(let s of n)r[s.id]=s;let i=t.map(s=>new Promise(u=>{let a=r[s.format].getAttachmentInfo(s);if(!P(a))this.replicaDriver.attachmentDriver.getAttachment(s.format,a.hash).then(o=>{u({...s,attachment:o})});else return u({...s,attachment:a})}));return Promise.all(i)}},bh=class extends wh{constructor(t){super({driver:t.driver,config:{"es.5":{shareSecret:t.shareSecret}}})}},on=new We("replica-cache","green");function Hs({_localIndex:t}){return t}function qs(t,e){let n=[];for(let r of e)if(!(t.orderBy==="path ASC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path<=t.startAfter.path)&&!(t.orderBy==="path DESC"&&t.startAfter!==void 0&&t.startAfter.path!==void 0&&r.path>=t.startAfter.path)&&!(t.orderBy==="localIndex ASC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)<=t.startAfter.localIndex)&&!(t.orderBy==="localIndex DESC"&&t.startAfter!==void 0&&t.startAfter.localIndex!==void 0&&(r._localIndex||0)>=t.startAfter.localIndex)&&(n.push(r),t.limit!==void 0&&n.length>=t.limit))break;return n}var yh=class{constructor(t,e,n){this.version=0,this.docCache=new Map,this.onCacheUpdatedCallbacks=new Set,this.closed=!1,this.onFireCacheUpdatedsWrapper=u=>u(),this.attachmentCache=new Map,this.replica=t,this.timeToLive=e||1e3,n&&(this.onFireCacheUpdatedsWrapper=n);let r=this.onReplicaEvent.bind(this),i=this.close.bind(this),s=this.isClosed.bind(this);this.replica.getEventStream("*").pipeTo(new WritableStream({async write(u){u.kind==="attachment_ingest"||u.kind==="success"||u.kind==="expire"?await r(u):u.kind==="willClose"&&!s()&&await i()}})).catch(()=>{})}async close(){if(this.closed)throw new sn;this.closed=!0,await Promise.all(Array.from(this.docCache.values()).map(t=>t.close())),this.docCache.clear(),this.onCacheUpdatedCallbacks.clear()}isClosed(){return this.closed}getAllDocs(t){return this.queryDocs({historyMode:"all",orderBy:"path DESC"},t)}getLatestDocs(t){return this.queryDocs({historyMode:"latest",orderBy:"path DESC"},t)}getAllDocsAtPath(t,e){return this.queryDocs({historyMode:"all",orderBy:"path DESC",filter:{path:t}},e)}getLatestDocAtPath(t,e){let n=this.queryDocs({historyMode:"latest",orderBy:"path DESC",filter:{path:t}},e?[e]:void 0);if(n.length!==0)return n[0]}queryDocs(t={},e){if(this.closed)throw new sn;if(this.replica.isClosed())throw new Ce;let n={...t,formats:(e||Xr).map(f=>f.id)},r=Va(n);if(r.willMatch==="nothing")return[];let i=Dl(r.query),s=this.docCache.get(i);if(s)return Date.now()>s.expires&&this.replica.queryDocs(t,e).then(f=>{let d=f.map(Hs).sort(),p=s.docs.map(Hs).sort();pa(d,p)||(this.docCache.set(i,{stream:s.stream,close:s.close,docs:f,expires:Date.now()+this.timeToLive}),on.debug("Updated cache because result expired."),this.fireOnCacheUpdateds())}),s.docs;let u=this.replica.getQueryStream(t,"new",e),a=new za,o=a.onWrite(f=>{(f.kind==="existing"||f.kind==="success")&&(on.debug({doc:f.doc.path,queryString:i}),this._updateCache(i,f.doc))}),l=new WritableStream(a),c=new AbortController;u.pipeTo(l,{signal:c.signal});let h=()=>{o()};return this.docCache.set(i,{stream:u,docs:[],expires:Date.now()+this.timeToLive,close:h}),this.replica.queryDocs(n).then(f=>{this.docCache.set(i,{stream:u,close:h,docs:f,expires:Date.now()+this.timeToLive}),on.debug("Updated cache with a new entry."),this.fireOnCacheUpdateds()}),[]}queryPaths(t={},e){let n=this.queryDocs(t,e),r=new Set(n.map(({path:i})=>i));return Array.from(r).sort()}queryAuthors(t={},e){let n=this.queryDocs(t,e),r=new Set(n.map(({author:i})=>i));return Array.from(r).sort()}_updateCache(t,e){let n=this.docCache.get(t);if(!n)return;let r=JSON.parse(t),i=()=>{let h=[...n.docs,e];this.docCache.set(t,{...n,docs:qs(r,h)}),this.fireOnCacheUpdateds()},s=({exact:h})=>{let f=n.docs.map(d=>h&&d.path===e.path&&d.author===e.author||!h&&d.path===e.path?e:d);this.docCache.set(t,{...n,docs:qs(r,f)}),this.fireOnCacheUpdateds()},u=n.docs.filter(h=>h.path===e.path),a=n.docs.filter(h=>h.path===e.path&&h.author===e.author);if(u.length===0){(r.filter&&Ji(e,r.filter)||!r.filter)&&(on.debug("Updated cache after appending a doc to a entry with matching filter."),i());return}if((r.historyMode||"latest")==="all"){if(a.length===0){on.debug("Updated cache after appending a version of a doc to a historyMode: all query."),i();return}on.debug("Updated cache after replacing a version of a doc in a historyMode: all query."),s({exact:!0});return}let o=u[0],l=e.author!==(o==null?void 0:o.author)||!Nr(e,o),c=e.timestamp>o.timestamp;if(l&&c){on.debug("Updated cache after replacing a doc with its latest version."),s({exact:!1});return}}fireOnCacheUpdateds(){this.version++,this.onFireCacheUpdatedsWrapper(()=>{this.onCacheUpdatedCallbacks.forEach(t=>{t()})})}onCacheUpdated(t){if(this.closed)throw new sn;if(this.replica.isClosed())throw new Ce;return this.onCacheUpdatedCallbacks.add(t),()=>{this.onCacheUpdatedCallbacks.delete(t)}}set(t,e,n){if(this.closed)throw new sn;return this.replica.set(t,e,n)}overwriteAllDocsByAuthor(t,e){if(this.closed)throw new sn;if(this.replica.isClosed())throw new Ce;return this.replica.overwriteAllDocsByAuthor(t,e)}wipeDocAtPath(t,e,n=vt){if(this.closed)throw new sn;return this.replica.wipeDocAtPath(t,e,n)}async onReplicaEvent(t){let e=`${t.doc.path}|${t.doc.author}`,n=this.attachmentCache.get(e);if(!n)return;let r=await this.replica.getAttachment(t.doc,n.format);this.attachmentCache.set(e,{expires:Date.now()+this.timeToLive,attachment:r,format:n.format}),this.fireOnCacheUpdateds()}getAttachment(t,e=vt){if(this.closed)throw new sn;if(this.replica.isClosed())throw new Ce;let n=e.getAttachmentInfo(t);if(P(n))return n;let r=`${t.path}|${t.author}`,i=this.attachmentCache.get(r);if(i)return Date.now()>i.expires&&this.replica.getAttachment(t,e).then(s=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:s,format:e}),this.fireOnCacheUpdateds()}),t.deleteAfter&&Date.now()*1e3>t.deleteAfter?new M("This document has expired"):i.attachment;this.attachmentCache.set(r,{attachment:void 0,expires:Date.now()+this.timeToLive,format:e}),this.replica.getAttachment(t,e).then(s=>{this.attachmentCache.set(r,{expires:Date.now()+this.timeToLive,attachment:s,format:e}),this.fireOnCacheUpdateds()})}addAttachments(t,e){let n=[],r=Ln(e);for(let i of t){let s=this.getAttachment(i,r[i.format]);n.push({...i,attachment:s})}return n}};new We("storage driver async memory","yellow");async function Ah(t){let e=new Uint8Array;return await t.pipeTo(new WritableStream({write(n){let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r}})),e}new We("storage driver localStorage","gold");var ln=new We("replica driver indexeddb","gold");function _h(t,e){return es([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["ASC","DESC","ASC"])}function Ch(t,e){return es([t.path,t.timestamp,t.signature],[e.path,e.timestamp,t.signature],["DESC","DESC","ASC"])}var ut="docs",dt="config",Eh=class{constructor(t,e){this.db=G(),this.gotInitialMaxLocalIndex=G(),this.localMaxLocalIndex=-1,this.closed=!1;let n=Cr(t);if(P(n))throw n;if(this.share=t,ln.debug("constructor"),!window.indexedDB)throw new Xe("IndexedDB is not supported by this runtime.");let r=window.indexedDB.open(`earthstar:share_docs:${this.share}${e?`/${e}`:""}`,1);r.onerror=()=>{throw ln.error(`Could not open IndexedDB for ${this.share}'s attachments.`),ln.error(r.error),new Xe(`Could not open IndexedDB for ${this.share}'s attachments.`)},r.onupgradeneeded=function(){let i=r.result,s=i.createObjectStore(ut,{keyPath:["path","author"]});s.createIndex("comboIndex",["_localIndex","timestamp","path","author"],{unique:!0}),s.createIndex("pathTimestampIndex",["path","timestamp"],{unique:!1}),s.createIndex("pathAuthorIndex",["path","author"],{unique:!0}),s.createIndex("deleteAfterIndex","deleteAfter",{unique:!1}),s.createIndex("localIndexIndex","_localIndex",{unique:!0}),i.createObjectStore(dt,{keyPath:"key"}).createIndex("keyIndex",["key"],{unique:!0})},r.onsuccess=()=>{this.db.resolve(r.result);let i=r.result.transaction([ut],"readonly").objectStore(ut).index("localIndexIndex").openCursor(null,"prev");i.onsuccess=()=>{i.result?this.gotInitialMaxLocalIndex.resolve(i.result.value._localIndex):this.gotInitialMaxLocalIndex.resolve(-1)}},this.gotInitialMaxLocalIndex.then(i=>{this.localMaxLocalIndex=i})}isClosed(){return this.closed}async close(t){if(this.closed)throw new Ce;this.closed=!0;let e=G();if(t){let n=(await this.db).transaction([ut,dt],"readwrite"),r=G(),i=G(),s=n.objectStore(ut).clear().onsuccess=()=>{r.resolve()},u=n.objectStore(dt).clear().onsuccess=()=>{i.resolve()};await Promise.all([s,u]),e.resolve()}else e.resolve();return(await this.db).close(),await La(20),e}async getMaxLocalIndex(){return await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex}async queryDocs(t){var o,l,c,h,f,d,p,D,m,A,F,_,g;let e=(await this.db).transaction([ut],"readonly").objectStore(ut),n=G(),{query:r,willMatch:i}=Va(t);if(ln.debug(`    cleanUpQuery.  willMatch = ${i}`),i==="nothing")return[];if((o=r.filter)!=null&&o.path&&r.historyMode==="latest"){let S=IDBKeyRange.bound([r.filter.path,r.filter.timestampGt||0],[r.filter.path,r.filter.timestampLt||Number.MAX_SAFE_INTEGER]),k=e.index("pathTimestampIndex").openCursor(S,"prev");k.onsuccess=()=>{var x;(x=k.result)!=null&&x.value?n.resolve([k.result.value]):n.resolve([])}}else if((l=r.filter)!=null&&l.path&&r.historyMode==="all"){let S=e.index("pathAuthorIndex"),k=IDBKeyRange.bound([r.filter.path," "],[r.filter.path,"~"]),x=S.getAll(k);x.onsuccess=()=>{x.result?n.resolve(Array.from(x.result)):n.resolve([])}}else{let S=((c=r.startAfter)==null?void 0:c.path)||((h=r.filter)==null?void 0:h.path)||((f=r.filter)==null?void 0:f.pathStartsWith)||" ",k=((d=r.filter)==null?void 0:d.author)||" ",x=((p=r.filter)==null?void 0:p.timestamp)||((D=r.filter)==null?void 0:D.timestampGt)||0,R=((m=r.startAfter)==null?void 0:m.localIndex)||0,z=((A=r.filter)==null?void 0:A.path)||"~",L=((F=r.filter)==null?void 0:F.author)||"~",Q=((_=r.filter)==null?void 0:_.timestamp)||((g=r.filter)==null?void 0:g.timestampLt)||Number.MAX_SAFE_INTEGER,De=Number.MAX_SAFE_INTEGER,he=IDBKeyRange.bound([R,x,S,k],[De,Q,z,L]),Ue=e.index("comboIndex").getAll(he);Ue.onsuccess=()=>{Ue.result?n.resolve(Ue.result):n.resolve([])}}let s=await n;if(r.historyMode==="latest"){let S=s.splice(0,s.length),k=new Map;for(let x of S){let R=k.get(x.path);(!R||R.timestamp<x.timestamp)&&k.set(x.path,x)}s.push(...k.values())}let u=[];ln.debug("    filtering docs");let a=Date.now()*1e3;for(let S of s)S.deleteAfter&&S.deleteAfter<a||r.filter&&!Ji(S,r.filter)||u.push(S);if(ln.debug(`    ordering docs: ${r.orderBy}`),r.orderBy==="path ASC")u.sort(_h);else if(r.orderBy==="path DESC")u.sort(Ch);else if(r.orderBy==="localIndex ASC")u.sort(Us("_localIndex","ASC"));else if(r.orderBy==="localIndex DESC")u.sort(Us("_localIndex","DESC"));else if(r.orderBy)throw new M("unrecognized query orderBy: "+JSON.stringify(r.orderBy));return r.limit!==void 0&&s.length>=r.limit?u.slice(0,r.limit):(ln.debug(`    queryDocs is done: found ${u.length} docs.`),u)}async upsert(t){let e=await this.db,n=e.transaction([ut],"readwrite").objectStore(ut).index("pathAuthorIndex"),r=G(),i=n.openCursor([t.path,t.author]);if(await this.gotInitialMaxLocalIndex,this.localMaxLocalIndex+=1,t._localIndex=this.localMaxLocalIndex,i.onsuccess=()=>{if(i.result){let a=i.result.update(t);a.onsuccess=()=>{r.resolve(!!a.result)}}else r.resolve(!1)},await r)return t;let s=e.transaction([ut],"readwrite").objectStore(ut).put(t),u=G();return s.onsuccess=()=>{u.resolve()},s.onerror=()=>{throw s.error},await u,t}async eraseExpiredDocs(){let t=[],e=(await this.db).transaction([ut],"readwrite").objectStore(ut).index("deleteAfterIndex"),n=Date.now()*1e3,r=IDBKeyRange.bound(0,n),i=e.openCursor(r),s=G();return i.onsuccess=()=>{var u;if((u=i.result)!=null&&u.value){let a=i.result.value;if(a.deleteAfter!==null&&a.deleteAfter!==void 0){t.push(a);let o=i.result.delete();o.onsuccess=()=>{var l;(l=i.result)==null||l.continue()}}}else s.resolve()},await s,t}async getConfig(t){let e=(await this.db).transaction([dt],"readonly").objectStore(dt),n=G(),r=e.get(t);return r.onsuccess=()=>{var i;n.resolve((i=r.result)==null?void 0:i.value)},n}async setConfig(t,e){let n=(await this.db).transaction([dt],"readwrite").objectStore(dt),r=G(),i=n.put({key:t,value:e});return i.onsuccess=()=>{r.resolve()},r}async listConfigKeys(){let t=(await this.db).transaction([dt],"readonly").objectStore(dt),e=G(),n=t.index("keyIndex").openKeyCursor(),r=[];return n.onsuccess=()=>{n.result?(r.push(n.result.primaryKey),n.result.continue()):e.resolve(r)},e}async deleteConfig(t){let e=(await this.db).transaction([dt],"readwrite").objectStore(dt),n=G(),r=e.index("keyIndex"),i=IDBKeyRange.bound([t],[t]),s=r.openCursor(i);return s.onsuccess=()=>{if(s.result){let u=s.result.delete();u.onsuccess=()=>{n.resolve(!0)}}else n.resolve(!1)},n}},js=new We("replica driver indexeddb","gold"),pt="attachment_staging_index",at="attachments_index",nt="attachments_bytes",Fh=class{constructor(t,e){if(this.db=G(),this.closed=!1,this.share=t,!window.indexedDB)throw new Xe("IndexedDB is not supported by this runtime.");let n=window.indexedDB.open(`earthstar:share_attachments:${this.share}${e?`/${e}`:""}`,1);n.onerror=()=>{throw js.error(`Could not open IndexedDB for ${this.share}'s attachments.`),js.error(n.error),new Xe(`Could not open IndexedDB for ${this.share}'s attachments.`)},n.onupgradeneeded=function(){let r=n.result;r.createObjectStore(nt),r.createObjectStore(at,{keyPath:"id"}),r.createObjectStore(pt,{keyPath:"id"})},n.onsuccess=()=>{this.db.resolve(n.result)}}getIndexKey(t,e){return`${t}___${e}`}async getAttachment(t,e){if(this.closed)throw new Ce;let n=G(),r=this.getIndexKey(t,e),i=await this.db,s=i.transaction([at],"readonly").objectStore(at).get(r),u=G();return s.onerror=()=>{u.reject()},s.onsuccess=()=>{s.result===void 0?u.reject():u.resolve(s.result.blobKey)},u.then(a=>{let o=i.transaction([nt],"readonly").objectStore(nt).get(a);o.onsuccess=()=>{let l=new Blob([o.result]);n.resolve({bytes:async()=>new Uint8Array(await l.arrayBuffer()),stream:()=>Promise.resolve(l.stream())})},o.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(void 0)}),n}async erase(t,e){if(this.closed)throw new Ce;let n=G(),r=this.getIndexKey(t,e),i=await this.db,s=i.transaction([at],"readonly").objectStore(at).get(r),u=G();return s.onerror=()=>{u.reject()},s.onsuccess=()=>{i.transaction([at],"readwrite").objectStore(at).delete(r),s.result===void 0?u.reject():u.resolve(s.result.blobKey)},u.then(a=>{let o=i.transaction([nt],"readwrite").objectStore(nt).delete(a);o.onsuccess=()=>{n.resolve(!0)},o.onerror=()=>{n.resolve(void 0)}}).catch(()=>{n.resolve(new M("No attachment found"))}),n}async stage(t,e){if(this.closed)throw new Ce;let n=await this.db,r=e instanceof Uint8Array?e:await Ah(e),i=await Ie.sha256base32(r),s=this.getIndexKey(t,i),u=`${s}___${Wt()}`,a=n.transaction([nt,pt],"readwrite"),o=a.objectStore(nt).put(r,u),l=a.objectStore(pt).put({id:s,blobKey:u}),c=G(),h=G();return o.onsuccess=()=>c.resolve(),l.onsuccess=()=>h.resolve(),await c,await h,{hash:i,size:r.byteLength,reject:async()=>{let f=n.transaction([nt,pt],"readwrite"),d=f.objectStore(nt).delete(u),p=f.objectStore(pt).delete(s),D=G(),m=G();d.onsuccess=()=>{D.resolve()},p.onsuccess=()=>{m.resolve()},await Promise.all([D,m])},commit:async()=>{let f=n.transaction([at,pt],"readwrite"),d=f.objectStore(pt).delete(s),p=f.objectStore(at).put({id:s,blobKey:u}),D=G(),m=G();d.onsuccess=()=>D.resolve(),p.onsuccess=()=>m.resolve(),await Promise.all([D,m])}}}async wipe(){if(this.closed)throw new Ce;let t=(await this.db).transaction([nt,at,pt],"readwrite"),e=t.objectStore(nt).clear(),n=t.objectStore(at).clear(),r=t.objectStore(pt).clear(),i=G(),s=G(),u=G();e.onsuccess=()=>i.resolve(),n.onsuccess=()=>s.resolve(),r.onsuccess=()=>u.resolve(),await Promise.all([i,s,u])}async clearStaging(){if(this.closed)throw new Ce;let t=(await this.db).transaction([nt,pt]),e=t.objectStore(pt).openCursor(),n=G();return e.onsuccess=()=>{let r=e.result;if(!r){n.resolve();return}let i=r.value.blobKey,s=t.objectStore(nt).delete(i);r.delete(),s.onsuccess=()=>{r.continue()},s.onerror=()=>{r.continue()}},n}async filter(t){if(this.closed)throw new Ce;let e=(await this.db).transaction([nt,at],"readwrite"),n=50,r=[],i=[],s=G(),u=(a=null)=>{let o=e.objectStore(at).getAll(a,n);o.onsuccess=()=>{let l=o.result;for(let c of l){let[h,f]=c.id.split("___");t[h]&&!t[h].has(f)&&(r.push({format:h,hash:f}),i.push(this.erase(h,f)))}if(l.length===n){let c=l[l.length-1],h=IDBKeyRange.lowerBound(c.id,!0);u(h)}else s.resolve()}};return u(),await s,await Promise.all(i),r}isClosed(){return this.closed}async close(t){if(this.closed)throw new Ce;t&&await this.wipe(),this.closed=!0,(await this.db).close(),await La(20)}},kh=class{constructor(t,e){this.docDriver=new Eh(t,e),this.attachmentDriver=new Fh(t,e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const Sn=[];function Er(t,e){return{subscribe:Qa(t,e).subscribe}}function Qa(t,e=$){let n;const r=new Set;function i(a){if(re(t,a)&&(t=a,n)){const o=!Sn.length;for(const l of r)l[1](),Sn.push(l,t);if(o){for(let l=0;l<Sn.length;l+=2)Sn[l][0](Sn[l+1]);Sn.length=0}}}function s(a){i(a(t))}function u(a,o=$){const l=[a,o];return r.add(l),r.size===1&&(n=e(i)||$),a(t),()=>{r.delete(l),r.size===0&&(n(),n=null)}}return{set:i,update:s,subscribe:u}}function vh(t,e,n){const r=!Array.isArray(t),i=r?[t]:t,s=e.length<2;return Er(n,u=>{let a=!1;const o=[];let l=0,c=$;const h=()=>{if(l)return;c();const d=e(r?o[0]:o,u);s?u(d):c=wr(d)?d:$},f=i.map((d,p)=>ca(d,D=>{o[p]=D,l&=~(1<<p),a&&h()},()=>{l|=1<<p}));return a=!0,h(),function(){ot(f),c()}})}const Bh=Er({shareAddress:"+filesharing.b5measwv2ezjdw7zfrsgqpxlln4yvs5cvcefompv4gypg2ueflr3a",secret:"bkhu7fomnhbgqnecjnwstunaued7kxlvvazit43u7afizdfpvo4kq"});let Pi;Bh.subscribe(t=>{Pi=t});const Sh=new bh({driver:new kh(Pi.shareAddress),shareSecret:Pi.secret}),_n=Er({replica:Sh});class Jr extends Error{constructor(e){super(e||""),this.name="EarthstarError"}}class O extends Jr{constructor(e){super(e||"Validation error"),this.name="ValidationError"}}function ie(t){return t instanceof Jr}function Ka(t){return!(t instanceof Jr)}var pr={};Object.defineProperty(pr,"__esModule",{value:!0});var Ga=pr.setInterval=Za=pr.setTimeout=void 0;const xh=globalThis.setTimeout;function Ih(t,e,...n){const r=xh(t,e,...n);return typeof r=="number"?r:r[Symbol.toPrimitive]()}var Za=pr.setTimeout=Ih;const Th=globalThis.setInterval;function $h(t,e,...n){const r=Th(t,e,...n);return typeof r=="number"?r:r[Symbol.toPrimitive]()}Ga=pr.setInterval=$h;var ts={},Di,Ws;Object.defineProperty(ts,"__esModule",{value:!0});var Xa=ts.WeakRef=void 0;Xa=ts.WeakRef=(Di=globalThis.WeakRef)!==null&&Di!==void 0?Di:(Ws=class{constructor(e){}deref(){throw new Error("WeakRef is not supported in Node 14 and below.")}},Ws);const{Blob:Rh}=window,{Request:Ph,Response:Mh,Headers:Oh,fetch:j1}=window,{ReadableStream:Mi,ReadableStreamDefaultReader:W1,ReadableStreamBYOBReader:V1,ReadableStreamBYOBRequest:Q1,ReadableByteStreamController:K1,ReadableStreamDefaultController:G1,TransformStream:Nh,TransformStreamDefaultController:Lh,WritableStream:Uh,WritableStreamDefaultWriter:zh,WritableStreamDefaultController:Z1,ByteLengthQueuingStrategy:X1,CountQueuingStrategy:Y1,TextEncoderStream:J1,TextDecoderStream:em}=window;if(!Mi.prototype[Symbol.asyncIterator]){async function*t(){const e=this.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)return;yield r}}finally{e.releaseLock()}}Mi.prototype[Symbol.asyncIterator]=t}var $n=null;typeof WebSocket<"u"?$n=WebSocket:typeof MozWebSocket<"u"?$n=MozWebSocket:typeof global<"u"?$n=global.WebSocket||global.MozWebSocket:typeof window<"u"?$n=window.WebSocket||window.MozWebSocket:typeof self<"u"&&($n=self.WebSocket||self.MozWebSocket);const Hh=$n,{TextDecoder:Ya,TextEncoder:ns}=window;function Vs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ja(t,e,n){return e&&Vs(t.prototype,e),n&&Vs(t,n),t}function Qs(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function qr(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(i,s){if(i){if(typeof i=="string")return Qs(i,s);var u=Object.prototype.toString.call(i).slice(8,-1);return u==="Object"&&i.constructor&&(u=i.constructor.name),u==="Map"||u==="Set"?Array.from(i):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Qs(i,s):void 0}}(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var qh=/(?:[\$A-Z_a-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,jh=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/;function Wh(t,e){return(e?/^[\x00-\xFF]*$/:/^[\x00-\x7F]*$/).test(t)}function eo(t,e){e===void 0&&(e=!1);for(var n=[],r=0;r<t.length;){var i=t[r],s=function(d){if(!e)throw new TypeError(d);n.push({type:"INVALID_CHAR",index:r,value:t[r++]})};if(i!=="*")if(i!=="+"&&i!=="?")if(i!=="\\")if(i!=="{")if(i!=="}")if(i!==":")if(i!=="(")n.push({type:"CHAR",index:r,value:t[r++]});else{var u=1,a="",o=r+1,l=!1;if(t[o]==="?"){s('Pattern cannot start with "?" at '+o);continue}for(;o<t.length;){if(!Wh(t[o],!1)){s("Invalid character '"+t[o]+"' at "+o+"."),l=!0;break}if(t[o]!=="\\"){if(t[o]===")"){if(--u==0){o++;break}}else if(t[o]==="("&&(u++,t[o+1]!=="?")){s("Capturing groups are not allowed at "+o),l=!0;break}a+=t[o++]}else a+=t[o++]+t[o++]}if(l)continue;if(u){s("Unbalanced pattern at "+r);continue}if(!a){s("Missing pattern at "+r);continue}n.push({type:"PATTERN",index:r,value:a}),r=o}else{for(var c="",h=r+1;h<t.length;){var f=t.substr(h,1);if(!(h===r+1&&qh.test(f)||h!==r+1&&jh.test(f)))break;c+=t[h++]}if(!c){s("Missing parameter name at "+r);continue}n.push({type:"NAME",index:r,value:c}),r=h}else n.push({type:"CLOSE",index:r,value:t[r++]});else n.push({type:"OPEN",index:r,value:t[r++]});else n.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});else n.push({type:"MODIFIER",index:r,value:t[r++]});else n.push({type:"ASTERISK",index:r,value:t[r++]})}return n.push({type:"END",index:r,value:""}),n}function to(t,e){e===void 0&&(e={});for(var n=eo(t),r=e.prefixes,i=r===void 0?"./":r,s="[^"+Rn(e.delimiter||"/#?")+"]+?",u=[],a=0,o=0,l="",c=new Set,h=function(Q){if(o<n.length&&n[o].type===Q)return n[o++].value},f=function(){return h("MODIFIER")||h("ASTERISK")},d=function(Q){var De=h(Q);if(De!==void 0)return De;var he=n[o];throw new TypeError("Unexpected "+he.type+" at "+he.index+", expected "+Q)},p=function(){for(var Q,De="";Q=h("CHAR")||h("ESCAPED_CHAR");)De+=Q;return De},D=e.encodePart||function(Q){return Q};o<n.length;){var m=h("CHAR"),A=h("NAME"),F=h("PATTERN");if(A||F||!h("ASTERISK")||(F=".*"),A||F){var _=m||"";i.indexOf(_)===-1&&(l+=_,_=""),l&&(u.push(D(l)),l="");var g=A||a++;if(c.has(g))throw new TypeError("Duplicate name '"+g+"'.");c.add(g),u.push({name:g,prefix:D(_),suffix:"",pattern:F||s,modifier:f()||""})}else{var S=m||h("ESCAPED_CHAR");if(S)l+=S;else if(h("OPEN")){var k=p(),x=h("NAME")||"",R=h("PATTERN")||"";x||R||!h("ASTERISK")||(R=".*");var z=p();d("CLOSE");var L=f()||"";if(!x&&!R&&!L){l+=k;continue}if(!x&&!R&&!k)continue;l&&(u.push(D(l)),l=""),u.push({name:x||(R?a++:""),pattern:x&&!R?s:R,prefix:D(k),suffix:D(z),modifier:L})}else l&&(u.push(D(l)),l=""),d("END")}}return u}function Rn(t){return t.replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")}function no(t){return t&&t.sensitive?"u":"ui"}function ro(t,e,n){n===void 0&&(n={});for(var r,i=n.strict,s=i!==void 0&&i,u=n.start,a=u===void 0||u,o=n.end,l=o===void 0||o,c=n.encode,h=c===void 0?function(S){return S}:c,f="["+Rn(n.endsWith||"")+"]|$",d="["+Rn(n.delimiter||"/#?")+"]",p=a?"^":"",D=qr(t);!(r=D()).done;){var m=r.value;if(typeof m=="string")p+=Rn(h(m));else{var A=Rn(h(m.prefix)),F=Rn(h(m.suffix));m.pattern?(e&&e.push(m),p+=A||F?m.modifier==="+"||m.modifier==="*"?"(?:"+A+"((?:"+m.pattern+")(?:"+F+A+"(?:"+m.pattern+"))*)"+F+")"+(m.modifier==="*"?"?":""):"(?:"+A+"("+m.pattern+")"+F+")"+m.modifier:m.modifier==="+"||m.modifier==="*"?"((?:"+m.pattern+")"+m.modifier+")":"("+m.pattern+")"+m.modifier):p+="(?:"+A+F+")"+m.modifier}}if(l)s||(p+=d+"?"),p+=n.endsWith?"(?="+f+")":"$";else{var _=t[t.length-1],g=typeof _=="string"?d.indexOf(_[_.length-1])>-1:_===void 0;s||(p+="(?:"+d+"(?="+f+"))?"),g||(p+="(?="+d+"|"+f+")")}return new RegExp(p,no(n))}function io(t,e,n){return t instanceof RegExp?function(r,i){if(!i)return r;for(var s=/\((?:\?<(.*?)>)?(?!\?)/g,u=0,a=s.exec(r.source);a;)i.push({name:a[1]||u++,prefix:"",suffix:"",modifier:"",pattern:""}),a=s.exec(r.source);return r}(t,e):Array.isArray(t)?function(r,i,s){var u=r.map(function(a){return io(a,i,s).source});return new RegExp("(?:"+u.join("|")+")",no(s))}(t,e,n):function(r,i,s){return ro(to(r,s),i,s)}(t,e,n)}var Xt={delimiter:"",prefixes:"",sensitive:!0,strict:!0},Vh={delimiter:".",prefixes:"",sensitive:!0,strict:!0},Qh={delimiter:"/",prefixes:"/",sensitive:!0,strict:!0};function Ks(t,e){return t.startsWith(e)?t.substring(e.length,t.length):t}function so(t){return!(!t||t.length<2||t[0]!=="["&&(t[0]!=="\\"&&t[0]!=="{"||t[1]!=="["))}var K,uo=["ftp","file","http","https","ws","wss"];function ao(t){if(!t)return!0;for(var e,n=qr(uo);!(e=n()).done;)if(t.test(e.value))return!0;return!1}function oo(t){switch(t){case"ws":case"http":return"80";case"wws":case"https":return"443";case"ftp":return"21";default:return""}}function rs(t){if(t==="")return t;if(/^[-+.A-Za-z0-9]*$/.test(t))return t.toLowerCase();throw new TypeError("Invalid protocol '"+t+"'.")}function Kh(t){if(t==="")return t;var e=new URL("https://example.com");return e.username=t,e.username}function Gh(t){if(t==="")return t;var e=new URL("https://example.com");return e.password=t,e.password}function lo(t){if(t==="")return t;if(/[\t\n\r #%/:<>?@[\]^\\|]/g.test(t))throw new TypeError("Invalid hostname '"+t+"'");var e=new URL("https://example.com");return e.hostname=t,e.hostname}function co(t){if(t==="")return t;if(/[^0-9a-fA-F[\]:]/g.test(t))throw new TypeError("Invalid IPv6 hostname '"+t+"'");return t.toLowerCase()}function ho(t){if(t===""||/^[0-9]*$/.test(t)&&parseInt(t)<=65535)return t;throw new TypeError("Invalid port '"+t+"'.")}function Zh(t){if(t==="")return t;var e=new URL("https://example.com");return e.pathname=t[0]!=="/"?"/-"+t:t,t[0]!=="/"?e.pathname.substring(2,e.pathname.length):e.pathname}function Xh(t){return t===""?t:new URL("data:"+t).pathname}function Yh(t){if(t==="")return t;var e=new URL("https://example.com");return e.search=t,e.search.substring(1,e.search.length)}function Jh(t){if(t==="")return t;var e=new URL("https://example.com");return e.hash=t,e.hash.substring(1,e.hash.length)}(function(t){t[t.INIT=0]="INIT",t[t.PROTOCOL=1]="PROTOCOL",t[t.AUTHORITY=2]="AUTHORITY",t[t.USERNAME=3]="USERNAME",t[t.PASSWORD=4]="PASSWORD",t[t.HOSTNAME=5]="HOSTNAME",t[t.PORT=6]="PORT",t[t.PATHNAME=7]="PATHNAME",t[t.SEARCH=8]="SEARCH",t[t.HASH=9]="HASH",t[t.DONE=10]="DONE"})(K||(K={}));var ef=function(){function t(n){this.input=void 0,this.tokenList=[],this.internalResult={},this.tokenIndex=0,this.tokenIncrement=1,this.componentStart=0,this.state=K.INIT,this.groupDepth=0,this.hostnameIPv6BracketDepth=0,this.shouldTreatAsStandardURL=!1,this.input=n}var e=t.prototype;return e.parse=function(){for(this.tokenList=eo(this.input,!0);this.tokenIndex<this.tokenList.length;this.tokenIndex+=this.tokenIncrement){if(this.tokenIncrement=1,this.tokenList[this.tokenIndex].type==="END"){if(this.state===K.INIT){this.rewind(),this.isHashPrefix()?this.changeState(K.HASH,1):this.isSearchPrefix()?(this.changeState(K.SEARCH,1),this.internalResult.hash=""):(this.changeState(K.PATHNAME,0),this.internalResult.search="",this.internalResult.hash="");continue}if(this.state===K.AUTHORITY){this.rewindAndSetState(K.HOSTNAME);continue}this.changeState(K.DONE,0);break}if(this.groupDepth>0){if(!this.isGroupClose())continue;this.groupDepth-=1}if(this.isGroupOpen())this.groupDepth+=1;else switch(this.state){case K.INIT:this.isProtocolSuffix()&&(this.internalResult.username="",this.internalResult.password="",this.internalResult.hostname="",this.internalResult.port="",this.internalResult.pathname="",this.internalResult.search="",this.internalResult.hash="",this.rewindAndSetState(K.PROTOCOL));break;case K.PROTOCOL:if(this.isProtocolSuffix()){this.computeShouldTreatAsStandardURL();var n=K.PATHNAME,r=1;this.shouldTreatAsStandardURL&&(this.internalResult.pathname="/"),this.nextIsAuthoritySlashes()?(n=K.AUTHORITY,r=3):this.shouldTreatAsStandardURL&&(n=K.AUTHORITY),this.changeState(n,r)}break;case K.AUTHORITY:this.isIdentityTerminator()?this.rewindAndSetState(K.USERNAME):(this.isPathnameStart()||this.isSearchPrefix()||this.isHashPrefix())&&this.rewindAndSetState(K.HOSTNAME);break;case K.USERNAME:this.isPasswordPrefix()?this.changeState(K.PASSWORD,1):this.isIdentityTerminator()&&this.changeState(K.HOSTNAME,1);break;case K.PASSWORD:this.isIdentityTerminator()&&this.changeState(K.HOSTNAME,1);break;case K.HOSTNAME:this.isIPv6Open()?this.hostnameIPv6BracketDepth+=1:this.isIPv6Close()&&(this.hostnameIPv6BracketDepth-=1),this.isPortPrefix()&&!this.hostnameIPv6BracketDepth?this.changeState(K.PORT,1):this.isPathnameStart()?this.changeState(K.PATHNAME,0):this.isSearchPrefix()?this.changeState(K.SEARCH,1):this.isHashPrefix()&&this.changeState(K.HASH,1);break;case K.PORT:this.isPathnameStart()?this.changeState(K.PATHNAME,0):this.isSearchPrefix()?this.changeState(K.SEARCH,1):this.isHashPrefix()&&this.changeState(K.HASH,1);break;case K.PATHNAME:this.isSearchPrefix()?this.changeState(K.SEARCH,1):this.isHashPrefix()&&this.changeState(K.HASH,1);break;case K.SEARCH:this.isHashPrefix()&&this.changeState(K.HASH,1)}}},e.changeState=function(n,r){switch(this.state){case K.INIT:break;case K.PROTOCOL:this.internalResult.protocol=this.makeComponentString();break;case K.AUTHORITY:break;case K.USERNAME:this.internalResult.username=this.makeComponentString();break;case K.PASSWORD:this.internalResult.password=this.makeComponentString();break;case K.HOSTNAME:this.internalResult.hostname=this.makeComponentString();break;case K.PORT:this.internalResult.port=this.makeComponentString();break;case K.PATHNAME:this.internalResult.pathname=this.makeComponentString();break;case K.SEARCH:this.internalResult.search=this.makeComponentString();break;case K.HASH:this.internalResult.hash=this.makeComponentString()}this.changeStateWithoutSettingComponent(n,r)},e.changeStateWithoutSettingComponent=function(n,r){this.state=n,this.componentStart=this.tokenIndex+r,this.tokenIndex+=r,this.tokenIncrement=0},e.rewind=function(){this.tokenIndex=this.componentStart,this.tokenIncrement=0},e.rewindAndSetState=function(n){this.rewind(),this.state=n},e.safeToken=function(n){return n<0&&(n=this.tokenList.length-n),n<this.tokenList.length?this.tokenList[n]:this.tokenList[this.tokenList.length-1]},e.isNonSpecialPatternChar=function(n,r){var i=this.safeToken(n);return i.value===r&&(i.type==="CHAR"||i.type==="ESCAPED_CHAR"||i.type==="INVALID_CHAR")},e.isProtocolSuffix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.nextIsAuthoritySlashes=function(){return this.isNonSpecialPatternChar(this.tokenIndex+1,"/")&&this.isNonSpecialPatternChar(this.tokenIndex+2,"/")},e.isIdentityTerminator=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"@")},e.isPasswordPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPortPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,":")},e.isPathnameStart=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"/")},e.isSearchPrefix=function(){if(this.isNonSpecialPatternChar(this.tokenIndex,"?"))return!0;if(this.tokenList[this.tokenIndex].value!=="?")return!1;var n=this.safeToken(this.tokenIndex-1);return n.type!=="NAME"&&n.type!=="PATTERN"&&n.type!=="CLOSE"&&n.type!=="ASTERISK"},e.isHashPrefix=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"#")},e.isGroupOpen=function(){return this.tokenList[this.tokenIndex].type=="OPEN"},e.isGroupClose=function(){return this.tokenList[this.tokenIndex].type=="CLOSE"},e.isIPv6Open=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"[")},e.isIPv6Close=function(){return this.isNonSpecialPatternChar(this.tokenIndex,"]")},e.makeComponentString=function(){var n=this.tokenList[this.tokenIndex],r=this.safeToken(this.componentStart).index;return this.input.substring(r,n.index)},e.computeShouldTreatAsStandardURL=function(){var n={};Object.assign(n,Xt),n.encodePart=rs;var r=io(this.makeComponentString(),void 0,n);this.shouldTreatAsStandardURL=ao(r)},Ja(t,[{key:"result",get:function(){return this.internalResult}}]),t}(),tf=["protocol","username","password","hostname","port","pathname","search","hash"];function Gs(t,e){if(typeof t!="string")throw new TypeError("parameter 1 is not of type 'string'.");var n=new URL(t,e);return{protocol:n.protocol.substring(0,n.protocol.length-1),username:n.username,password:n.password,hostname:n.hostname,port:n.port,pathname:n.pathname,search:n.search!=""?n.search.substring(1,n.search.length):void 0,hash:n.hash!=""?n.hash.substring(1,n.hash.length):void 0}}function mi(t,e,n){var r;if(typeof e.baseURL=="string")try{r=new URL(e.baseURL),t.protocol=r.protocol?r.protocol.substring(0,r.protocol.length-1):"",t.username=r.username,t.password=r.password,t.hostname=r.hostname,t.port=r.port,t.pathname=r.pathname,t.search=r.search?r.search.substring(1,r.search.length):"",t.hash=r.hash?r.hash.substring(1,r.hash.length):""}catch{throw new TypeError("invalid baseURL '"+e.baseURL+"'.")}if(typeof e.protocol=="string"&&(t.protocol=function(s,u){var a;return s=(a=s).endsWith(":")?a.substr(0,a.length-1):a,u||s===""?s:rs(s)}(e.protocol,n)),typeof e.username=="string"&&(t.username=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.username=s,a.username}(e.username,n)),typeof e.password=="string"&&(t.password=function(s,u){if(u||s==="")return s;var a=new URL("https://example.com");return a.password=s,a.password}(e.password,n)),typeof e.hostname=="string"&&(t.hostname=function(s,u){return u||s===""?s:so(s)?co(s):lo(s)}(e.hostname,n)),typeof e.port=="string"&&(t.port=function(s,u,a){return oo(u)===s&&(s=""),a||s===""?s:ho(s)}(e.port,t.protocol,n)),typeof e.pathname=="string"){if(t.pathname=e.pathname,r&&!function(s,u){return!(!s.length||s[0]!=="/"&&(!u||s.length<2||s[0]!="\\"&&s[0]!="{"||s[1]!="/"))}(t.pathname,n)){var i=r.pathname.lastIndexOf("/");i>=0&&(t.pathname=r.pathname.substring(0,i+1)+t.pathname)}t.pathname=function(s,u,a){if(a||s==="")return s;if(u&&!uo.includes(u))return new URL(u+":"+s).pathname;var o=s[0]=="/";return s=new URL(o?s:"/-"+s,"https://example.com").pathname,o||(s=s.substring(2,s.length)),s}(t.pathname,t.protocol,n)}return typeof e.search=="string"&&(t.search=function(s,u){if(s=Ks(s,"?"),u||s==="")return s;var a=new URL("https://example.com");return a.search=s,a.search?a.search.substring(1,a.search.length):""}(e.search,n)),typeof e.hash=="string"&&(t.hash=function(s,u){if(s=Ks(s,"#"),u||s==="")return s;var a=new URL("https://example.com");return a.hash=s,a.hash?a.hash.substring(1,a.hash.length):""}(e.hash,n)),t}function Yn(t){return t.replace(/([+*?:{}()\\])/g,"\\$1")}function nf(t,e){for(var n="[^"+(e.delimiter||"/#?").replace(/([.+*?^${}()[\]|/\\])/g,"\\$1")+"]+?",r=/(?:[\$0-9A-Z_a-z\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D81-\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA827\uA82C\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDE80-\uDEA9\uDEAB\uDEAC\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD47\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDCE-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E-\uDC61\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD35\uDD37\uDD38\uDD3B-\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFE4\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A]|\uDB40[\uDD00-\uDDEF])/,i="",s=0;s<t.length;++s){var u=t[s],a=s>0?t[s-1]:null,o=s<t.length-1?t[s+1]:null;if(typeof u!="string")if(u.pattern!==""){var l=typeof u.name!="number",c=e.prefixes!==void 0?e.prefixes:"./",h=u.suffix!==""||u.prefix!==""&&(u.prefix.length!==1||!c.includes(u.prefix));h||!l||u.pattern!==n||u.modifier!==""||!o||o.prefix||o.suffix||(h=typeof o=="string"?r.test(o.length>0?o[0]:""):typeof o.name=="number"),!h&&u.prefix===""&&a&&typeof a=="string"&&a.length>0&&(h=c.includes(a[a.length-1])),h&&(i+="{"),i+=Yn(u.prefix),l&&(i+=":"+u.name),u.pattern===".*"?i+=l||a&&typeof a!="string"&&!a.modifier&&!h&&u.prefix===""?"(.*)":"*":u.pattern===n?l||(i+="("+n+")"):i+="("+u.pattern+")",u.pattern===n&&l&&u.suffix!==""&&r.test(u.suffix[0])&&(i+="\\"),i+=Yn(u.suffix),h&&(i+="}"),i+=u.modifier}else{if(u.modifier===""){i+=Yn(u.prefix);continue}i+="{"+Yn(u.prefix)+"}"+u.modifier}else i+=Yn(u)}return i}var rf=function(){function t(n,r){n===void 0&&(n={}),this.pattern=void 0,this.regexp={},this.keys={},this.component_pattern={};try{if(typeof n=="string"){var i=new ef(n);if(i.parse(),n=i.result,r){if(typeof r!="string")throw new TypeError("'baseURL' parameter is not of type 'string'.");n.baseURL=r}else if(typeof n.protocol!="string")throw new TypeError("A base URL must be provided for a relative constructor string.")}else if(r)throw new TypeError("parameter 1 is not of type 'string'.");if(!n||typeof n!="object")throw new TypeError("parameter 1 is not of type 'string' and cannot convert to dictionary.");var s;this.pattern=mi({pathname:"*",protocol:"*",username:"*",password:"*",hostname:"*",port:"*",search:"*",hash:"*"},n,!0),oo(this.pattern.protocol)===this.pattern.port&&(this.pattern.port="");for(var u,a=qr(tf);!(u=a()).done;)if((s=u.value)in this.pattern){var o={},l=this.pattern[s];switch(this.keys[s]=[],s){case"protocol":Object.assign(o,Xt),o.encodePart=rs;break;case"username":Object.assign(o,Xt),o.encodePart=Kh;break;case"password":Object.assign(o,Xt),o.encodePart=Gh;break;case"hostname":Object.assign(o,Vh),o.encodePart=so(l)?co:lo;break;case"port":Object.assign(o,Xt),o.encodePart=ho;break;case"pathname":ao(this.regexp.protocol)?(Object.assign(o,Qh),o.encodePart=Zh):(Object.assign(o,Xt),o.encodePart=Xh);break;case"search":Object.assign(o,Xt),o.encodePart=Yh;break;case"hash":Object.assign(o,Xt),o.encodePart=Jh}try{var c=to(l,o);this.regexp[s]=ro(c,this.keys[s],o),this.component_pattern[s]=nf(c,o)}catch{throw new TypeError("invalid "+s+" pattern '"+this.pattern[s]+"'.")}}}catch(h){throw new TypeError("Failed to construct 'URLPattern': "+h.message)}}var e=t.prototype;return e.test=function(n,r){n===void 0&&(n={});var i,s={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(n===void 0)return!1;try{s=mi(s,typeof n=="object"?n:Gs(n,r),!1)}catch{return!1}for(i in this.pattern)if(!this.regexp[i].exec(s[i]))return!1;return!0},e.exec=function(n,r){n===void 0&&(n={});var i={pathname:"",protocol:"",username:"",password:"",hostname:"",port:"",search:"",hash:""};if(typeof n!="string"&&r)throw new TypeError("parameter 1 is not of type 'string'.");if(n!==void 0){try{i=mi(i,typeof n=="object"?n:Gs(n,r),!1)}catch{return null}var s,u={};for(s in u.inputs=r?[n,r]:[n],this.pattern){var a=this.regexp[s].exec(i[s]);if(!a)return null;for(var o,l={},c=qr(this.keys[s].entries());!(o=c()).done;){var h=o.value,f=h[1];typeof f.name!="string"&&typeof f.name!="number"||(l[f.name]=a[h[0]+1]||"")}u[s]={input:i[s]||"",groups:l}}return u}},Ja(t,[{key:"protocol",get:function(){return this.component_pattern.protocol}},{key:"username",get:function(){return this.component_pattern.username}},{key:"password",get:function(){return this.component_pattern.password}},{key:"hostname",get:function(){return this.component_pattern.hostname}},{key:"port",get:function(){return this.component_pattern.port}},{key:"pathname",get:function(){return this.component_pattern.pathname}},{key:"search",get:function(){return this.component_pattern.search}},{key:"hash",get:function(){return this.component_pattern.hash}}]),t}();const sf={setInterval:Ga,setTimeout:Za,WeakRef:Xa,Blob:Rh,Request:Ph,Response:Mh,Headers:Oh,WritableStream:Uh,TransformStream:Nh,ReadableStream:Mi,TransformStreamDefaultController:Lh,WritableStreamDefaultWriter:zh,WebSocket:Hh,TextEncoder:ns,TextDecoder:Ya,URLPattern:rf};uf(globalThis,sf);function uf(t,e){return new Proxy(t,{get(n,r,i){return r in e?e[r]:t[r]},set(n,r,i){return r in e&&delete e[r],t[r]=i,!0},deleteProperty(n,r){let i=!1;return r in e&&(delete e[r],i=!0),r in t&&(delete t[r],i=!0),i},ownKeys(n){const r=Reflect.ownKeys(t),i=Reflect.ownKeys(e),s=new Set(i);return[...r.filter(u=>!s.has(u)),...i]},defineProperty(n,r,i){return r in e&&delete e[r],Reflect.defineProperty(t,r,i),!0},getOwnPropertyDescriptor(n,r){return r in e?Reflect.getOwnPropertyDescriptor(e,r):Reflect.getOwnPropertyDescriptor(t,r)},has(n,r){return r in e||r in t}})}var st={};Object.defineProperty(st,"__esModule",{value:!0});function jn(t,e,n){var r;if(n===void 0&&(n={}),!e.codes){e.codes={};for(var i=0;i<e.chars.length;++i)e.codes[e.chars[i]]=i}if(!n.loose&&t.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var s=t.length;t[s-1]==="=";)if(--s,!n.loose&&!((t.length-s)*e.bits&7))throw new SyntaxError("Invalid padding");for(var u=new((r=n.out)!=null?r:Uint8Array)(s*e.bits/8|0),a=0,o=0,l=0,c=0;c<s;++c){var h=e.codes[t[c]];if(h===void 0)throw new SyntaxError("Invalid character "+t[c]);o=o<<e.bits|h,a+=e.bits,a>=8&&(a-=8,u[l++]=255&o>>a)}if(a>=e.bits||255&o<<8-a)throw new SyntaxError("Unexpected end of data");return u}function Wn(t,e,n){n===void 0&&(n={});for(var r=n,i=r.pad,s=i===void 0?!0:i,u=(1<<e.bits)-1,a="",o=0,l=0,c=0;c<t.length;++c)for(l=l<<8|255&t[c],o+=8;o>e.bits;)o-=e.bits,a+=e.chars[u&l>>o];if(o&&(a+=e.chars[u&l<<e.bits-o]),s)for(;a.length*e.bits&7;)a+="=";return a}var Zs={chars:"0123456789ABCDEF",bits:4},Xs={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bits:5},Ys={chars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bits:5},Js={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bits:6},eu={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6},af={parse:function(e,n){return jn(e.toUpperCase(),Zs,n)},stringify:function(e,n){return Wn(e,Zs,n)}},of={parse:function(e,n){return n===void 0&&(n={}),jn(n.loose?e.toUpperCase().replace(/0/g,"O").replace(/1/g,"L").replace(/8/g,"B"):e,Xs,n)},stringify:function(e,n){return Wn(e,Xs,n)}},lf={parse:function(e,n){return jn(e,Ys,n)},stringify:function(e,n){return Wn(e,Ys,n)}},cf={parse:function(e,n){return jn(e,Js,n)},stringify:function(e,n){return Wn(e,Js,n)}},hf={parse:function(e,n){return jn(e,eu,n)},stringify:function(e,n){return Wn(e,eu,n)}},ff={parse:jn,stringify:Wn};st.base16=af;st.base32=of;st.base32hex=lf;st.base64=cf;st.base64url=hf;st.codec=ff;const df=st.base16,pf=st.base32,Df=st.base32hex,mf=st.base64,gf=st.base64url,wf=st.codec,bf=Object.freeze(Object.defineProperty({__proto__:null,base16:df,base32:pf,base32hex:Df,base64:mf,base64url:gf,codec:wf,default:st},Symbol.toStringTag,{value:"Module"}));var gn={};Object.defineProperty(gn,"__esModule",{value:!0});var fo=gn.Hash=po=gn.createHash=void 0;const yf=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],tu={sha256:1};function Af(t){if(t&&!tu[t]&&!tu[t.toLowerCase()])throw new Error("Digest method not supported");return new Do}var po=gn.createHash=Af;class Do{constructor(){this.A=1779033703,this.B=-1150833019,this.C=1013904242,this.D=-1521486534,this.E=1359893119,this.F=-1694144372,this.G=528734635,this.H=1541459225,this._size=0,this._sp=0,(!Sr||Jn>=8e3)&&(Sr=new ArrayBuffer(8e3),Jn=0),this._byte=new Uint8Array(Sr,Jn,80),this._word=new Int32Array(Sr,Jn,20),Jn+=80}update(e){if(typeof e=="string")return this._utf8(e);if(e==null)throw new TypeError("Invalid type: "+typeof e);const n=e.byteOffset,r=e.byteLength;let i=r/64|0,s=0;if(i&&!(n&3)&&!(this._size%64)){const a=new Int32Array(e.buffer,n,i*16);for(;i--;)this._int32(a,s>>2),s+=64;this._size+=s}if(e.BYTES_PER_ELEMENT!==1&&e.buffer){const a=new Uint8Array(e.buffer,n+s,r-s);return this._uint8(a)}return s===r?this:this._uint8(e,s)}_uint8(e,n){const{_byte:r,_word:i}=this,s=e.length;for(n=n|0;n<s;){const u=this._size%64;let a=u;for(;n<s&&a<64;)r[a++]=e[n++];a>=64&&this._int32(i),this._size+=a-u}return this}_utf8(e){const{_byte:n,_word:r}=this,i=e.length;let s=this._sp;for(let u=0;u<i;){const a=this._size%64;let o=a;for(;u<i&&o<64;){let l=e.charCodeAt(u++)|0;l<128?n[o++]=l:l<2048?(n[o++]=192|l>>>6,n[o++]=128|l&63):l<55296||l>57343?(n[o++]=224|l>>>12,n[o++]=128|l>>>6&63,n[o++]=128|l&63):s?(l=((s&1023)<<10)+(l&1023)+65536,n[o++]=240|l>>>18,n[o++]=128|l>>>12&63,n[o++]=128|l>>>6&63,n[o++]=128|l&63,s=0):s=l}o>=64&&(this._int32(r),r[0]=r[16]),this._size+=o-a}return this._sp=s,this}_int32(e,n){let{A:r,B:i,C:s,D:u,E:a,F:o,G:l,H:c}=this,h=0;for(n=n|0;h<16;)cn[h++]=Dt(e[n++]);for(h=16;h<64;h++)cn[h]=Sf(cn[h-2])+cn[h-7]+Bf(cn[h-15])+cn[h-16]|0;for(h=0;h<64;h++){const f=c+vf(a)+Ef(a,o,l)+yf[h]+cn[h]|0,d=kf(r)+Ff(r,i,s)|0;c=l,l=o,o=a,a=u+f|0,u=s,s=i,i=r,r=f+d|0}this.A=r+this.A|0,this.B=i+this.B|0,this.C=s+this.C|0,this.D=u+this.D|0,this.E=a+this.E|0,this.F=o+this.F|0,this.G=l+this.G|0,this.H=c+this.H|0}digest(e){const{_byte:n,_word:r}=this;let i=this._size%64|0;for(n[i++]=128;i&3;)n[i++]=0;if(i>>=2,i>14){for(;i<16;)r[i++]=0;i=0,this._int32(r)}for(;i<16;)r[i++]=0;const s=this._size*8,u=(s&4294967295)>>>0,a=(s-u)/4294967296;return a&&(r[14]=Dt(a)),u&&(r[15]=Dt(u)),this._int32(r),e==="hex"?this._hex():this._bin()}_hex(){const{A:e,B:n,C:r,D:i,E:s,F:u,G:a,H:o}=this;return Kt(e)+Kt(n)+Kt(r)+Kt(i)+Kt(s)+Kt(u)+Kt(a)+Kt(o)}_bin(){const{A:e,B:n,C:r,D:i,E:s,F:u,G:a,H:o,_byte:l,_word:c}=this;return c[0]=Dt(e),c[1]=Dt(n),c[2]=Dt(r),c[3]=Dt(i),c[4]=Dt(s),c[5]=Dt(u),c[6]=Dt(a),c[7]=Dt(o),l.slice(0,32)}}fo=gn.Hash=Do;const cn=new Int32Array(64);let Sr,Jn=0;const Kt=t=>(t+4294967296).toString(16).substr(-8),_f=t=>t<<24&4278190080|t<<8&16711680|t>>8&65280|t>>24&255,Cf=t=>t,Dt=xf()?Cf:_f,Ef=(t,e,n)=>n^t&(e^n),Ff=(t,e,n)=>t&e|n&(t|e),kf=t=>(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),vf=t=>(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7),Bf=t=>(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3,Sf=t=>(t>>>17|t<<15)^(t>>>19|t<<13)^t>>>10;function xf(){return new Uint8Array(new Uint16Array([65279]).buffer)[0]===254}const If=qo({__proto__:null,get Hash(){return fo},get createHash(){return po},default:gn},[gn]),Tf={};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const $e=BigInt(0),ce=BigInt(1),Ge=BigInt(2),mo=BigInt(255),nu=Ge**BigInt(252)+BigInt("27742317777372353535851937790883648493"),ge={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:Ge**mo-BigInt(19),l:nu,n:nu,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")},go=Ge**BigInt(256),or=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742");const $f=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Rf=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Pf=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Mf=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class fe{constructor(e,n,r,i){this.x=e,this.y=n,this.z=r,this.t=i}static fromAffine(e){if(!(e instanceof Be))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Be.ZERO)?fe.ZERO:new fe(e.x,e.y,ce,T(e.x*e.y))}static toAffineBatch(e){const n=Lf(e.map(r=>r.z));return e.map((r,i)=>r.toAffine(n[i]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){ru(e);const{x:n,y:r,z:i}=this,{x:s,y:u,z:a}=e,o=T(n*a),l=T(s*i),c=T(r*a),h=T(u*i);return o===l&&c===h}negate(){return new fe(T(-this.x),this.y,this.z,T(-this.t))}double(){const{x:e,y:n,z:r}=this,{a:i}=ge,s=T(e**Ge),u=T(n**Ge),a=T(Ge*T(r**Ge)),o=T(i*s),l=T(T((e+n)**Ge)-s-u),c=o+u,h=c-a,f=o-u,d=T(l*h),p=T(c*f),D=T(l*f),m=T(h*c);return new fe(d,p,m,D)}add(e){ru(e);const{x:n,y:r,z:i,t:s}=this,{x:u,y:a,z:o,t:l}=e,c=T((r-n)*(a+u)),h=T((r+n)*(a-u)),f=T(h-c);if(f===$e)return this.double();const d=T(i*Ge*l),p=T(s*Ge*o),D=p+d,m=h+c,A=p-d,F=T(D*f),_=T(m*A),g=T(D*A),S=T(f*m);return new fe(F,_,S,g)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const n=1+256/e,r=[];let i=this,s=i;for(let u=0;u<n;u++){s=i,r.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(i),r.push(s);i=s.double()}return r}wNAF(e,n){!n&&this.equals(fe.BASE)&&(n=Be.BASE);const r=n&&n._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=n&&Oi.get(n);i||(i=this.precomputeWindow(r),n&&r!==1&&(i=fe.normalizeZ(i),Oi.set(n,i)));let s=fe.ZERO,u=fe.ZERO;const a=1+256/r,o=2**(r-1),l=BigInt(2**r-1),c=2**r,h=BigInt(r);for(let f=0;f<a;f++){const d=f*o;let p=Number(e&l);if(e>>=h,p>o&&(p-=c,e+=ce),p===0){let D=i[d];f%2&&(D=D.negate()),u=u.add(D)}else{let D=i[d+Math.abs(p)-1];p<0&&(D=D.negate()),s=s.add(D)}}return fe.normalizeZ([s,u])[0]}multiply(e,n){return this.wNAF(jr(e,ge.l),n)}multiplyUnsafe(e){let n=jr(e,ge.l,!1);const r=fe.BASE,i=fe.ZERO;if(n===$e)return i;if(this.equals(i)||n===ce)return this;if(this.equals(r))return this.wNAF(n);let s=i,u=this;for(;n>$e;)n&ce&&(s=s.add(u)),u=u.double(),n>>=ce;return s}isSmallOrder(){return this.multiplyUnsafe(ge.h).equals(fe.ZERO)}isTorsionFree(){return this.multiplyUnsafe(ge.l).equals(fe.ZERO)}toAffine(e=ei(this.z)){const{x:n,y:r,z:i}=this,s=T(n*e),u=T(r*e);if(T(i*e)!==ce)throw new Error("invZ was invalid");return new Be(s,u)}fromRistrettoBytes(){wi()}toRistrettoBytes(){wi()}fromRistrettoHash(){wi()}}fe.BASE=new fe(ge.Gx,ge.Gy,ce,T(ge.Gx*ge.Gy));fe.ZERO=new fe($e,ce,ce,$e);function ru(t){if(!(t instanceof fe))throw new TypeError("ExtendedPoint expected")}function gi(t){if(!(t instanceof ct))throw new TypeError("RistrettoPoint expected")}function wi(){throw new Error("Legacy method: switch to RistrettoPoint")}class ct{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:n}=ge,r=T(or*e*e),i=T((r+ce)*Pf);let s=BigInt(-1);const u=T((s-n*r)*T(r+n));let{isValid:a,value:o}=is(i,u),l=T(o*e);Yt(l)||(l=T(-l)),a||(o=l),a||(s=r);const c=T(s*(r-ce)*Mf-u),h=o*o,f=T((o+o)*u),d=T(c*$f),p=T(ce-h),D=T(ce+h);return new fe(T(f*D),T(p*d),T(d*D),T(f*p))}static hashToCurve(e){e=en(e,64);const n=bi(e.slice(0,32)),r=this.calcElligatorRistrettoMap(n),i=bi(e.slice(32,64)),s=this.calcElligatorRistrettoMap(i);return new ct(r.add(s))}static fromHex(e){e=en(e,32);const{a:n,d:r}=ge,i="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=bi(e);if(!zf(mr(s),e)||Yt(s))throw new Error(i);const u=T(s*s),a=T(ce+n*u),o=T(ce-n*u),l=T(a*a),c=T(o*o),h=T(n*r*l-c),{isValid:f,value:d}=iu(T(h*c)),p=T(d*o),D=T(d*p*h);let m=T((s+s)*p);Yt(m)&&(m=T(-m));const A=T(a*D),F=T(m*A);if(!f||Yt(F)||A===$e)throw new Error(i);return new ct(new fe(m,A,ce,F))}toRawBytes(){let{x:e,y:n,z:r,t:i}=this.ep;const s=T(T(r+n)*T(r-n)),u=T(e*n),{value:a}=iu(T(s*u**Ge)),o=T(a*s),l=T(a*u),c=T(o*l*i);let h;if(Yt(i*c)){let d=T(n*or),p=T(e*or);e=d,n=p,h=T(o*Rf)}else h=l;Yt(e*c)&&(n=T(-n));let f=T((r-n)*h);return Yt(f)&&(f=T(-f)),mr(f)}toHex(){return Fr(this.toRawBytes())}toString(){return this.toHex()}equals(e){gi(e);const n=this.ep,r=e.ep,i=T(n.x*r.y)===T(n.y*r.x),s=T(n.y*r.y)===T(n.x*r.x);return i||s}add(e){return gi(e),new ct(this.ep.add(e.ep))}subtract(e){return gi(e),new ct(this.ep.subtract(e.ep))}multiply(e){return new ct(this.ep.multiply(e))}multiplyUnsafe(e){return new ct(this.ep.multiplyUnsafe(e))}}ct.BASE=new ct(fe.BASE);ct.ZERO=new ct(fe.ZERO);const Oi=new WeakMap;class Be{constructor(e,n){this.x=e,this.y=n}_setWindowSize(e){this._WINDOW_SIZE=e,Oi.delete(this)}static fromHex(e,n=!0){const{d:r,P:i}=ge;e=en(e,32);const s=e.slice();s[31]=e[31]&-129;const u=Vn(s);if(n&&u>=i)throw new Error("Expected 0 < hex < P");if(!n&&u>=go)throw new Error("Expected 0 < hex < 2**256");const a=T(u*u),o=T(a-ce),l=T(r*a+ce);let{isValid:c,value:h}=is(o,l);if(!c)throw new Error("Point.fromHex: invalid y coordinate");const f=(h&ce)===ce;return(e[31]&128)!==0!==f&&(h=T(-h)),new Be(h,u)}static async fromPrivateKey(e){return(await ti(e)).point}toRawBytes(){const e=mr(this.y);return e[31]|=this.x&ce?128:0,e}toHex(){return Fr(this.toRawBytes())}toX25519(){const{y:e}=this,n=T((ce+e)*ei(ce-e));return mr(n)}isTorsionFree(){return fe.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Be(T(-this.x),this.y)}add(e){return fe.fromAffine(this).add(fe.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return fe.fromAffine(this).multiply(e,this).toAffine()}}Be.BASE=new Be(ge.Gx,ge.Gy);Be.ZERO=new Be($e,ce);class Dr{constructor(e,n){this.r=e,this.s=n,this.assertValidity()}static fromHex(e){const n=en(e,64),r=Be.fromHex(n.slice(0,32),!1),i=Vn(n.slice(32,64));return new Dr(r,i)}assertValidity(){const{r:e,s:n}=this;if(!(e instanceof Be))throw new Error("Expected Point instance");return jr(n,ge.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(mr(this.s),32),e}toHex(){return Fr(this.toRawBytes())}}function Of(...t){if(!t.every(r=>r instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];const e=t.reduce((r,i)=>r+i.length,0),n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const Nf=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Fr(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Nf[t[n]];return e}function wo(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=n*2,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[n]=s}return e}function bo(t){const n=t.toString(16).padStart(64,"0");return wo(n)}function mr(t){return bo(t).reverse()}function Yt(t){return(T(t)&ce)===ce}function Vn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Fr(Uint8Array.from(t).reverse()))}function bi(t){return T(Vn(t)&Ge**mo-ce)}function T(t,e=ge.P){const n=t%e;return n>=$e?n:e+n}function ei(t,e=ge.P){if(t===$e||e<=$e)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=T(t,e),r=e,i=$e,s=ce;for(;n!==$e;){const a=r/n,o=r%n,l=i-s*a;r=n,n=o,i=s,s=l}if(r!==ce)throw new Error("invert: does not exist");return T(i,e)}function Lf(t,e=ge.P){const n=new Array(t.length),r=t.reduce((s,u,a)=>u===$e?s:(n[a]=s,T(s*u,e)),ce),i=ei(r,e);return t.reduceRight((s,u,a)=>u===$e?s:(n[a]=T(s*n[a],e),T(s*u,e)),i),n}function bt(t,e){const{P:n}=ge;let r=t;for(;e-- >$e;)r*=r,r%=n;return r}function Uf(t){const{P:e}=ge,n=BigInt(5),r=BigInt(10),i=BigInt(20),s=BigInt(40),u=BigInt(80),o=t*t%e*t%e,l=bt(o,Ge)*o%e,c=bt(l,ce)*t%e,h=bt(c,n)*c%e,f=bt(h,r)*h%e,d=bt(f,i)*f%e,p=bt(d,s)*d%e,D=bt(p,u)*p%e,m=bt(D,u)*p%e,A=bt(m,r)*h%e;return{pow_p_5_8:bt(A,Ge)*t%e,b2:o}}function is(t,e){const n=T(e*e*e),r=T(n*n*e),i=Uf(t*r).pow_p_5_8;let s=T(t*n*i);const u=T(e*s*s),a=s,o=T(s*or),l=u===t,c=u===T(-t),h=u===T(-t*or);return l&&(s=a),(c||h)&&(s=o),Yt(s)&&(s=T(-s)),{isValid:l||c,value:s}}function iu(t){return is(ce,t)}async function Ni(...t){const e=await ni.sha512(Of(...t)),n=Vn(e);return T(n,ge.l)}function zf(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function en(t,e){const n=t instanceof Uint8Array?Uint8Array.from(t):wo(t);if(typeof e=="number"&&n.length!==e)throw new Error(`Expected ${e} bytes`);return n}function jr(t,e,n=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(n){if($e<t)return t}else if($e<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function Hf(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}async function ti(t){if(t=typeof t=="bigint"||typeof t=="number"?bo(jr(t,go)):en(t),t.length!==32)throw new Error("Expected 32 bytes");const e=await ni.sha512(t),n=Hf(e.slice(0,32)),r=e.slice(32,64),i=T(Vn(n),ge.l),s=Be.BASE.multiply(i),u=s.toRawBytes();return{head:n,prefix:r,scalar:i,point:s,pointBytes:u}}async function qf(t){return(await ti(t)).pointBytes}async function jf(t,e){t=en(t);const{prefix:n,scalar:r,pointBytes:i}=await ti(e),s=await Ni(n,t),u=Be.BASE.multiply(s),a=await Ni(u.toRawBytes(),i,t),o=T(s+a*r,ge.l);return new Dr(u,o).toRawBytes()}async function Wf(t,e,n){e=en(e),n instanceof Be||(n=Be.fromHex(n,!1));const{r,s:i}=t instanceof Dr?t.assertValidity():Dr.fromHex(t),s=fe.BASE.multiplyUnsafe(i),u=await Ni(r.toRawBytes(),n.toRawBytes(),e),a=fe.fromAffine(n).multiplyUnsafe(u);return fe.fromAffine(r).add(a).subtract(s).multiplyUnsafe(ge.h).equals(fe.ZERO)}Be.BASE._setWindowSize(8);const Gt={node:Tf,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},ni={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],bytesToHex:Fr,getExtendedPublicKey:ti,mod:T,invert:ei,hashToPrivateScalar:t=>{if(t=en(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=T(Vn(t),ge.l);if(e===$e||e===ce)throw new Error("Invalid private key");return e},randomBytes:(t=32)=>{if(Gt.web)return Gt.web.getRandomValues(new Uint8Array(t));if(Gt.node){const{randomBytes:e}=Gt.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>ni.randomBytes(32),sha512:async t=>{if(Gt.web){const e=await Gt.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}else{if(Gt.node)return Uint8Array.from(Gt.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=Be.BASE){const n=e.equals(Be.BASE)?e:new Be(e.x,e.y);return n._setWindowSize(t),n.multiply(Ge),n}};var ne=globalThis&&globalThis.__classPrivateFieldGet||function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ke=globalThis&&globalThis.__classPrivateFieldSet||function(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n},$t,Rt,Pt,Mt,Ot,Nt,hn,He;const Fe=11400714785074694791n,Pe=14029467366897019727n,su=1609587929392839161n,er=9650029242287828579n,uu=2870177450012600261n,yo=64n,Vf=2n**yo-1n,Qf=new ns;function au(t,e,n,r){return BigInt(t)|BigInt(e)<<16n|BigInt(n)<<32n|BigInt(r)<<48n}function Tt(t,e){return BigInt(t[e])|BigInt(t[e+1])<<8n|BigInt(t[e+2])<<16n|BigInt(t[e+3])<<24n|BigInt(t[e+4])<<32n|BigInt(t[e+5])<<40n|BigInt(t[e+6])<<48n|BigInt(t[e+7])<<56n}function xe(t,e){return t<<e&Vf|t>>yo-e}function J(t){return BigInt.asUintN(64,t)}class Kf{constructor(e=0){$t.set(this,void 0),Rt.set(this,void 0),Pt.set(this,void 0),Mt.set(this,void 0),Ot.set(this,void 0),Nt.set(this,void 0),hn.set(this,void 0),He.set(this,void 0),this.reset(e)}reset(e=ne(this,$t,"f")){return ke(this,$t,BigInt.asUintN(32,BigInt(e)),"f"),ke(this,Rt,J(ne(this,$t,"f")+Fe+Pe),"f"),ke(this,Pt,J(ne(this,$t,"f")+Pe),"f"),ke(this,Mt,ne(this,$t,"f"),"f"),ke(this,Ot,J(ne(this,$t,"f")-Fe),"f"),ke(this,Nt,null,"f"),ke(this,hn,0,"f"),ke(this,He,0,"f"),this}update(e){typeof e=="string"&&(e=Qf.encode(e));let n=0,r=e.length,i=n+r;if(r===0)return this;if(ke(this,hn,ne(this,hn,"f")+r,"f"),ne(this,He,"f")===0&&ke(this,Nt,new Uint8Array(32),"f"),ne(this,He,"f")+r<32)return ne(this,Nt,"f").set(e.subarray(0,r),ne(this,He,"f")),ke(this,He,ne(this,He,"f")+r,"f"),this;if(ne(this,He,"f")>0){ne(this,Nt,"f").set(e.subarray(0,32-ne(this,He,"f")),ne(this,He,"f"));let s=0,u;u=Tt(ne(this,Nt,"f"),s),ke(this,Rt,J(xe(J(ne(this,Rt,"f")+u*Pe),31n)*Fe),"f"),s+=8,u=Tt(this.memory,s),ke(this,Pt,J(xe(J(ne(this,Pt,"f")+u*Pe),31n)*Fe),"f"),s+=8,u=Tt(this.memory,s),ke(this,Mt,J(xe(J(ne(this,Mt,"f")+u*Pe),31n)*Fe),"f"),s+=8,u=Tt(this.memory,s),ke(this,Ot,J(xe(J(ne(this,Ot,"f")+u*Pe),31n)*Fe),"f"),n+=32-ne(this,He,"f"),ke(this,He,0,"f")}if(n<=i-32){const s=i-32;do{let u;u=Tt(e,n),ke(this,Rt,J(xe(J(ne(this,Rt,"f")+u*Pe),31n)*Fe),"f"),n+=8,u=Tt(e,n),ke(this,Pt,J(xe(J(ne(this,Pt,"f")+u*Pe),31n)*Fe),"f"),n+=8,u=Tt(e,n),ke(this,Mt,J(xe(J(ne(this,Mt,"f")+u*Pe),31n)*Fe),"f"),n+=8,u=Tt(e,n),ke(this,Ot,J(xe(J(ne(this,Ot,"f")+u*Pe),31n)*Fe),"f"),n+=8}while(n<=s)}return n<i&&(ne(this,Nt,"f").set(e.subarray(n,i),ne(this,He,"f")),ke(this,He,i-n,"f")),this}digest(){let e=ne(this,Nt,"f"),n=ne(this,He,"f"),r=0,i=0n,s=0n,u=0n;for(ne(this,hn,"f")>=32?(i=xe(ne(this,Rt,"f"),1n)+xe(ne(this,Pt,"f"),7n)+xe(ne(this,Mt,"f"),12n)+xe(ne(this,Ot,"f"),18n),i=J(i^xe(J(ne(this,Rt,"f")*Pe),31n)*Fe),i=J(i*Fe+er),i=J(i^xe(J(ne(this,Pt,"f")*Pe),31n)*Fe),i=J(i*Fe+er),i=J(i^xe(J(ne(this,Mt,"f")*Pe),31n)*Fe),i=J(i*Fe+er),i=J(i^xe(J(ne(this,Ot,"f")*Pe),31n)*Fe),i=J(i*Fe+er)):i=J(ne(this,$t,"f")+uu),i+=BigInt(ne(this,hn,"f"));r<=n-8;)u=Tt(e,r),u=J(xe(J(u*Pe),31n)*Fe),i=J(xe(i^u,27n)*Fe+er),r+=8;for(r+4<=n&&(u=au(e[r+1]<<8|e[r],e[r+3]<<8|e[r+2],0,0),i=J(xe(i^J(u*Fe),23n)*Pe+su),r+=4);r<n;)u=au(e[r++],0,0,0),i=J(xe(i^J(u*uu),11n)*Fe);return s=J(i>>33n),i=J((i^s)*Pe),s=J(i>>29n),i=J((i^s)*su),s=J(i>>32n),i=J(i^s),i}}$t=new WeakMap,Rt=new WeakMap,Pt=new WeakMap,Mt=new WeakMap,Ot=new WeakMap,Nt=new WeakMap,hn=new WeakMap,He=new WeakMap;function Gf(t,e=0){return new Kf(e).update(t).digest()}globalThis&&globalThis.__classPrivateFieldGet;globalThis&&globalThis.__classPrivateFieldSet;new Ya;const Zf=new ns;function Li(t){return Zf.encode(t)}function Xf(t){return Li(t).length}function Ui(t,e){for(let n of t)if(e.indexOf(n)===-1)return!1;return!0}function ou(t){return t===""?!1:kr.indexOf(t)!==-1}const Qn="abcdefghijklmnopqrstuvwxyz",Yf=Qn.toUpperCase(),kr="0123456789",Vt=Qn+"234567",Ao=Qn+kr,Jf=Vt,_o=Ao+Vt+"@.",Co=Qn+kr,e0=Qn+kr,Eo=Co+Vt+"+.",t0="/'()-._~!$&+,:=@%",Fo=Qn+Yf+kr+t0;function n0(t,e){return`@${t}.${e}`}function r0(t,e){return`+${t}.${e}`}function ss(t){const e=ko(t);return Ka(e)?!0:e}function us(t){const e=vo(t);return Ka(e)?!0:e}function zi(t){return t.startsWith("@")?ko(t):t.startsWith("+")?vo(t):new O("address must start with either @ or +")}function ko(t){return Bo(t,{sigil:"@",separator:".",minNameLength:4,maxNameLength:4,minPubkeyLength:53,maxPubkeyLength:53,allowedNameCharacters:Ao,allowedPubkeyCharacters:Jf,pubkeyMustStartWithB:!0})}function vo(t){return Bo(t,{sigil:"+",separator:".",minNameLength:1,maxNameLength:15,minPubkeyLength:1,maxPubkeyLength:53,allowedNameCharacters:Co,allowedPubkeyCharacters:e0,pubkeyMustStartWithB:!1})}function Bo(t,e){const{sigil:n,separator:r,minNameLength:i,maxNameLength:s,minPubkeyLength:u,maxPubkeyLength:a,allowedNameCharacters:o,allowedPubkeyCharacters:l,pubkeyMustStartWithB:c}=e;if(typeof t!="string")return new O("address must be a string");if(t.length<4)return new O("address is too short");if(t[0]!==n)return new O(`address must start with a sigil: "${n}"`);if(t.indexOf(r)===-1)return new O(`address must contain a separator character: "${r}"`);const h=t.slice(1).split(r);if(h.length!==2)return new O(`address must have exactly 2 parts separated by a "${r}" separator`);const[f,d]=h;return f.length<i||f.length>s?new O(`name must be between ${i} and ${s} characters long, but is ${f.length}`):d.length<u||d.length>a?new O(`pubkey must be between ${u} and ${a} characters long, but is ${d.length}`):Ui(f,o)?Ui(d,l)?ou(f[0])?new O(`name "${f}" must not start with a digit`):ou(d[0])?new O(`pubkey "${d}" must not start with a digit`):c&&d[0]!=="b"?new O(`pubkey "${d}" must start with 'b'`):{address:t,name:f,pubkey:d}:new O(`pubkey "${d}" must only have allowed characters`):new O(`name "${f}" must only have allowed characters`)}function as(t){return!(Object.prototype.toString.call(t)!=="[object Object]"||(""+t.constructor).startsWith("class"))}function So(t){return e=>e!==t?`expected literal value ${JSON.stringify(t)}`:null}function it(t={}){return e=>{if(t.optional!==!0&&e===void 0)return"required";if(t.optional===!0&&e===void 0)return null;let n=Xf(e);return typeof e!="string"?"expected a string but got "+JSON.stringify(e):t.minLen!==void 0&&n<t.minLen?`string shorter than min length of ${t.minLen} chars`:t.maxLen!==void 0&&n>t.maxLen?`string shorter than max length of ${t.maxLen} chars`:t.len!==void 0&&n!==t.len?`string does not have required length of ${t.len} chars: ${e}`:t.allowedChars!==void 0&&!Ui(e,t.allowedChars)?"contains disallowed characters":null}}function lr(t={}){return e=>t.optional!==!0&&e===void 0?"required":t.optional===!0&&e===void 0?null:t.nullable!==!0&&e===null?"not nullable":t.nullable===!0&&e===null?null:typeof e!="number"?"expected a number but got "+JSON.stringify(e):isNaN(e)?"is NaN":isFinite(e)?e!==Math.round(e)?"expected an integer":t.min!==void 0&&e<t.min?`integer too small (must be >= ${t.min})`:t.max!==void 0&&e>t.max?`integer too large (must be <= ${t.max})`:null:"is Infinity"}function xo(t={}){return t.allowLiteralUndefined=t.allowLiteralUndefined??!1,t.allowExtraKeys=t.allowExtraKeys??!1,e=>{if(!as(e))return"expected an object";if(t.allowLiteralUndefined===!1){for(let[n,r]of Object.entries(e))if(r===void 0)return`${n} is explicitly set to undefined but should be missing instead`}if(t.objSchema!==void 0){if(t.allowExtraKeys===!1){let n=Object.keys(e),r=Object.keys(t.objSchema),i=n.filter(s=>r.indexOf(s)===-1);if(i.length>0)return`object has extra keys not in the schema: ${i.join(", ")}`}for(let[n,r]of Object.entries(t.objSchema)){let i=r(e[n]);if(i!==null)return`${n}: ${i}`}}return null}}const{codec:Io}=bf,To={chars:"abcdefghijklmnopqrstuvwxyz234567",bits:5};function xn(t){return"b"+Io.stringify(t,To,{pad:!1})}function Wr(t){if(!t.startsWith("b"))throw new O("can't decode base32 string - it should start with a 'b'. "+t);if(t[t.length-1]==="=")throw new O("can't decode base32 string - it contains padding characters ('=')");return Io.parse(t.slice(1),To,{loose:!0})}var Ut;(function(t){t[t.None=-1]="None",t[t.Error=0]="Error",t[t.Warn=1]="Warn",t[t.Log=2]="Log",t[t.Info=3]="Info",t[t.Debug=4]="Debug"})(Ut||(Ut={}));const i0=Ut.Error;let yi={_default:i0};function s0(t){return t in yi?yi[t]:yi._default}class lt{constructor(e,n){Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.source=e,this.color=n||"aqua"}_print(e,n,r,...i){if(e<=s0(this.source))if(n){const s=`[${this.source}]`;if(this.color!==void 0){const u=[`%c ${s}`,`color: ${this.color}`];console.log(r,...u,...i)}else console.log(r,s,...i)}else console.log(r,...i)}error(...e){this._print(Ut.Error,!0,"!!",...e)}warn(...e){this._print(Ut.Warn,!0,"! ",...e)}log(...e){this._print(Ut.Log,!0,"  ",...e)}info(...e){this._print(Ut.Info,!0,"    ",...e)}debug(...e){this._print(Ut.Debug,!0,"      ",...e)}blank(){this._print(Ut.Info,!1,"")}}class u0{constructor(e){Object.defineProperty(this,"hash",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalUpdate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internalDigest",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.hash=e.hash,this.internalUpdate=e.update,this.internalDigest=e.digest}update(e){return this.hash=this.internalUpdate(this.hash,e),this.hash}digest(){return this.internalDigest(this.hash)}}const{createHash:Ai}=If,_i=new lt("crypto-driver-noble","cyan"),a0=class{static sha256(t){return typeof t=="string"?Promise.resolve(Ai("sha256").update(t,"utf-8").digest()):Promise.resolve(Ai("sha256").update(t).digest())}static updatableSha256(){return new u0({hash:Ai("sha256"),update:(t,e)=>t.update(e),digest:t=>t.digest()})}static async generateKeypairBytes(){_i.debug("generateKeypairBytes");const t=ni.randomPrivateKey();return{pubkey:await qf(t),secret:t}}static sign(t,e){return _i.debug("sign"),typeof e=="string"&&(e=Li(e)),jf(e,t.secret)}static async verify(t,e,n){_i.debug("verify");try{return typeof n=="string"&&(n=Li(n)),await Wf(e,n,t)}catch{return!1}}};function o0(){return""+Math.floor(Math.random()*1e3)+Math.floor(Math.random()*1e3)}function l0(t){try{const e=$o(t)?t.address:t.shareAddress,n=zi(e);if(ie(n))return n;const r={pubkey:Wr(n.pubkey),secret:Wr(t.secret)};return r.pubkey.length!==32?new O(`pubkey bytes should be 32 bytes long, not ${r.pubkey.length} after base32 decoding.  ${e}`):r.secret.length!==32?new O(`secret bytes should be 32 bytes long, not ${r.secret.length} after base32 decoding.  ${t.secret}`):r}catch(e){return new O("crash while decoding author keypair: "+e.message)}}function $o(t){return"address"in t}new lt("crypto","cyan");let In=a0,tr=new lt("crypto","cyan");const Oe=class{static async sha256base32(t){const e=await In.sha256(t);return xn(e)}static updatableSha256(){return In.updatableSha256()}static async generateAuthorKeypair(t){tr.debug(`generateAuthorKeypair("${t}")`);const e=await In.generateKeypairBytes(),n={address:n0(t,xn(e.pubkey)),secret:xn(e.secret)},r=ss(n.address);return ie(r)?r:n}static async generateShareKeypair(t){tr.debug(`generateAuthorKeypair("${t}")`);const e=await In.generateKeypairBytes(),n={shareAddress:r0(t,xn(e.pubkey)),secret:xn(e.secret)},r=us(n.shareAddress);return ie(r)?r:n}static async sign(t,e){tr.debug("sign");try{const n=l0(t);if(ie(n))return n;const r=await In.sign(n,e);return xn(r)}catch(n){return new O("unexpected error while signing: "+n.message)}}static verify(t,e,n){tr.debug("verify");try{const r=zi(t);return ie(r)?Promise.resolve(!1):In.verify(Wr(r.pubkey),Wr(e),n)}catch{return Promise.resolve(!1)}}static async checkKeypairIsValid(t){tr.debug("checkAuthorKeypairIsValid");const e=$o(t)?t.address:t.shareAddress;try{if(typeof e!="string"||typeof t.secret!="string")return new O("address and secret must be strings");const n=zi(e);if(ie(n))return n;const r="a test message to sign. "+o0(),i=await this.sign(t,r);return ie(i)?i:await this.verify(e,i,r)===!1?new O("pubkey does not match secret"):!0}catch(n){return new O("unexpected error in checkAuthorKeypairIsValid: "+n.message)}}};var Ci;new lt("validator es.4","red");const c0=10,h0=c0*60*1e3*1e3,lu=1e13,cu=9007199254740990,f0=4e6,d0=53,p0=104,hu={objSchema:{format:So("es.4"),author:it({allowedChars:_o}),content:it({maxLen:f0}),contentHash:it({allowedChars:Vt,len:d0}),deleteAfter:lr({min:lu,max:cu,nullable:!0}),path:it({allowedChars:Fo,minLen:2,maxLen:512}),signature:it({allowedChars:Vt,len:p0}),timestamp:lr({min:lu,max:cu}),workspace:it({allowedChars:Eo})},allowLiteralUndefined:!1,allowExtraKeys:!1};Ci=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return ie(n)?Promise.resolve(n):Oe.sha256base32(`author	${t.author}
contentHash	${t.contentHash}
`+(t.deleteAfter===null?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
timestamp	${t.timestamp}
workspace	${t.workspace}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r}){const i={format:"es.4",author:e.address,content:t.content,contentHash:await Oe.sha256base32(t.content),deleteAfter:t.deleteAfter??null,path:t.path,timestamp:r,workspace:n,signature:"?"},s=await this.signDocument(e,i);return ie(s)?s:{doc:s}}static async signDocument(t,e){const n=await this.hashDocument(e);if(ie(n))return n;const r=await Oe.sign(t,n);return ie(r)?r:{...e,signature:r}}static async wipeDocument(t,e){if(e.content.length===0)return e;const n=this.removeExtraFields(e);if(ie(n))return n;const i={...n.doc,content:"",contentHash:await Oe.sha256base32(""),signature:"?"};return this.signDocument(t,i)}static removeExtraFields(t){if(!as(t))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(hu.objSchema||{})),n={},r={};for(const[i,s]of Object.entries(t))if(e.has(i))n[i]=s;else{if(!i.startsWith("_"))return new O("extra document fields must have names starting with an underscore");r[i]=s}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const n=this._checkBasicDocumentValidity(t);if(ie(n))return n;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter,e);if(ie(r))return r;const i=this._checkAuthorCanWriteToPath(t.author,t.path);if(ie(i))return i;const s=this._checkPathIsValid(t.path,t.deleteAfter);if(ie(s))return s;const u=ss(t.author);if(ie(u))return u;const a=us(t.workspace);if(ie(a))return a;const o=await this._checkAuthorSignatureIsValid(t);if(ie(o))return o;const l=await this._checkContentMatchesHash(t.content,t.contentHash);return ie(l)?l:!0}static _checkBasicDocumentValidity(t){const e=xo(hu)(t);return e!==null?new O(e):!0}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new O(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+h0)return new O("timestamp too far in the future");if(e!==null){if(n>e)return new O("ephemeral doc has expired");if(e<=t)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e){if(!t.startsWith("/"))return new O("invalid path: must start with /");if(t.endsWith("/"))return new O("invalid path: must not end with /");if(t.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(e!==void 0){if(t.indexOf("!")===-1&&e!==null)return new O("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&e===null)return new O("when deleteAfter is null, path must not contain '!'")}return!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return ie(e)?e:await Oe.verify(t.author,t.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Oe.sha256base32(t)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(t){return new O("es.4 does not support attachments")}static updateAttachmentFields(t,e,n,r){return Promise.resolve(new O("es.4 does not support attachments"))}static authorFromCredentials(t){return t.address}},Object.defineProperty(Ci,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.4"});var Ei;new lt("validator es.5","red");const D0=10,m0=D0*60*1e3*1e3,fu=1e13,du=9007199254740990,g0=8e3,pu=53,Du=104,w0=0,b0=Number.MAX_SAFE_INTEGER,mu={objSchema:{format:So("es.5"),author:it({allowedChars:_o}),text:it({maxLen:g0}),textHash:it({allowedChars:Vt,len:pu}),deleteAfter:lr({min:fu,max:du,optional:!0}),path:it({allowedChars:Fo,minLen:2,maxLen:512}),signature:it({allowedChars:Vt,len:Du}),shareSignature:it({allowedChars:Vt,len:Du}),timestamp:lr({min:fu,max:du}),share:it({allowedChars:Eo}),attachmentSize:lr({min:w0,max:b0,optional:!0}),attachmentHash:it({allowedChars:Vt,len:pu,optional:!0})},allowLiteralUndefined:!1,allowExtraKeys:!1};Ei=class{static hashDocument(t){const e={...t,signature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",shareSignature:"bthisisafakesignatureusedtofillintheobjectwhenvalidatingitforhashingaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},n=this._checkBasicDocumentValidity(e);return ie(n)?Promise.resolve(n):Oe.sha256base32((t.attachmentHash===void 0?"":`attachmentHash	${t.attachmentHash}
`)+(t.attachmentSize===void 0?"":`attachmentSize	${t.attachmentSize}
`)+`author	${t.author}
`+(t.deleteAfter===void 0?"":`deleteAfter	${t.deleteAfter}
`)+`format	${t.format}
path	${t.path}
textHash	${t.textHash}
timestamp	${t.timestamp}
share	${t.share}
`)}static async generateDocument({input:t,keypair:e,share:n,timestamp:r,prevLatestDoc:i,config:s}){if(t.text===void 0&&(i==null?void 0:i.text)===void 0)return new O("Couldn't determine document text from given input or previous version's text.");const u=t.text!==void 0?t.text:i==null?void 0:i.text,a={...i,format:"es.5",author:e.address,text:u,textHash:await Oe.sha256base32(u),path:t.path,timestamp:r,share:n,signature:"?",shareSignature:"?"};t.deleteAfter&&(a.deleteAfter=t.deleteAfter);const o=await this.signDocument(e,a,s);return ie(o)?o:t.attachment?{doc:o,attachment:t.attachment}:{doc:o}}static async signDocument(t,e,n){const r=await this.hashDocument(e);if(ie(r))return r;const i=await Oe.sign(t,r);if(n.shareSecret===void 0)return new Jr(`Tried to write a document to ${e.share} without the secret.`);const s=await Oe.sign({shareAddress:e.share,secret:n.shareSecret},r);return ie(i)?i:ie(s)?s:{...e,signature:i,shareSignature:s}}static async wipeDocument(t,e,n){if(e.text.length===0)return e;const r=this.removeExtraFields(e);if(ie(r))return r;const i=r.doc;if(i.attachmentHash){const u={...i,text:"",textHash:await Oe.sha256base32(""),signature:"?",shareSignature:"?",attachmentHash:await Oe.sha256base32(""),attachmentSize:0};return this.signDocument(t,u,n)}const s={...i,text:"",textHash:await Oe.sha256base32(""),signature:"?",shareSignature:"?"};return this.signDocument(t,s,n)}static removeExtraFields(t){if(!as(t))return new O("doc is not a plain javascript object");const e=new Set(Object.keys(mu.objSchema||{})),n={},r={};for(const[i,s]of Object.entries(t))if(e.has(i))n[i]=s;else{if(!i.startsWith("_"))return new O("extra document fields must have names starting with an underscore");r[i]=s}return{doc:n,extras:r}}static async checkDocumentIsValid(t,e){e===void 0&&(e=Date.now()*1e3);const n=this._checkBasicDocumentValidity(t);if(ie(n))return n;const r=this._checkTimestampIsOk(t.timestamp,t.deleteAfter?t.deleteAfter:null,e);if(ie(r))return r;const i=this._checkAuthorCanWriteToPath(t.author,t.path);if(ie(i))return i;const s=this._checkAttachmentFieldsConsistent(t);if(ie(s))return s;const u=this._checkPathIsValid(t.path,!!t.attachmentHash,t.deleteAfter);if(ie(u))return u;const a=ss(t.author);if(ie(a))return a;const o=us(t.share);if(ie(o))return o;const l=await this._checkAuthorSignatureIsValid(t);if(ie(l))return l;const c=await this._checkShareSignatureIsValid(t);if(ie(c))return c;const h=await this._checkContentMatchesHash(t.text,t.textHash);return ie(h)?h:!0}static _checkBasicDocumentValidity(t){const e=xo(mu)(t);return e!==null?new O(e):!0}static _checkAttachmentFieldsConsistent(t){return t.text.length===0&&t.attachmentSize&&t.attachmentSize>0?new O("Documents with attachments must have text."):(t.text.length>0&&t.attachmentSize&&t.attachmentSize,t.attachmentHash&&t.attachmentSize===void 0?new O("Attachment size is undefined while attachment hash is defined"):t.attachmentSize&&t.attachmentHash===void 0?new O("Attachment hash is undefined while attachment size is defined"):!0)}static _checkAuthorCanWriteToPath(t,e){return e.indexOf("~")===-1||e.indexOf("~"+t)!==-1?!0:new O(`author ${t} can't write to path ${e}`)}static _checkTimestampIsOk(t,e,n){if(t>n+m0)return new O("timestamp too far in the future");if(e!==null){if(n>e)return new O("ephemeral doc has expired");if(e<=t)return new O("ephemeral doc expired before it was created")}return!0}static _checkPathIsValid(t,e,n){if(!t.startsWith("/"))return new O("invalid path: must start with /");if(t.endsWith("/"))return new O("invalid path: must not end with /");if(t.startsWith("/@"))return new O('invalid path: must not start with "/@"');if(t.indexOf("//")!==-1)return new O("invalid path: must not contain two consecutive slashes");if(n!==void 0){if(t.indexOf("!")===-1&&n!==null)return new O("when deleteAfter is set, path must contain '!'");if(t.indexOf("!")!==-1&&n===null)return new O("when deleteAfter is null, path must not contain '!'")}return!gu(t)&&e?new O("when a attachment is provided, the path must end with a file extension"):gu(t)&&e===!1?new O("when no attachment is provided, the path cannot end with a file extension"):!0}static async _checkAuthorSignatureIsValid(t){try{const e=await this.hashDocument(t);return ie(e)?e:await Oe.verify(t.author,t.signature,e)!==!0?new O("signature is invalid"):!0}catch{return new O("signature is invalid (unexpected exception)")}}static async _checkShareSignatureIsValid(t){try{const e=await this.hashDocument(t);return ie(e)?e:await Oe.verify(t.share,t.shareSignature,e)!==!0?new O("share signature is invalid"):!0}catch{return new O("share signature is invalid (unexpected exception)")}}static async _checkContentMatchesHash(t,e){return await Oe.sha256base32(t)!==e?new O("content does not match contentHash"):!0}static getAttachmentInfo(t){return t.attachmentHash&&t.attachmentSize===0?new O("This document has had its attachment wiped"):!t.attachmentHash||!t.attachmentSize?new O("This document has no attachment."):{size:t.attachmentSize,hash:t.attachmentHash}}static updateAttachmentFields(t,e,n,r,i){const s={...e,attachmentHash:r,attachmentSize:n};return this.signDocument(t,s,i)}static authorFromCredentials(t){return t.address}},Object.defineProperty(Ei,"id",{enumerable:!0,configurable:!0,writable:!0,value:"es.5"});const y0=/^.*\.(\w+)$/,A0=/^.*~@\w{4}\.\w{53}$/;function gu(t){if(t.indexOf(".")===-1)return!1;const e=t.match(y0);return!(e===null||e[1].length===53&&t.match(A0))}BigInt(0);new lt("peer","orangeRed");new lt("query","green");new lt("query helpers","gold");var wu;(function(t){t[t.LT=-1]="LT",t[t.EQ=0]="EQ",t[t.GT=1]="GT"})(wu||(wu={}));new lt("replica","gold");new lt("replica set","gold");new lt("replica ingest","gold");new lt("replica-cache","green");new lt("storage driver async memory","yellow");const Dn=Qa({address:"",secret:""});function _0(t){return{c:$,m:$,p:$,d:$}}function C0(t){let e,n,r,i,s,u;return{c(){e=E("h1"),e.textContent="Identity Keypair",n=U(),r=E("h2"),i=j("Your alias is "),s=E("b"),u=j(t[5])},m(a,o){b(a,e,o),b(a,n,o),b(a,r,o),v(r,i),v(r,s),v(s,u)},p(a,o){o&32&&ve(u,a[5])},d(a){a&&w(e),a&&w(n),a&&w(r)}}}function E0(t){let e;return{c(){e=E("h2"),e.textContent="Loading Identity details"},m(n,r){b(n,e,r)},p:$,d(n){n&&w(e)}}}function F0(t){let e;return{c(){e=j("It must begin with a letter. It needs to be 4 characters long and can only contain letters and numbers.")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function k0(t){let e;return{c(){e=E("i"),e.innerHTML=`<strong>ID must not contain special characters.</strong> 
                <br/>
                It must begin with a letter. It needs to be 4 characters long and can only contain letters and numbers.`},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function v0(t){let e;return{c(){e=E("i"),e.innerHTML="<strong>It must begin with a letter.</strong> It needs to be 4 characters long and can only contain letters and numbers."},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function B0(t){let e;return{c(){e=E("i"),e.innerHTML="It must begin with a letter and <strong>needs to be 4 characters long</strong> and can only contain letters and numbers."},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function S0(t){let e,n,r,i,s,u,a,o,l,c,h,f,d,p,D,m,A,F,_,g,S,k,x,R,z,L,Q,De,he,Ue,tn,gt,En,nn,Ye={ctx:t,current:null,token:null,hasCatch:!1,pending:E0,then:C0,catch:_0,value:17};mn(t[0](),Ye);function Je(xt,rn){return xt[4]==="ID must be 4 characters long"?B0:xt[4]==="ID must start with a letter"?v0:xt[4]==="ID must not contain special characters"?k0:F0}let et=Je(t),Qt=et(t);return{c(){e=E("div"),Ye.block.c(),n=U(),r=E("div"),i=E("p"),s=j(`You can

            `),u=E("button"),u.textContent="generate a new random identity",a=j(`

        or customize your alias in the box below:`),o=U(),l=E("textarea"),c=U(),h=E("blockquote"),Qt.c(),f=U(),d=E("p"),d.textContent="Your identity file is a JSON file that contains your address and secret. You can download it and reuse it later.",p=U(),D=E("input"),m=U(),A=E("div"),F=E("p"),_=E("b"),_.textContent="Address:",g=U(),S=j(t[1]),k=U(),x=E("br"),R=U(),z=E("b"),z.textContent="Secret:",L=U(),Q=j(t[6]),De=U(),he=E("div"),Ue=E("button"),Ue.textContent="Download your identity file",tn=U(),gt=E("button"),gt.textContent="Upload an identity file",B(u,"class","svelte-f9gru4"),B(l,"spellcheck","false"),B(l,"maxlength","4"),B(l,"class","svelte-f9gru4"),fa(D,"display","none"),B(D,"type","file"),B(D,"accept",".json, .txt"),B(A,"class","flex svelte-f9gru4"),B(Ue,"class","svelte-f9gru4"),B(gt,"class","svelte-f9gru4"),B(he,"class","flex svelte-f9gru4")},m(xt,rn){b(xt,e,rn),Ye.block.m(e,Ye.anchor=null),Ye.mount=()=>e,Ye.anchor=n,v(e,n),v(e,r),v(r,i),v(i,s),v(i,u),v(i,a),v(r,o),v(r,l),Pr(l,t[3]),v(r,c),v(r,h),Qt.m(h,null),v(e,f),v(e,d),v(e,p),v(e,D),t[14](D),v(e,m),v(e,A),v(A,F),v(F,_),v(F,g),v(F,S),v(F,k),v(F,x),v(F,R),v(F,z),v(F,L),v(F,Q),v(e,De),v(e,he),v(he,Ue),v(he,tn),v(he,gt),En||(nn=[oe(u,"click",t[10]),oe(l,"input",t[11]),oe(l,"change",t[12]),oe(D,"change",t[13]),oe(Ue,"click",t[15]),oe(gt,"click",t[16])],En=!0)},p(xt,[rn]){t=xt,Qr(Ye,t,rn),rn&8&&Pr(l,t[3]),et!==(et=Je(t))&&(Qt.d(1),Qt=et(t),Qt&&(Qt.c(),Qt.m(h,null))),rn&2&&ve(S,t[1]),rn&64&&ve(Q,t[6])},i:$,o:$,d(xt){xt&&w(e),Ye.block.d(),Ye.token=null,Ye=null,Qt.d(),t[14](null),En=!1,ot(nn)}}}function x0(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=n,r.readAsBinaryString(t)})}function I0(t){return/[0-9]/.test(t)}function T0(t){return/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(t)}function bu(){var t="",e="abcdefghijklmnopqrstuvwxyz",n=e.length,r="abcdefghijklmnopqrstuvwxyz0123456789",i=r.length;t+=e.charAt(Math.floor(Math.random()*n));for(var s=0;s<3;s++)t+=r.charAt(Math.floor(Math.random()*i));return t}function $0(t,e,n){let r,i,s,u;Ze(t,Dn,g=>n(9,u=g));let a,o=bu(),l;function c(){let g=document.createElement("a"),S=new Blob([JSON.stringify(u)],{type:"text/plain"}),k=u.address+".json";g.href=URL.createObjectURL(S),g.download=k,g.style.display="none",document.body.appendChild(g),g.click()}async function h(g){let S=g.target.files[0],k=await x0(S),x=JSON.parse(k);console.log(typeof x),console.log("fileReady",k);let R=x.address;console.log("authorAddress",R);let z=x.secret;console.log("authorSecret",z),Dn.set({address:R,secret:z}),n(3,o=R.slice(1,5))}async function f(g){g=="r"&&n(3,o=bu());let S=o.slice(0,1);if(I0(S))console.log("firstChar",S),n(4,l="ID must start with a letter");else if(o.length!==4)n(4,l="ID must be 4 characters long");else if(T0(o))n(4,l="ID must not contain special characters");else{let k=await Oe.generateAuthorKeypair(o),x=k.address,R=k.secret;Dn.set({address:x,secret:R}),n(4,l=null)}}yr(()=>{f()});const d=()=>f("r");function p(){o=this.value,n(3,o)}const D=()=>f(),m=g=>h(g);function A(g){Or[g?"unshift":"push"](()=>{a=g,n(2,a)})}const F=()=>c(),_=()=>{a.click()};return t.$$.update=()=>{t.$$.dirty&512&&n(1,r=u.address),t.$$.dirty&512&&n(6,i=u.secret),t.$$.dirty&2&&n(5,s=r.slice(0,5))},[f,r,a,o,l,s,i,c,h,u,d,p,D,m,A,F,_]}class R0 extends ue{constructor(e){super(),se(this,e,$0,S0,re,{generateID:0})}get generateID(){return this.$$.ctx[0]}}function yu(t){let e,n,r=t[0].kind+"",i;return{c(){e=E("p"),n=E("strong"),i=j(r)},m(s,u){b(s,e,u),v(e,n),v(n,i)},p(s,u){u&1&&r!==(r=s[0].kind+"")&&ve(i,r)},d(s){s&&w(e)}}}function P0(t){let e,n,r,i,s,u,a,o,l,c,h,f=t[0]&&yu(t);return{c(){e=E("div"),n=E("div"),r=E("img"),s=U(),u=E("div"),u.textContent="Upload file",a=U(),o=E("input"),l=U(),f&&f.c(),B(r,"class","upload svelte-l8b8bn"),ft(r.src,i=M0)||B(r,"src",i),B(r,"alt","Comics icons created by Freepik - Flaticon"),B(u,"class","uploadText svelte-l8b8bn"),fa(o,"display","none"),B(o,"type","file"),B(o,"accept",".jpg, .jpeg, .png, .gif, .txt, .pdf, .md, .webm, .mp3, .ogg, .wav"),B(n,"class","svelte-l8b8bn"),B(e,"class","svelte-l8b8bn")},m(d,p){b(d,e,p),v(e,n),v(n,r),v(n,s),v(n,u),v(n,a),v(n,o),t[9](o),v(e,l),f&&f.m(e,null),c||(h=[oe(r,"click",t[4]),oe(r,"keypress",t[5]),oe(u,"click",t[6]),oe(u,"keypress",t[7]),oe(o,"change",t[8])],c=!0)},p(d,[p]){d[0]?f?f.p(d,p):(f=yu(d),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:$,o:$,d(d){d&&w(e),t[9](null),f&&f.d(),c=!1,ot(h)}}}let M0="images/insert-picture-icon.png";function O0(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>{e(r.result),console.log("typeof",r.result)},r.onerror=n,r.readAsArrayBuffer(t)})}function N0(t,e,n){let r,i;Ze(t,Dn,A=>n(11,r=A)),Ze(t,_n,A=>n(12,i=A));const s=zn();let{inStudio:u}=e,a,o,l;async function c(A){let F=A.target.files[0],g=F.name.replace(/\s+/g,"_").replace(/[@·,\/#!$%\^&\*;:{}=\-`~()]/g,""),S=g.split(".").pop(),k=g.split(".")[g.split(".").length-2],x;(S==="JPG"||S==="jpg")&&(S="jpeg"),x=k+"."+S;let R=Date.now(),z=await O0(F),L=(Date.now()+36e5)*1e3,Q=new Uint8Array(z);return u||n(0,o=await i.replica.set(r,{path:`/documents/${R}/!${x}`,text:"Shared by "+r.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:Q,deleteAfter:L})),l=await i.replica.set(r,{path:`/studio/${R}/${x}`,text:"Shared by "+r.address.slice(1,5)+" on "+new Date().toLocaleString(),attachment:Q}),console.log("Result: ",o),P(o)&&console.error(o),console.log("Studio: ",l),P(l)&&console.error(l),s("success"),o}const h=()=>{a.click()},f=()=>{a.click()},d=()=>{a.click()},p=()=>{a.click()},D=A=>c(A);function m(A){Or[A?"unshift":"push"](()=>{a=A,n(1,a)})}return t.$$set=A=>{"inStudio"in A&&n(3,u=A.inStudio)},t.$$.update=()=>{t.$$.dirty&1&&n(0,o)},[o,a,c,u,h,f,d,p,D,m]}class L0 extends ue{constructor(e){super(),se(this,e,N0,P0,re,{inStudio:3})}}function U0(t){let e;return{c(){e=j("Record audio")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function z0(t){let e;return{c(){e=j("Stop recording")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function H0(t){let e,n,r,i,s,u,a,o;function l(f,d){return f[0]?z0:U0}let c=l(t),h=c(t);return{c(){e=E("div"),n=E("div"),r=E("img"),s=U(),u=E("div"),h.c(),B(r,"class","upload svelte-153yvdv"),ft(r.src,i=q0)||B(r,"src",i),B(r,"alt","Speaker Icon"),B(u,"class","uploadText svelte-153yvdv"),B(n,"class","svelte-153yvdv"),B(e,"class","svelte-153yvdv")},m(f,d){b(f,e,d),v(e,n),v(n,r),v(n,s),v(n,u),h.m(u,null),a||(o=[oe(r,"click",t[3]),oe(r,"keypress",t[4]),oe(u,"click",t[5]),oe(u,"keypress",t[6])],a=!0)},p(f,[d]){c!==(c=l(f))&&(h.d(1),h=c(f),h&&(h.c(),h.m(u,null)))},i:$,o:$,d(f){f&&w(e),h.d(),a=!1,ot(o)}}}let q0="images/Speaker_Icon.png";function j0(t){return new Promise((e,n)=>{let r=new FileReader;r.addEventListener("loadend",i=>e(i.target.result)),r.addEventListener("error",n),r.readAsArrayBuffer(t)})}function W0(t,e,n){let r,i;Ze(t,Dn,A=>n(11,r=A)),Ze(t,_n,A=>n(12,i=A));const s=zn();let u,a,o=[],l=null,c=!1,{inStudio:h}=e;async function f(){if(c)l.stop(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),n(0,c=!1),l.ondataavailable=A=>o.push(A.data),l.onstop=async function(A){let F=Date.now(),_=(F+36e5)*1e3,g=l.mimeType;g===""&&(g="audio/ogg; codecs=opus");let k=g.split(";")[0].split("/")[1];const x=new Blob(o,{type:g});console.log("blob",x);const R=new Uint8Array(await j0(x));console.log("mime",g);let z=r.address.slice(1,5);h||(u=await i.replica.set(r,{path:`/documents/${F}/!${z}${F}.${k}`,text:"Voice note shared by "+r.address.slice(1,5)+" on "+F.toLocaleString(),attachment:R,deleteAfter:_})),a=await i.replica.set(r,{path:`/studio/${F}/${z}${F}.${k}`,text:"Voice note shared by "+r.address.slice(1,5)+" on "+F.toLocaleString(),attachment:R}),s("upload"),console.log("Upload Result: ",u),console.log("Studio Result: ",a),o=[]};else{const A=await navigator.mediaDevices.getUserMedia({audio:!0});l=new MediaRecorder(A),l.start(),console.log("mediaRecorder",l),console.log("mediaRecorder mime",l.mimeType),console.log("recording"),n(0,c=!0)}}const d=()=>{f()},p=()=>{f()},D=()=>{f()},m=()=>{f()};return t.$$set=A=>{"inStudio"in A&&n(2,h=A.inStudio)},[c,f,h,d,p,D,m]}class V0 extends ue{constructor(e){super(),se(this,e,W0,H0,re,{inStudio:2})}}let Ro;_n.subscribe(t=>{Ro=t});const Q0=new yh(Ro.replica),os=Er({cache:Q0});var Hi={},K0={get exports(){return Hi},set exports(t){Hi=t}},qi={},G0={get exports(){return qi},set exports(t){qi=t}};(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(n,r){return n<<r|n>>>32-r},rotr:function(n,r){return n<<32-r|n>>>r},endian:function(n){if(n.constructor==Number)return e.rotl(n,8)&16711935|e.rotl(n,24)&4278255360;for(var r=0;r<n.length;r++)n[r]=e.endian(n[r]);return n},randomBytes:function(n){for(var r=[];n>0;n--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(n){for(var r=[],i=0,s=0;i<n.length;i++,s+=8)r[s>>>5]|=n[i]<<24-s%32;return r},wordsToBytes:function(n){for(var r=[],i=0;i<n.length*32;i+=8)r.push(n[i>>>5]>>>24-i%32&255);return r},bytesToHex:function(n){for(var r=[],i=0;i<n.length;i++)r.push((n[i]>>>4).toString(16)),r.push((n[i]&15).toString(16));return r.join("")},hexToBytes:function(n){for(var r=[],i=0;i<n.length;i+=2)r.push(parseInt(n.substr(i,2),16));return r},bytesToBase64:function(n){for(var r=[],i=0;i<n.length;i+=3)for(var s=n[i]<<16|n[i+1]<<8|n[i+2],u=0;u<4;u++)i*8+u*6<=n.length*8?r.push(t.charAt(s>>>6*(3-u)&63)):r.push("=");return r.join("")},base64ToBytes:function(n){n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],i=0,s=0;i<n.length;s=++i%4)s!=0&&r.push((t.indexOf(n.charAt(i-1))&Math.pow(2,-2*s+8)-1)<<s*2|t.indexOf(n.charAt(i))>>>6-s*2);return r}};G0.exports=e})();var ji={utf8:{stringToBytes:function(t){return ji.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(ji.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t.charCodeAt(n)&255);return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}},Au=ji;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Z0=function(t){return t!=null&&(Po(t)||X0(t)||!!t._isBuffer)};function Po(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function X0(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&Po(t.slice(0,0))}(function(){var t=qi,e=Au.utf8,n=Z0,r=Au.bin,i=function(s,u){s.constructor==String?u&&u.encoding==="binary"?s=r.stringToBytes(s):s=e.stringToBytes(s):n(s)?s=Array.prototype.slice.call(s,0):!Array.isArray(s)&&s.constructor!==Uint8Array&&(s=s.toString());for(var a=t.bytesToWords(s),o=s.length*8,l=1732584193,c=-271733879,h=-1732584194,f=271733878,d=0;d<a.length;d++)a[d]=(a[d]<<8|a[d]>>>24)&16711935|(a[d]<<24|a[d]>>>8)&4278255360;a[o>>>5]|=128<<o%32,a[(o+64>>>9<<4)+14]=o;for(var p=i._ff,D=i._gg,m=i._hh,A=i._ii,d=0;d<a.length;d+=16){var F=l,_=c,g=h,S=f;l=p(l,c,h,f,a[d+0],7,-680876936),f=p(f,l,c,h,a[d+1],12,-389564586),h=p(h,f,l,c,a[d+2],17,606105819),c=p(c,h,f,l,a[d+3],22,-1044525330),l=p(l,c,h,f,a[d+4],7,-176418897),f=p(f,l,c,h,a[d+5],12,1200080426),h=p(h,f,l,c,a[d+6],17,-1473231341),c=p(c,h,f,l,a[d+7],22,-45705983),l=p(l,c,h,f,a[d+8],7,1770035416),f=p(f,l,c,h,a[d+9],12,-1958414417),h=p(h,f,l,c,a[d+10],17,-42063),c=p(c,h,f,l,a[d+11],22,-1990404162),l=p(l,c,h,f,a[d+12],7,1804603682),f=p(f,l,c,h,a[d+13],12,-40341101),h=p(h,f,l,c,a[d+14],17,-1502002290),c=p(c,h,f,l,a[d+15],22,1236535329),l=D(l,c,h,f,a[d+1],5,-165796510),f=D(f,l,c,h,a[d+6],9,-1069501632),h=D(h,f,l,c,a[d+11],14,643717713),c=D(c,h,f,l,a[d+0],20,-373897302),l=D(l,c,h,f,a[d+5],5,-701558691),f=D(f,l,c,h,a[d+10],9,38016083),h=D(h,f,l,c,a[d+15],14,-660478335),c=D(c,h,f,l,a[d+4],20,-405537848),l=D(l,c,h,f,a[d+9],5,568446438),f=D(f,l,c,h,a[d+14],9,-1019803690),h=D(h,f,l,c,a[d+3],14,-187363961),c=D(c,h,f,l,a[d+8],20,1163531501),l=D(l,c,h,f,a[d+13],5,-1444681467),f=D(f,l,c,h,a[d+2],9,-51403784),h=D(h,f,l,c,a[d+7],14,1735328473),c=D(c,h,f,l,a[d+12],20,-1926607734),l=m(l,c,h,f,a[d+5],4,-378558),f=m(f,l,c,h,a[d+8],11,-2022574463),h=m(h,f,l,c,a[d+11],16,1839030562),c=m(c,h,f,l,a[d+14],23,-35309556),l=m(l,c,h,f,a[d+1],4,-1530992060),f=m(f,l,c,h,a[d+4],11,1272893353),h=m(h,f,l,c,a[d+7],16,-155497632),c=m(c,h,f,l,a[d+10],23,-1094730640),l=m(l,c,h,f,a[d+13],4,681279174),f=m(f,l,c,h,a[d+0],11,-358537222),h=m(h,f,l,c,a[d+3],16,-722521979),c=m(c,h,f,l,a[d+6],23,76029189),l=m(l,c,h,f,a[d+9],4,-640364487),f=m(f,l,c,h,a[d+12],11,-421815835),h=m(h,f,l,c,a[d+15],16,530742520),c=m(c,h,f,l,a[d+2],23,-995338651),l=A(l,c,h,f,a[d+0],6,-198630844),f=A(f,l,c,h,a[d+7],10,1126891415),h=A(h,f,l,c,a[d+14],15,-1416354905),c=A(c,h,f,l,a[d+5],21,-57434055),l=A(l,c,h,f,a[d+12],6,1700485571),f=A(f,l,c,h,a[d+3],10,-1894986606),h=A(h,f,l,c,a[d+10],15,-1051523),c=A(c,h,f,l,a[d+1],21,-2054922799),l=A(l,c,h,f,a[d+8],6,1873313359),f=A(f,l,c,h,a[d+15],10,-30611744),h=A(h,f,l,c,a[d+6],15,-1560198380),c=A(c,h,f,l,a[d+13],21,1309151649),l=A(l,c,h,f,a[d+4],6,-145523070),f=A(f,l,c,h,a[d+11],10,-1120210379),h=A(h,f,l,c,a[d+2],15,718787259),c=A(c,h,f,l,a[d+9],21,-343485551),l=l+F>>>0,c=c+_>>>0,h=h+g>>>0,f=f+S>>>0}return t.endian([l,c,h,f])};i._ff=function(s,u,a,o,l,c,h){var f=s+(u&a|~u&o)+(l>>>0)+h;return(f<<c|f>>>32-c)+u},i._gg=function(s,u,a,o,l,c,h){var f=s+(u&o|a&~o)+(l>>>0)+h;return(f<<c|f>>>32-c)+u},i._hh=function(s,u,a,o,l,c,h){var f=s+(u^a^o)+(l>>>0)+h;return(f<<c|f>>>32-c)+u},i._ii=function(s,u,a,o,l,c,h){var f=s+(a^(u|~o))+(l>>>0)+h;return(f<<c|f>>>32-c)+u},i._blocksize=16,i._digestsize=16,K0.exports=function(s,u){if(s==null)throw new Error("Illegal argument "+s);var a=t.wordsToBytes(i(s,u));return u&&u.asBytes?a:u&&u.asString?r.bytesToString(a):t.bytesToHex(a)}})();function _u(t){let e;const n=t[11].default,r=we(n,t,t[10],null);return{c(){r&&r.c()},m(i,s){r&&r.m(i,s),e=!0},p(i,s){r&&r.p&&(!e||s&1024)&&ye(r,n,i,i[10],e?be(n,i[10],s,null):Ae(i[10]),null)},i(i){e||(y(r,i),e=!0)},o(i){C(r,i),e=!1},d(i){r&&r.d(i)}}}function Y0(t){let e,n,r,i,s,u=t[3]&&_u(t);return{c(){e=E("div"),u&&u.c(),B(e,"class",n="wrapper "+t[2]+" "+t[0]+" svelte-142y8oi"),B(e,"style",t[1])},m(a,o){b(a,e,o),u&&u.m(e,null),r=!0,i||(s=Vo(t[4].call(null,e)),i=!0)},p(a,[o]){a[3]?u?(u.p(a,o),o&8&&y(u,1)):(u=_u(a),u.c(),y(u,1),u.m(e,null)):u&&(ee(),C(u,1,1,()=>{u=null}),te()),(!r||o&5&&n!==(n="wrapper "+a[2]+" "+a[0]+" svelte-142y8oi"))&&B(e,"class",n),(!r||o&2)&&B(e,"style",a[1])},i(a){r||(y(u),r=!0)},o(a){C(u),r=!1},d(a){a&&w(e),u&&u.d(),i=!1,s()}}}function J0(t,e){let n,r;return()=>{const i=+new Date;n&&i<n+e?(clearTimeout(r),r=setTimeout(function(){n=i,t()},e)):(n=i,t())}}function ed(t,e,n){let{$$slots:r={},$$scope:i}=e;const s=zn();let{offset:u=0}=e,{throttle:a=250}=e,{c:o=""}=e,{style:l=""}=e,{once:c=!0}=e,{threshold:h=1}=e,{disabled:f=!1}=e,{class:d=""}=e,p=f,D=!1,m=!1,A=()=>{};function F(g,S,k){if(p&&!g){s("enter");return}g&&!m&&s("leave"),c&&g&&!m&&A()}function _(g){if(!window||f)return;if(window.IntersectionObserver&&window.IntersectionObserverEntry){const x=new IntersectionObserver(([{isIntersecting:R}])=>{if(D=p,m=R,D&&c&&!R){F(D);return}n(3,p=R),F(D)},{rootMargin:u+"px",threshold:h});return x.observe(g),A=()=>x.unobserve(g),A}function S(){if(!(g.offsetWidth||g.offsetHeight||g.getClientRects().length))return;let x,R;try{({top:x,height:R}=g.getBoundingClientRect())}catch{({top:x,height:R}=defaultBoundingClientRect)}const z=window.innerHeight||document.documentElement.clientHeight;if(D=p,m=x-u<=z&&x+R+u>=0,D&&c&&!isIntersecting){F(D,observer);return}n(3,p=m),F(D)}S();const k=J0(S,a);return window.addEventListener("scroll",k),window.addEventListener("resize",k),A=()=>{window.removeEventListener("scroll",k),window.removeEventListener("resize",k)},A}return t.$$set=g=>{"offset"in g&&n(5,u=g.offset),"throttle"in g&&n(6,a=g.throttle),"c"in g&&n(0,o=g.c),"style"in g&&n(1,l=g.style),"once"in g&&n(7,c=g.once),"threshold"in g&&n(8,h=g.threshold),"disabled"in g&&n(9,f=g.disabled),"class"in g&&n(2,d=g.class),"$$scope"in g&&n(10,i=g.$$scope)},[o,l,d,p,_,u,a,c,h,f,i,r]}class td extends ue{constructor(e){super(),se(this,e,ed,Y0,re,{offset:5,throttle:6,c:0,style:1,once:7,threshold:8,disabled:9,class:2})}}function nd(t){let e;const n=t[1].default,r=we(n,t,t[0],null);return{c(){r&&r.c()},m(i,s){r&&r.m(i,s),e=!0},p(i,[s]){r&&r.p&&(!e||s&1)&&ye(r,n,i,i[0],e?be(n,i[0],s,null):Ae(i[0]),null)},i(i){e||(y(r,i),e=!0)},o(i){C(r,i),e=!1},d(i){r&&r.d(i)}}}function rd(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class id extends ue{constructor(e){super(),se(this,e,rd,nd,re,{})}}function sd(t){let e,n,r,i,s,u;return{c(){e=E("img"),B(e,"alt",n=typeof t[0]===void 0?`Gravatar for ${t[2]}`:t[0]),B(e,"style",t[7]),B(e,"class",t[8]),ft(e.src,r=Eu()&&!t[9]?t[5]:t[6])||B(e,"src",r),B(e,"srcset",i=t[9]?`${t[5]} 2x`:void 0),B(e,"width",t[4]),B(e,"height",t[4])},m(a,o){b(a,e,o),s||(u=oe(e,"error",t[22]),s=!0)},p(a,o){o&5&&n!==(n=typeof a[0]===void 0?`Gravatar for ${a[2]}`:a[0])&&B(e,"alt",n),o&128&&B(e,"style",a[7]),o&256&&B(e,"class",a[8]),o&96&&!ft(e.src,r=Eu()&&!a[9]?a[5]:a[6])&&B(e,"src",r),o&32&&i!==(i=a[9]?`${a[5]} 2x`:void 0)&&B(e,"srcset",i),o&16&&B(e,"width",a[4]),o&16&&B(e,"height",a[4])},d(a){a&&w(e),s=!1,u()}}}function ud(t){let e,n;const r=[t[1]];let i={$$slots:{default:[sd]},$$scope:{ctx:t}};for(let s=0;s<r.length;s+=1)i=ht(i,r[s]);return e=new t[3]({props:i}),{c(){X(e.$$.fragment)},m(s,u){W(e,s,u),n=!0},p(s,[u]){const a=u&2?wn(r,[bn(s[1])]):{};u&16777717&&(a.$$scope={dirty:u,ctx:s}),e.$set(a)},i(s){n||(y(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){V(e,s)}}}function Cu(t,e,n,r){return`s=${t*r}&r=${e}&d=${n}`}function Eu(){if(typeof window<"u"&&window){let t="(-webkit-min-device-pixel-ratio: 1.25), (min--moz-device-pixel-ratio: 1.25), (-o-min-device-pixel-ratio: 5/4), (min-resolution: 1.25dppx)";if(window.devicePixelRatio>1.25||window.matchMedia&&window.matchMedia(t).matches)return!0}return!1}function ad(t,e,n){let r,i,s,u,a,o,l,c,h,f,d,p,{size:D=50}=e,{alt:m=void 0}=e,{rating:A="g"}=e,{md5:F=""}=e,{protocol:_="//"}=e,{email:g}=e,{useWaypoint:S=!0}=e,{waypointOptions:k={}}=e,{domain:x="en.gravatar.com"}=e,R=typeof window>"u"?!0:"srcset"in document.createElement("img");function z(L){Mr.call(this,t,L)}return t.$$set=L=>{n(23,e=ht(ht({},e),Fi(L))),"size"in L&&n(10,D=L.size),"alt"in L&&n(0,m=L.alt),"rating"in L&&n(11,A=L.rating),"md5"in L&&n(12,F=L.md5),"protocol"in L&&n(13,_=L.protocol),"email"in L&&n(14,g=L.email),"useWaypoint"in L&&n(15,S=L.useWaypoint),"waypointOptions"in L&&n(1,k=L.waypointOptions),"domain"in L&&n(16,x=L.domain)},t.$$.update=()=>{t.$$.dirty&16384&&n(2,r=(g||"").trim().toLowerCase()),n(21,i=e.default||"retro"),n(8,s=e.class||""),n(7,u=e.style||""),t.$$.dirty&73728&&n(19,a=`${_}${x}/avatar/`),t.$$.dirty&2100224&&n(20,o=Cu(D,A,i,1)),t.$$.dirty&2100224&&n(17,l=Cu(D,A,i,2)),t.$$.dirty&4100&&n(18,c=F||Hi(r,{encoding:"binary"})),t.$$.dirty&1835008&&n(6,h=`${a}${c}?${o}`),t.$$.dirty&917504&&n(5,f=`${a}${c}?${l}`),t.$$.dirty&1024&&n(4,d=typeof D=="number"?`${D}px`:D),t.$$.dirty&32768&&n(3,p=S?td:id)},e=Fi(e),[m,k,r,p,d,f,h,u,s,R,D,A,F,_,g,S,x,l,c,a,o,i,z]}class od extends ue{constructor(e){super(),se(this,e,ad,ud,re,{size:10,alt:0,rating:11,md5:12,protocol:13,email:14,useWaypoint:15,waypointOptions:1,domain:16})}}const ld=Er(new Date,function(e){const n=setInterval(()=>{e(new Date)},1e3);return function(){clearInterval(n)}}),cd=new Date,hd=vh(ld,t=>Math.round((Number(t)-Number(cd))/1e3));function Fu(t){let e,n,r,i,s,u,a=Math.trunc((t[1]/1e3-(t[2]*1e3+t[3]))/1e3)+"",o,l,c,h,f,d;return{c(){e=E("div"),n=E("button"),n.textContent="➕",r=U(),i=E("button"),i.textContent="➖",s=U(),u=E("p"),o=j(a),l=j(" seconds left until deletion"),c=U(),h=E("button"),h.textContent="🗑️",B(n,"class","svelte-ory2b7"),B(i,"class","svelte-ory2b7"),B(u,"class","svelte-ory2b7"),B(h,"class","svelte-ory2b7"),B(e,"id","flexcontainer"),B(e,"class","svelte-ory2b7")},m(p,D){b(p,e,D),v(e,n),v(e,r),v(e,i),v(e,s),v(e,u),v(u,o),v(u,l),v(e,c),v(e,h),f||(d=[oe(n,"click",t[4]),oe(i,"click",t[5]),oe(h,"click",t[9])],f=!0)},p(p,D){D&6&&a!==(a=Math.trunc((p[1]/1e3-(p[2]*1e3+p[3]))/1e3)+"")&&ve(o,a)},d(p){p&&w(e),f=!1,ot(d)}}}function fd(t){let e,n=t[0]?"⌛":"⏳",r,i,s,u,a,o=t[0]&&Fu(t);return{c(){e=E("button"),r=j(n),i=U(),o&&o.c(),s=ae(),B(e,"class","svelte-ory2b7")},m(l,c){b(l,e,c),v(e,r),b(l,i,c),o&&o.m(l,c),b(l,s,c),u||(a=oe(e,"click",t[8]),u=!0)},p(l,[c]){c&1&&n!==(n=l[0]?"⌛":"⏳")&&ve(r,n),l[0]?o?o.p(l,c):(o=Fu(l),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null)},i:$,o:$,d(l){l&&w(e),l&&w(i),o&&o.d(l),l&&w(s),u=!1,a()}}}function dd(t,e,n){let r,i,s;Ze(t,Dn,m=>n(10,r=m)),Ze(t,_n,m=>n(11,i=m)),Ze(t,hd,m=>n(2,s=m));const u=zn();let a=Date.now(),o=!1,{doc:l}=e,c=l.deleteAfter;async function h(){n(1,c+=6e7);let m=r.address.slice(1,5),A=l.path.split("!"),F=A[0].replace("/documents","/studio")+A[1];const _=await i.replica.set(r,{text:l.text+"<br> lifespan extended by "+m+" on "+new Date().toLocaleString(),path:l.path,deleteAfter:c});console.log("result ",_);const g=await i.replica.set(r,{text:l.text+"<br> lifespan extended by "+m+" on "+new Date().toLocaleString(),path:F});console.log("studioPath",F),console.log("result c",_),console.log("result s",g)}async function f(){let m=r.address.slice(1,5),A=l.path.replace("/documents","/studio");n(1,c-=6e7);const F=await i.replica.set(r,{text:l.text+"<br> lifespan shortened by "+m+" on "+new Date().toLocaleString(),path:l.path,deleteAfter:c}),_=await i.replica.set(r,{text:l.text+"<br> lifespan shortened by "+m+" on "+new Date().toLocaleString(),path:A});console.log("result c",F),console.log("result s",_)}async function d(){u("update");const m=await i.replica.set(r,{path:l.path,deleteAfter:(Date.now()+1e3)*1e3});console.log("result delete",m)}const p=()=>n(0,o=!o),D=()=>d();return t.$$set=m=>{"doc"in m&&n(7,l=m.doc)},[o,c,s,a,h,f,d,l,p,D]}class pd extends ue{constructor(e){super(),se(this,e,dd,fd,re,{doc:7})}}function Dd(){const t=console.warn;console.warn=e=>{e.includes("unknown prop")||e.includes("unexpected slot")||t(e)},yr(()=>{console.warn=t})}function ku(t,e,n){const r=t.slice();return r[18]=e[n],r}function vu(t,e,n){const r=t.slice();return r[18]=e[n],r}function Bu(t,e,n){const r=t.slice();return r[10]=e[n],r}function Su(t,e,n){const r=t.slice();return r[13]=e[n],r[15]=n,r}function xu(t,e,n){const r=t.slice();return r[16]=e[n],r[15]=n,r}function Iu(t,e,n){const r=t.slice();return r[7]=e[n],r}function md(t){let e,n,r,i;const s=[yd,bd,wd],u=[];function a(o,l){return o[0]==="table"?0:o[0]==="list"?1:2}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function gd(t){let e,n,r=t[1],i=[];for(let u=0;u<r.length;u+=1)i[u]=Ou(Iu(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=ae()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&34){r=u[1];let o;for(o=0;o<r.length;o+=1){const l=Iu(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=Ou(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function wd(t){let e,n,r;const i=[t[6]];var s=t[5][t[0]];function u(a){let o={$$slots:{default:[Cd]},$$scope:{ctx:a}};for(let l=0;l<i.length;l+=1)o=ht(o,i[l]);return{props:o}}return s&&(e=_e(s,u(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(a,o){e&&W(e,a,o),b(a,n,o),r=!0},p(a,o){const l=o&64?wn(i,[bn(a[6])]):{};if(o&8388706&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5][a[0]])){if(e){ee();const c=e;C(c.$$.fragment,1,0,()=>{V(c,1)}),te()}s?(e=_e(s,u(a)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else s&&e.$set(l)},i(a){r||(e&&y(e.$$.fragment,a),r=!0)},o(a){e&&C(e.$$.fragment,a),r=!1},d(a){a&&w(n),e&&V(e,a)}}}function bd(t){let e,n,r,i;const s=[Fd,Ed],u=[];function a(o,l){return o[4]?0:1}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function yd(t){let e,n,r;var i=t[5].table;function s(u){return{props:{$$slots:{default:[Md]},$$scope:{ctx:u}}}}return i&&(e=_e(i,s(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(u,a){e&&W(e,u,a),b(u,n,a),r=!0},p(u,a){const o={};if(a&8388716&&(o.$$scope={dirty:a,ctx:u}),i!==(i=u[5].table)){if(e){ee();const l=e;C(l.$$.fragment,1,0,()=>{V(l,1)}),te()}i?(e=_e(i,s(u)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else i&&e.$set(o)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&C(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&V(e,u)}}}function Ad(t){let e=t[6].raw+"",n;return{c(){n=j(e)},m(r,i){b(r,n,i)},p(r,i){i&64&&e!==(e=r[6].raw+"")&&ve(n,e)},i:$,o:$,d(r){r&&w(n)}}}function _d(t){let e,n;return e=new Cn({props:{tokens:t[1],renderers:t[5]}}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},p(r,i){const s={};i&2&&(s.tokens=r[1]),i&32&&(s.renderers=r[5]),e.$set(s)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function Cd(t){let e,n,r,i;const s=[_d,Ad],u=[];function a(o,l){return o[1]?0:1}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function Ed(t){let e,n,r;const i=[{ordered:t[4]},t[6]];var s=t[5].list;function u(a){let o={$$slots:{default:[vd]},$$scope:{ctx:a}};for(let l=0;l<i.length;l+=1)o=ht(o,i[l]);return{props:o}}return s&&(e=_e(s,u(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(a,o){e&&W(e,a,o),b(a,n,o),r=!0},p(a,o){const l=o&80?wn(i,[o&16&&{ordered:a[4]},o&64&&bn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){ee();const c=e;C(c.$$.fragment,1,0,()=>{V(c,1)}),te()}s?(e=_e(s,u(a)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else s&&e.$set(l)},i(a){r||(e&&y(e.$$.fragment,a),r=!0)},o(a){e&&C(e.$$.fragment,a),r=!1},d(a){a&&w(n),e&&V(e,a)}}}function Fd(t){let e,n,r;const i=[{ordered:t[4]},t[6]];var s=t[5].list;function u(a){let o={$$slots:{default:[Sd]},$$scope:{ctx:a}};for(let l=0;l<i.length;l+=1)o=ht(o,i[l]);return{props:o}}return s&&(e=_e(s,u(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(a,o){e&&W(e,a,o),b(a,n,o),r=!0},p(a,o){const l=o&80?wn(i,[o&16&&{ordered:a[4]},o&64&&bn(a[6])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].list)){if(e){ee();const c=e;C(c.$$.fragment,1,0,()=>{V(c,1)}),te()}s?(e=_e(s,u(a)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else s&&e.$set(l)},i(a){r||(e&&y(e.$$.fragment,a),r=!0)},o(a){e&&C(e.$$.fragment,a),r=!1},d(a){a&&w(n),e&&V(e,a)}}}function kd(t){let e,n,r;return e=new Cn({props:{tokens:t[18].tokens,renderers:t[5]}}),{c(){X(e.$$.fragment),n=U()},m(i,s){W(e,i,s),b(i,n,s),r=!0},p(i,s){const u={};s&64&&(u.tokens=i[18].tokens),s&32&&(u.renderers=i[5]),e.$set(u)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){V(e,i),i&&w(n)}}}function Tu(t){let e,n,r;const i=[t[18]];var s=t[5].unorderedlistitem||t[5].listitem;function u(a){let o={$$slots:{default:[kd]},$$scope:{ctx:a}};for(let l=0;l<i.length;l+=1)o=ht(o,i[l]);return{props:o}}return s&&(e=_e(s,u(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(a,o){e&&W(e,a,o),b(a,n,o),r=!0},p(a,o){const l=o&64?wn(i,[bn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].unorderedlistitem||a[5].listitem)){if(e){ee();const c=e;C(c.$$.fragment,1,0,()=>{V(c,1)}),te()}s?(e=_e(s,u(a)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else s&&e.$set(l)},i(a){r||(e&&y(e.$$.fragment,a),r=!0)},o(a){e&&C(e.$$.fragment,a),r=!1},d(a){a&&w(n),e&&V(e,a)}}}function vd(t){let e,n,r=t[6].items,i=[];for(let u=0;u<r.length;u+=1)i[u]=Tu(ku(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=ae()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&96){r=u[6].items;let o;for(o=0;o<r.length;o+=1){const l=ku(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=Tu(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function Bd(t){let e,n,r;return e=new Cn({props:{tokens:t[18].tokens,renderers:t[5]}}),{c(){X(e.$$.fragment),n=U()},m(i,s){W(e,i,s),b(i,n,s),r=!0},p(i,s){const u={};s&64&&(u.tokens=i[18].tokens),s&32&&(u.renderers=i[5]),e.$set(u)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){V(e,i),i&&w(n)}}}function $u(t){let e,n,r;const i=[t[18]];var s=t[5].orderedlistitem||t[5].listitem;function u(a){let o={$$slots:{default:[Bd]},$$scope:{ctx:a}};for(let l=0;l<i.length;l+=1)o=ht(o,i[l]);return{props:o}}return s&&(e=_e(s,u(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(a,o){e&&W(e,a,o),b(a,n,o),r=!0},p(a,o){const l=o&64?wn(i,[bn(a[18])]):{};if(o&8388704&&(l.$$scope={dirty:o,ctx:a}),s!==(s=a[5].orderedlistitem||a[5].listitem)){if(e){ee();const c=e;C(c.$$.fragment,1,0,()=>{V(c,1)}),te()}s?(e=_e(s,u(a)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else s&&e.$set(l)},i(a){r||(e&&y(e.$$.fragment,a),r=!0)},o(a){e&&C(e.$$.fragment,a),r=!1},d(a){a&&w(n),e&&V(e,a)}}}function Sd(t){let e,n,r=t[6].items,i=[];for(let u=0;u<r.length;u+=1)i[u]=$u(vu(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=ae()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&96){r=u[6].items;let o;for(o=0;o<r.length;o+=1){const l=vu(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=$u(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function xd(t){let e,n,r;return e=new Cn({props:{tokens:t[16].tokens,renderers:t[5]}}),{c(){X(e.$$.fragment),n=U()},m(i,s){W(e,i,s),b(i,n,s),r=!0},p(i,s){const u={};s&4&&(u.tokens=i[16].tokens),s&32&&(u.renderers=i[5]),e.$set(u)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){V(e,i),i&&w(n)}}}function Ru(t){let e,n,r;var i=t[5].tablecell;function s(u){return{props:{header:!0,align:u[6].align[u[15]]||"center",$$slots:{default:[xd]},$$scope:{ctx:u}}}}return i&&(e=_e(i,s(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(u,a){e&&W(e,u,a),b(u,n,a),r=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388644&&(o.$$scope={dirty:a,ctx:u}),i!==(i=u[5].tablecell)){if(e){ee();const l=e;C(l.$$.fragment,1,0,()=>{V(l,1)}),te()}i?(e=_e(i,s(u)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else i&&e.$set(o)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&C(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&V(e,u)}}}function Id(t){let e,n,r=t[2],i=[];for(let u=0;u<r.length;u+=1)i[u]=Ru(xu(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=ae()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&100){r=u[2];let o;for(o=0;o<r.length;o+=1){const l=xu(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=Ru(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function Td(t){let e,n,r;var i=t[5].tablerow;function s(u){return{props:{$$slots:{default:[Id]},$$scope:{ctx:u}}}}return i&&(e=_e(i,s(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(u,a){e&&W(e,u,a),b(u,n,a),r=!0},p(u,a){const o={};if(a&8388708&&(o.$$scope={dirty:a,ctx:u}),i!==(i=u[5].tablerow)){if(e){ee();const l=e;C(l.$$.fragment,1,0,()=>{V(l,1)}),te()}i?(e=_e(i,s(u)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else i&&e.$set(o)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&C(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&V(e,u)}}}function $d(t){let e,n;return e=new Cn({props:{tokens:t[13].tokens,renderers:t[5]}}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},p(r,i){const s={};i&8&&(s.tokens=r[13].tokens),i&32&&(s.renderers=r[5]),e.$set(s)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function Pu(t){let e,n,r;var i=t[5].tablecell;function s(u){return{props:{header:!1,align:u[6].align[u[15]]||"center",$$slots:{default:[$d]},$$scope:{ctx:u}}}}return i&&(e=_e(i,s(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(u,a){e&&W(e,u,a),b(u,n,a),r=!0},p(u,a){const o={};if(a&64&&(o.align=u[6].align[u[15]]||"center"),a&8388648&&(o.$$scope={dirty:a,ctx:u}),i!==(i=u[5].tablecell)){if(e){ee();const l=e;C(l.$$.fragment,1,0,()=>{V(l,1)}),te()}i?(e=_e(i,s(u)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else i&&e.$set(o)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&C(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&V(e,u)}}}function Rd(t){let e,n,r=t[10],i=[];for(let u=0;u<r.length;u+=1)i[u]=Pu(Su(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=U()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&104){r=u[10];let o;for(o=0;o<r.length;o+=1){const l=Su(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=Pu(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function Mu(t){let e,n,r;var i=t[5].tablerow;function s(u){return{props:{$$slots:{default:[Rd]},$$scope:{ctx:u}}}}return i&&(e=_e(i,s(t))),{c(){e&&X(e.$$.fragment),n=ae()},m(u,a){e&&W(e,u,a),b(u,n,a),r=!0},p(u,a){const o={};if(a&8388712&&(o.$$scope={dirty:a,ctx:u}),i!==(i=u[5].tablerow)){if(e){ee();const l=e;C(l.$$.fragment,1,0,()=>{V(l,1)}),te()}i?(e=_e(i,s(u)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else i&&e.$set(o)},i(u){r||(e&&y(e.$$.fragment,u),r=!0)},o(u){e&&C(e.$$.fragment,u),r=!1},d(u){u&&w(n),e&&V(e,u)}}}function Pd(t){let e,n,r=t[3],i=[];for(let u=0;u<r.length;u+=1)i[u]=Mu(Bu(t,r,u));const s=u=>C(i[u],1,1,()=>{i[u]=null});return{c(){for(let u=0;u<i.length;u+=1)i[u].c();e=ae()},m(u,a){for(let o=0;o<i.length;o+=1)i[o].m(u,a);b(u,e,a),n=!0},p(u,a){if(a&104){r=u[3];let o;for(o=0;o<r.length;o+=1){const l=Bu(u,r,o);i[o]?(i[o].p(l,a),y(i[o],1)):(i[o]=Mu(l),i[o].c(),y(i[o],1),i[o].m(e.parentNode,e))}for(ee(),o=r.length;o<i.length;o+=1)s(o);te()}},i(u){if(!n){for(let a=0;a<r.length;a+=1)y(i[a]);n=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)C(i[a]);n=!1},d(u){Un(i,u),u&&w(e)}}}function Md(t){let e,n,r,i,s;var u=t[5].tablehead;function a(c){return{props:{$$slots:{default:[Td]},$$scope:{ctx:c}}}}u&&(e=_e(u,a(t)));var o=t[5].tablebody;function l(c){return{props:{$$slots:{default:[Pd]},$$scope:{ctx:c}}}}return o&&(r=_e(o,l(t))),{c(){e&&X(e.$$.fragment),n=U(),r&&X(r.$$.fragment),i=ae()},m(c,h){e&&W(e,c,h),b(c,n,h),r&&W(r,c,h),b(c,i,h),s=!0},p(c,h){const f={};if(h&8388708&&(f.$$scope={dirty:h,ctx:c}),u!==(u=c[5].tablehead)){if(e){ee();const p=e;C(p.$$.fragment,1,0,()=>{V(p,1)}),te()}u?(e=_e(u,a(c)),X(e.$$.fragment),y(e.$$.fragment,1),W(e,n.parentNode,n)):e=null}else u&&e.$set(f);const d={};if(h&8388712&&(d.$$scope={dirty:h,ctx:c}),o!==(o=c[5].tablebody)){if(r){ee();const p=r;C(p.$$.fragment,1,0,()=>{V(p,1)}),te()}o?(r=_e(o,l(c)),X(r.$$.fragment),y(r.$$.fragment,1),W(r,i.parentNode,i)):r=null}else o&&r.$set(d)},i(c){s||(e&&y(e.$$.fragment,c),r&&y(r.$$.fragment,c),s=!0)},o(c){e&&C(e.$$.fragment,c),r&&C(r.$$.fragment,c),s=!1},d(c){e&&V(e,c),c&&w(n),c&&w(i),r&&V(r,c)}}}function Ou(t){let e,n;const r=[t[7],{renderers:t[5]}];let i={};for(let s=0;s<r.length;s+=1)i=ht(i,r[s]);return e=new Cn({props:i}),{c(){X(e.$$.fragment)},m(s,u){W(e,s,u),n=!0},p(s,u){const a=u&34?wn(r,[u&2&&bn(s[7]),u&32&&{renderers:s[5]}]):{};e.$set(a)},i(s){n||(y(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){V(e,s)}}}function Od(t){let e,n,r,i;const s=[gd,md],u=[];function a(o,l){return o[0]?o[5][o[0]]?1:-1:0}return~(e=a(t))&&(n=u[e]=s[e](t)),{c(){n&&n.c(),r=ae()},m(o,l){~e&&u[e].m(o,l),b(o,r,l),i=!0},p(o,[l]){let c=e;e=a(o),e===c?~e&&u[e].p(o,l):(n&&(ee(),C(u[c],1,1,()=>{u[c]=null}),te()),~e?(n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){~e&&u[e].d(o),o&&w(r)}}}function Nd(t,e,n){const r=["type","tokens","header","rows","ordered","renderers"];let i=ps(e,r),{type:s=void 0}=e,{tokens:u=void 0}=e,{header:a=void 0}=e,{rows:o=void 0}=e,{ordered:l=!1}=e,{renderers:c}=e;return Dd(),t.$$set=h=>{e=ht(ht({},e),Fi(h)),n(6,i=ps(e,r)),"type"in h&&n(0,s=h.type),"tokens"in h&&n(1,u=h.tokens),"header"in h&&n(2,a=h.header),"rows"in h&&n(3,o=h.rows),"ordered"in h&&n(4,l=h.ordered),"renderers"in h&&n(5,c=h.renderers)},[s,u,a,o,l,c,i]}let Cn=class extends ue{constructor(e){super(),se(this,e,Nd,Od,re,{type:0,tokens:1,header:2,rows:3,ordered:4,renderers:5})}};function Mo(){return{async:!1,baseUrl:null,breaks:!1,extensions:null,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}let Kn=Mo();function Ld(t){Kn=t}const Oo=/[&<>"']/,Ud=new RegExp(Oo.source,"g"),No=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,zd=new RegExp(No.source,"g"),Hd={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Nu=t=>Hd[t];function Ne(t,e){if(e){if(Oo.test(t))return t.replace(Ud,Nu)}else if(No.test(t))return t.replace(zd,Nu);return t}const qd=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function Lo(t){return t.replace(qd,(e,n)=>(n=n.toLowerCase(),n==="colon"?":":n.charAt(0)==="#"?n.charAt(1)==="x"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""))}const jd=/(^|[^\[])\^/g;function pe(t,e){t=typeof t=="string"?t:t.source,e=e||"";const n={replace:(r,i)=>(i=i.source||i,i=i.replace(jd,"$1"),t=t.replace(r,i),n),getRegex:()=>new RegExp(t,e)};return n}const Wd=/[^\w:]/g,Vd=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function Lu(t,e,n){if(t){let r;try{r=decodeURIComponent(Lo(n)).replace(Wd,"").toLowerCase()}catch{return null}if(r.indexOf("javascript:")===0||r.indexOf("vbscript:")===0||r.indexOf("data:")===0)return null}e&&!Vd.test(n)&&(n=Zd(e,n));try{n=encodeURI(n).replace(/%25/g,"%")}catch{return null}return n}const xr={},Qd=/^[^:]+:\/*[^/]*$/,Kd=/^([^:]+:)[\s\S]*$/,Gd=/^([^:]+:\/*[^/]*)[\s\S]*$/;function Zd(t,e){xr[" "+t]||(Qd.test(t)?xr[" "+t]=t+"/":xr[" "+t]=Rr(t,"/",!0)),t=xr[" "+t];const n=t.indexOf(":")===-1;return e.substring(0,2)==="//"?n?e:t.replace(Kd,"$1")+e:e.charAt(0)==="/"?n?e:t.replace(Gd,"$1")+e:t+e}const Vr={exec:function(){}};function mt(t){let e=1,n,r;for(;e<arguments.length;e++){n=arguments[e];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}function Uu(t,e){const n=t.replace(/\|/g,(s,u,a)=>{let o=!1,l=u;for(;--l>=0&&a[l]==="\\";)o=!o;return o?"|":" |"}),r=n.split(/ \|/);let i=0;if(r[0].trim()||r.shift(),r.length>0&&!r[r.length-1].trim()&&r.pop(),r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(/\\\|/g,"|");return r}function Rr(t,e,n){const r=t.length;if(r===0)return"";let i=0;for(;i<r;){const s=t.charAt(r-i-1);if(s===e&&!n)i++;else if(s!==e&&n)i++;else break}return t.slice(0,r-i)}function Xd(t,e){if(t.indexOf(e[1])===-1)return-1;const n=t.length;let r=0,i=0;for(;i<n;i++)if(t[i]==="\\")i++;else if(t[i]===e[0])r++;else if(t[i]===e[1]&&(r--,r<0))return i;return-1}function Uo(t){t&&t.sanitize&&!t.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}function zu(t,e){if(e<1)return"";let n="";for(;e>1;)e&1&&(n+=t),e>>=1,t+=t;return n+t}function Hu(t,e,n,r){const i=e.href,s=e.title?Ne(e.title):null,u=t[1].replace(/\\([\[\]])/g,"$1");if(t[0].charAt(0)!=="!"){r.state.inLink=!0;const a={type:"link",raw:n,href:i,title:s,text:u,tokens:r.inlineTokens(u)};return r.state.inLink=!1,a}return{type:"image",raw:n,href:i,title:s,text:Ne(u)}}function Yd(t,e){const n=t.match(/^(\s+)(?:```)/);if(n===null)return e;const r=n[1];return e.split(`
`).map(i=>{const s=i.match(/^\s+/);if(s===null)return i;const[u]=s;return u.length>=r.length?i.slice(r.length):i}).join(`
`)}class ls{constructor(e){this.options=e||Kn}space(e){const n=this.rules.block.newline.exec(e);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(e){const n=this.rules.block.code.exec(e);if(n){const r=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?r:Rr(r,`
`)}}}fences(e){const n=this.rules.block.fences.exec(e);if(n){const r=n[0],i=Yd(r,n[3]||"");return{type:"code",raw:r,lang:n[2]?n[2].trim().replace(this.rules.inline._escapes,"$1"):n[2],text:i}}}heading(e){const n=this.rules.block.heading.exec(e);if(n){let r=n[2].trim();if(/#$/.test(r)){const i=Rr(r,"#");(this.options.pedantic||!i||/ $/.test(i))&&(r=i.trim())}return{type:"heading",raw:n[0],depth:n[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(e){const n=this.rules.block.hr.exec(e);if(n)return{type:"hr",raw:n[0]}}blockquote(e){const n=this.rules.block.blockquote.exec(e);if(n){const r=n[0].replace(/^ *>[ \t]?/gm,""),i=this.lexer.state.top;this.lexer.state.top=!0;const s=this.lexer.blockTokens(r);return this.lexer.state.top=i,{type:"blockquote",raw:n[0],tokens:s,text:r}}}list(e){let n=this.rules.block.list.exec(e);if(n){let r,i,s,u,a,o,l,c,h,f,d,p,D=n[1].trim();const m=D.length>1,A={type:"list",raw:"",ordered:m,start:m?+D.slice(0,-1):"",loose:!1,items:[]};D=m?`\\d{1,9}\\${D.slice(-1)}`:`\\${D}`,this.options.pedantic&&(D=m?D:"[*+-]");const F=new RegExp(`^( {0,3}${D})((?:[	 ][^\\n]*)?(?:\\n|$))`);for(;e&&(p=!1,!(!(n=F.exec(e))||this.rules.block.hr.test(e)));){if(r=n[0],e=e.substring(r.length),c=n[2].split(`
`,1)[0].replace(/^\t+/,g=>" ".repeat(3*g.length)),h=e.split(`
`,1)[0],this.options.pedantic?(u=2,d=c.trimLeft()):(u=n[2].search(/[^ ]/),u=u>4?1:u,d=c.slice(u),u+=n[1].length),o=!1,!c&&/^ *$/.test(h)&&(r+=h+`
`,e=e.substring(h.length+1),p=!0),!p){const g=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,u-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),k=new RegExp(`^ {0,${Math.min(3,u-1)}}(?:\`\`\`|~~~)`),x=new RegExp(`^ {0,${Math.min(3,u-1)}}#`);for(;e&&(f=e.split(`
`,1)[0],h=f,this.options.pedantic&&(h=h.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),!(k.test(h)||x.test(h)||g.test(h)||S.test(e)));){if(h.search(/[^ ]/)>=u||!h.trim())d+=`
`+h.slice(u);else{if(o||c.search(/[^ ]/)>=4||k.test(c)||x.test(c)||S.test(c))break;d+=`
`+h}!o&&!h.trim()&&(o=!0),r+=f+`
`,e=e.substring(f.length+1),c=h.slice(u)}}A.loose||(l?A.loose=!0:/\n *\n *$/.test(r)&&(l=!0)),this.options.gfm&&(i=/^\[[ xX]\] /.exec(d),i&&(s=i[0]!=="[ ] ",d=d.replace(/^\[[ xX]\] +/,""))),A.items.push({type:"list_item",raw:r,task:!!i,checked:s,loose:!1,text:d}),A.raw+=r}A.items[A.items.length-1].raw=r.trimRight(),A.items[A.items.length-1].text=d.trimRight(),A.raw=A.raw.trimRight();const _=A.items.length;for(a=0;a<_;a++)if(this.lexer.state.top=!1,A.items[a].tokens=this.lexer.blockTokens(A.items[a].text,[]),!A.loose){const g=A.items[a].tokens.filter(k=>k.type==="space"),S=g.length>0&&g.some(k=>/\n.*\n/.test(k.raw));A.loose=S}if(A.loose)for(a=0;a<_;a++)A.items[a].loose=!0;return A}}html(e){const n=this.rules.block.html.exec(e);if(n){const r={type:"html",raw:n[0],pre:!this.options.sanitizer&&(n[1]==="pre"||n[1]==="script"||n[1]==="style"),text:n[0]};if(this.options.sanitize){const i=this.options.sanitizer?this.options.sanitizer(n[0]):Ne(n[0]);r.type="paragraph",r.text=i,r.tokens=this.lexer.inline(i)}return r}}def(e){const n=this.rules.block.def.exec(e);if(n){const r=n[1].toLowerCase().replace(/\s+/g," "),i=n[2]?n[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline._escapes,"$1"):"",s=n[3]?n[3].substring(1,n[3].length-1).replace(this.rules.inline._escapes,"$1"):n[3];return{type:"def",tag:r,raw:n[0],href:i,title:s}}}table(e){const n=this.rules.block.table.exec(e);if(n){const r={type:"table",header:Uu(n[1]).map(i=>({text:i})),align:n[2].replace(/^ *|\| *$/g,"").split(/ *\| */),rows:n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split(`
`):[]};if(r.header.length===r.align.length){r.raw=n[0];let i=r.align.length,s,u,a,o;for(s=0;s<i;s++)/^ *-+: *$/.test(r.align[s])?r.align[s]="right":/^ *:-+: *$/.test(r.align[s])?r.align[s]="center":/^ *:-+ *$/.test(r.align[s])?r.align[s]="left":r.align[s]=null;for(i=r.rows.length,s=0;s<i;s++)r.rows[s]=Uu(r.rows[s],r.header.length).map(l=>({text:l}));for(i=r.header.length,u=0;u<i;u++)r.header[u].tokens=this.lexer.inline(r.header[u].text);for(i=r.rows.length,u=0;u<i;u++)for(o=r.rows[u],a=0;a<o.length;a++)o[a].tokens=this.lexer.inline(o[a].text);return r}}}lheading(e){const n=this.rules.block.lheading.exec(e);if(n)return{type:"heading",raw:n[0],depth:n[2].charAt(0)==="="?1:2,text:n[1],tokens:this.lexer.inline(n[1])}}paragraph(e){const n=this.rules.block.paragraph.exec(e);if(n){const r=n[1].charAt(n[1].length-1)===`
`?n[1].slice(0,-1):n[1];return{type:"paragraph",raw:n[0],text:r,tokens:this.lexer.inline(r)}}}text(e){const n=this.rules.block.text.exec(e);if(n)return{type:"text",raw:n[0],text:n[0],tokens:this.lexer.inline(n[0])}}escape(e){const n=this.rules.inline.escape.exec(e);if(n)return{type:"escape",raw:n[0],text:Ne(n[1])}}tag(e){const n=this.rules.inline.tag.exec(e);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:this.options.sanitize?"text":"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):Ne(n[0]):n[0]}}link(e){const n=this.rules.inline.link.exec(e);if(n){const r=n[2].trim();if(!this.options.pedantic&&/^</.test(r)){if(!/>$/.test(r))return;const u=Rr(r.slice(0,-1),"\\");if((r.length-u.length)%2===0)return}else{const u=Xd(n[2],"()");if(u>-1){const o=(n[0].indexOf("!")===0?5:4)+n[1].length+u;n[2]=n[2].substring(0,u),n[0]=n[0].substring(0,o).trim(),n[3]=""}}let i=n[2],s="";if(this.options.pedantic){const u=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(i);u&&(i=u[1],s=u[3])}else s=n[3]?n[3].slice(1,-1):"";return i=i.trim(),/^</.test(i)&&(this.options.pedantic&&!/>$/.test(r)?i=i.slice(1):i=i.slice(1,-1)),Hu(n,{href:i&&i.replace(this.rules.inline._escapes,"$1"),title:s&&s.replace(this.rules.inline._escapes,"$1")},n[0],this.lexer)}}reflink(e,n){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){let i=(r[2]||r[1]).replace(/\s+/g," ");if(i=n[i.toLowerCase()],!i){const s=r[0].charAt(0);return{type:"text",raw:s,text:s}}return Hu(r,i,r[0],this.lexer)}}emStrong(e,n,r=""){let i=this.rules.inline.emStrong.lDelim.exec(e);if(!i||i[3]&&r.match(/[\p{L}\p{N}]/u))return;const s=i[1]||i[2]||"";if(!s||s&&(r===""||this.rules.inline.punctuation.exec(r))){const u=i[0].length-1;let a,o,l=u,c=0;const h=i[0][0]==="*"?this.rules.inline.emStrong.rDelimAst:this.rules.inline.emStrong.rDelimUnd;for(h.lastIndex=0,n=n.slice(-1*e.length+u);(i=h.exec(n))!=null;){if(a=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!a)continue;if(o=a.length,i[3]||i[4]){l+=o;continue}else if((i[5]||i[6])&&u%3&&!((u+o)%3)){c+=o;continue}if(l-=o,l>0)continue;o=Math.min(o,o+l+c);const f=e.slice(0,u+i.index+(i[0].length-a.length)+o);if(Math.min(u,o)%2){const p=f.slice(1,-1);return{type:"em",raw:f,text:p,tokens:this.lexer.inlineTokens(p)}}const d=f.slice(2,-2);return{type:"strong",raw:f,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){const n=this.rules.inline.code.exec(e);if(n){let r=n[2].replace(/\n/g," ");const i=/[^ ]/.test(r),s=/^ /.test(r)&&/ $/.test(r);return i&&s&&(r=r.substring(1,r.length-1)),r=Ne(r,!0),{type:"codespan",raw:n[0],text:r}}}br(e){const n=this.rules.inline.br.exec(e);if(n)return{type:"br",raw:n[0]}}del(e){const n=this.rules.inline.del.exec(e);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2])}}autolink(e,n){const r=this.rules.inline.autolink.exec(e);if(r){let i,s;return r[2]==="@"?(i=Ne(this.options.mangle?n(r[1]):r[1]),s="mailto:"+i):(i=Ne(r[1]),s=i),{type:"link",raw:r[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}url(e,n){let r;if(r=this.rules.inline.url.exec(e)){let i,s;if(r[2]==="@")i=Ne(this.options.mangle?n(r[0]):r[0]),s="mailto:"+i;else{let u;do u=r[0],r[0]=this.rules.inline._backpedal.exec(r[0])[0];while(u!==r[0]);i=Ne(r[0]),r[1]==="www."?s="http://"+r[0]:s=r[0]}return{type:"link",raw:r[0],text:i,href:s,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(e,n){const r=this.rules.inline.text.exec(e);if(r){let i;return this.lexer.state.inRawBlock?i=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):Ne(r[0]):r[0]:i=Ne(this.options.smartypants?n(r[0]):r[0]),{type:"text",raw:r[0],text:i}}}}const q={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?=\n|$)|$)/,hr:/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/,html:"^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))",def:/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/,table:Vr,lheading:/^((?:.|\n(?!\n))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,text:/^[^\n]+/};q._label=/(?!\s*\])(?:\\.|[^\[\]\\])+/;q._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/;q.def=pe(q.def).replace("label",q._label).replace("title",q._title).getRegex();q.bullet=/(?:[*+-]|\d{1,9}[.)])/;q.listItemStart=pe(/^( *)(bull) */).replace("bull",q.bullet).getRegex();q.list=pe(q.list).replace(/bull/g,q.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+q.def.source+")").getRegex();q._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul";q._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/;q.html=pe(q.html,"i").replace("comment",q._comment).replace("tag",q._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex();q.paragraph=pe(q._paragraph).replace("hr",q.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.blockquote=pe(q.blockquote).replace("paragraph",q.paragraph).getRegex();q.normal=mt({},q);q.gfm=mt({},q.normal,{table:"^ *([^\\n ].*\\|.*)\\n {0,3}(?:\\| *)?(:?-+:? *(?:\\| *:?-+:? *)*)(?:\\| *)?(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"});q.gfm.table=pe(q.gfm.table).replace("hr",q.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.gfm.paragraph=pe(q._paragraph).replace("hr",q.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("table",q.gfm.table).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",q._tag).getRegex();q.pedantic=mt({},q.normal,{html:pe(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",q._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Vr,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:pe(q.normal._paragraph).replace("hr",q.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",q.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});const N={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:Vr,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(ref)\]/,nolink:/^!?\[(ref)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",emStrong:{lDelim:/^(?:\*+(?:([punct_])|[^\s*]))|^_+(?:([punct*])|([^\s_]))/,rDelimAst:/^(?:[^_*\\]|\\.)*?\_\_(?:[^_*\\]|\\.)*?\*(?:[^_*\\]|\\.)*?(?=\_\_)|(?:[^*\\]|\\.)+(?=[^*])|[punct_](\*+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\*+)(?=[punct_\s]|$)|[punct_\s](\*+)(?=[^punct*_\s])|[\s](\*+)(?=[punct_])|[punct_](\*+)(?=[punct_])|(?:[^punct*_\s\\]|\\.)(\*+)(?=[^punct*_\s])/,rDelimUnd:/^(?:[^_*\\]|\\.)*?\*\*(?:[^_*\\]|\\.)*?\_(?:[^_*\\]|\\.)*?(?=\*\*)|(?:[^_\\]|\\.)+(?=[^_])|[punct*](\_+)(?=[\s]|$)|(?:[^punct*_\s\\]|\\.)(\_+)(?=[punct*\s]|$)|[punct*\s](\_+)(?=[^punct*_\s])|[\s](\_+)(?=[punct*])|[punct*](\_+)(?=[punct*])/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:Vr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\spunctuation])/};N._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~";N.punctuation=pe(N.punctuation).replace(/punctuation/g,N._punctuation).getRegex();N.blockSkip=/\[[^\]]*?\]\([^\)]*?\)|`[^`]*?`|<[^>]*?>/g;N.escapedEmSt=/(?:^|[^\\])(?:\\\\)*\\[*_]/g;N._comment=pe(q._comment).replace("(?:-->|$)","-->").getRegex();N.emStrong.lDelim=pe(N.emStrong.lDelim).replace(/punct/g,N._punctuation).getRegex();N.emStrong.rDelimAst=pe(N.emStrong.rDelimAst,"g").replace(/punct/g,N._punctuation).getRegex();N.emStrong.rDelimUnd=pe(N.emStrong.rDelimUnd,"g").replace(/punct/g,N._punctuation).getRegex();N._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g;N._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/;N._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/;N.autolink=pe(N.autolink).replace("scheme",N._scheme).replace("email",N._email).getRegex();N._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/;N.tag=pe(N.tag).replace("comment",N._comment).replace("attribute",N._attribute).getRegex();N._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/;N._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/;N._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/;N.link=pe(N.link).replace("label",N._label).replace("href",N._href).replace("title",N._title).getRegex();N.reflink=pe(N.reflink).replace("label",N._label).replace("ref",q._label).getRegex();N.nolink=pe(N.nolink).replace("ref",q._label).getRegex();N.reflinkSearch=pe(N.reflinkSearch,"g").replace("reflink",N.reflink).replace("nolink",N.nolink).getRegex();N.normal=mt({},N);N.pedantic=mt({},N.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:pe(/^!?\[(label)\]\((.*?)\)/).replace("label",N._label).getRegex(),reflink:pe(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",N._label).getRegex()});N.gfm=mt({},N.normal,{escape:pe(N.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/});N.gfm.url=pe(N.gfm.url,"i").replace("email",N.gfm._extended_email).getRegex();N.breaks=mt({},N.gfm,{br:pe(N.br).replace("{2,}","*").getRegex(),text:pe(N.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});function Jd(t){return t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function qu(t){let e="",n,r;const i=t.length;for(n=0;n<i;n++)r=t.charCodeAt(n),Math.random()>.5&&(r="x"+r.toString(16)),e+="&#"+r+";";return e}class St{constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Kn,this.options.tokenizer=this.options.tokenizer||new ls,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:q.normal,inline:N.normal};this.options.pedantic?(n.block=q.pedantic,n.inline=N.pedantic):this.options.gfm&&(n.block=q.gfm,this.options.breaks?n.inline=N.breaks:n.inline=N.gfm),this.tokenizer.rules=n}static get rules(){return{block:q,inline:N}}static lex(e,n){return new St(n).lex(e)}static lexInline(e,n){return new St(n).inlineTokens(e)}lex(e){e=e.replace(/\r\n|\r/g,`
`),this.blockTokens(e,this.tokens);let n;for(;n=this.inlineQueue.shift();)this.inlineTokens(n.src,n.tokens);return this.tokens}blockTokens(e,n=[]){this.options.pedantic?e=e.replace(/\t/g,"    ").replace(/^ +$/gm,""):e=e.replace(/^( *)(\t+)/gm,(a,o,l)=>o+"    ".repeat(l.length));let r,i,s,u;for(;e;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(a=>(r=a.call({lexer:this},e,n))?(e=e.substring(r.raw.length),n.push(r),!0):!1))){if(r=this.tokenizer.space(e)){e=e.substring(r.raw.length),r.raw.length===1&&n.length>0?n[n.length-1].raw+=`
`:n.push(r);continue}if(r=this.tokenizer.code(e)){e=e.substring(r.raw.length),i=n[n.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+r.raw,i.text+=`
`+r.text,this.inlineQueue[this.inlineQueue.length-1].src=i.text):n.push(r);continue}if(r=this.tokenizer.fences(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.heading(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.hr(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.blockquote(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.list(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.html(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.def(e)){e=e.substring(r.raw.length),i=n[n.length-1],i&&(i.type==="paragraph"||i.type==="text")?(i.raw+=`
`+r.raw,i.text+=`
`+r.raw,this.inlineQueue[this.inlineQueue.length-1].src=i.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.lheading(e)){e=e.substring(r.raw.length),n.push(r);continue}if(s=e,this.options.extensions&&this.options.extensions.startBlock){let a=1/0;const o=e.slice(1);let l;this.options.extensions.startBlock.forEach(function(c){l=c.call({lexer:this},o),typeof l=="number"&&l>=0&&(a=Math.min(a,l))}),a<1/0&&a>=0&&(s=e.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(s))){i=n[n.length-1],u&&i.type==="paragraph"?(i.raw+=`
`+r.raw,i.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):n.push(r),u=s.length!==e.length,e=e.substring(r.raw.length);continue}if(r=this.tokenizer.text(e)){e=e.substring(r.raw.length),i=n[n.length-1],i&&i.type==="text"?(i.raw+=`
`+r.raw,i.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=i.text):n.push(r);continue}if(e){const a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r,i,s,u=e,a,o,l;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(u))!=null;)c.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(u=u.slice(0,a.index)+"["+zu("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.blockSkip.exec(u))!=null;)u=u.slice(0,a.index)+"["+zu("a",a[0].length-2)+"]"+u.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(a=this.tokenizer.rules.inline.escapedEmSt.exec(u))!=null;)u=u.slice(0,a.index+a[0].length-2)+"++"+u.slice(this.tokenizer.rules.inline.escapedEmSt.lastIndex),this.tokenizer.rules.inline.escapedEmSt.lastIndex--;for(;e;)if(o||(l=""),o=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(c=>(r=c.call({lexer:this},e,n))?(e=e.substring(r.raw.length),n.push(r),!0):!1))){if(r=this.tokenizer.escape(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.tag(e)){e=e.substring(r.raw.length),i=n[n.length-1],i&&r.type==="text"&&i.type==="text"?(i.raw+=r.raw,i.text+=r.text):n.push(r);continue}if(r=this.tokenizer.link(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(r.raw.length),i=n[n.length-1],i&&r.type==="text"&&i.type==="text"?(i.raw+=r.raw,i.text+=r.text):n.push(r);continue}if(r=this.tokenizer.emStrong(e,u,l)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.codespan(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.br(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.del(e)){e=e.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.autolink(e,qu)){e=e.substring(r.raw.length),n.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(e,qu))){e=e.substring(r.raw.length),n.push(r);continue}if(s=e,this.options.extensions&&this.options.extensions.startInline){let c=1/0;const h=e.slice(1);let f;this.options.extensions.startInline.forEach(function(d){f=d.call({lexer:this},h),typeof f=="number"&&f>=0&&(c=Math.min(c,f))}),c<1/0&&c>=0&&(s=e.substring(0,c+1))}if(r=this.tokenizer.inlineText(s,Jd)){e=e.substring(r.raw.length),r.raw.slice(-1)!=="_"&&(l=r.raw.slice(-1)),o=!0,i=n[n.length-1],i&&i.type==="text"?(i.raw+=r.raw,i.text+=r.text):n.push(r);continue}if(e){const c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return n}}class cs{constructor(e){this.options=e||Kn}code(e,n,r){const i=(n||"").match(/\S*/)[0];if(this.options.highlight){const s=this.options.highlight(e,i);s!=null&&s!==e&&(r=!0,e=s)}return e=e.replace(/\n$/,"")+`
`,i?'<pre><code class="'+this.options.langPrefix+Ne(i)+'">'+(r?e:Ne(e,!0))+`</code></pre>
`:"<pre><code>"+(r?e:Ne(e,!0))+`</code></pre>
`}blockquote(e){return`<blockquote>
${e}</blockquote>
`}html(e){return e}heading(e,n,r,i){if(this.options.headerIds){const s=this.options.headerPrefix+i.slug(r);return`<h${n} id="${s}">${e}</h${n}>
`}return`<h${n}>${e}</h${n}>
`}hr(){return this.options.xhtml?`<hr/>
`:`<hr>
`}list(e,n,r){const i=n?"ol":"ul",s=n&&r!==1?' start="'+r+'"':"";return"<"+i+s+`>
`+e+"</"+i+`>
`}listitem(e){return`<li>${e}</li>
`}checkbox(e){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "}paragraph(e){return`<p>${e}</p>
`}table(e,n){return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow(e){return`<tr>
${e}</tr>
`}tablecell(e,n){const r=n.header?"th":"td";return(n.align?`<${r} align="${n.align}">`:`<${r}>`)+e+`</${r}>
`}strong(e){return`<strong>${e}</strong>`}em(e){return`<em>${e}</em>`}codespan(e){return`<code>${e}</code>`}br(){return this.options.xhtml?"<br/>":"<br>"}del(e){return`<del>${e}</del>`}link(e,n,r){if(e=Lu(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let i='<a href="'+e+'"';return n&&(i+=' title="'+n+'"'),i+=">"+r+"</a>",i}image(e,n,r){if(e=Lu(this.options.sanitize,this.options.baseUrl,e),e===null)return r;let i=`<img src="${e}" alt="${r}"`;return n&&(i+=` title="${n}"`),i+=this.options.xhtml?"/>":">",i}text(e){return e}}class zo{strong(e){return e}em(e){return e}codespan(e){return e}del(e){return e}html(e){return e}text(e){return e}link(e,n,r){return""+r}image(e,n,r){return""+r}br(){return""}}class hs{constructor(){this.seen={}}serialize(e){return e.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")}getNextSafeSlug(e,n){let r=e,i=0;if(this.seen.hasOwnProperty(r)){i=this.seen[e];do i++,r=e+"-"+i;while(this.seen.hasOwnProperty(r))}return n||(this.seen[e]=i,this.seen[r]=0),r}slug(e,n={}){const r=this.serialize(e);return this.getNextSafeSlug(r,n.dryrun)}}class Bt{constructor(e){this.options=e||Kn,this.options.renderer=this.options.renderer||new cs,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new zo,this.slugger=new hs}static parse(e,n){return new Bt(n).parse(e)}static parseInline(e,n){return new Bt(n).parseInline(e)}parse(e,n=!0){let r="",i,s,u,a,o,l,c,h,f,d,p,D,m,A,F,_,g,S,k;const x=e.length;for(i=0;i<x;i++){if(d=e[i],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[d.type]&&(k=this.options.extensions.renderers[d.type].call({parser:this},d),k!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type))){r+=k||"";continue}switch(d.type){case"space":continue;case"hr":{r+=this.renderer.hr();continue}case"heading":{r+=this.renderer.heading(this.parseInline(d.tokens),d.depth,Lo(this.parseInline(d.tokens,this.textRenderer)),this.slugger);continue}case"code":{r+=this.renderer.code(d.text,d.lang,d.escaped);continue}case"table":{for(h="",c="",a=d.header.length,s=0;s<a;s++)c+=this.renderer.tablecell(this.parseInline(d.header[s].tokens),{header:!0,align:d.align[s]});for(h+=this.renderer.tablerow(c),f="",a=d.rows.length,s=0;s<a;s++){for(l=d.rows[s],c="",o=l.length,u=0;u<o;u++)c+=this.renderer.tablecell(this.parseInline(l[u].tokens),{header:!1,align:d.align[u]});f+=this.renderer.tablerow(c)}r+=this.renderer.table(h,f);continue}case"blockquote":{f=this.parse(d.tokens),r+=this.renderer.blockquote(f);continue}case"list":{for(p=d.ordered,D=d.start,m=d.loose,a=d.items.length,f="",s=0;s<a;s++)F=d.items[s],_=F.checked,g=F.task,A="",F.task&&(S=this.renderer.checkbox(_),m?F.tokens.length>0&&F.tokens[0].type==="paragraph"?(F.tokens[0].text=S+" "+F.tokens[0].text,F.tokens[0].tokens&&F.tokens[0].tokens.length>0&&F.tokens[0].tokens[0].type==="text"&&(F.tokens[0].tokens[0].text=S+" "+F.tokens[0].tokens[0].text)):F.tokens.unshift({type:"text",text:S}):A+=S),A+=this.parse(F.tokens,m),f+=this.renderer.listitem(A,g,_);r+=this.renderer.list(f,p,D);continue}case"html":{r+=this.renderer.html(d.text);continue}case"paragraph":{r+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{for(f=d.tokens?this.parseInline(d.tokens):d.text;i+1<x&&e[i+1].type==="text";)d=e[++i],f+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);r+=n?this.renderer.paragraph(f):f;continue}default:{const R='Token with "'+d.type+'" type was not found.';if(this.options.silent){console.error(R);return}else throw new Error(R)}}}return r}parseInline(e,n){n=n||this.renderer;let r="",i,s,u;const a=e.length;for(i=0;i<a;i++){if(s=e[i],this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[s.type]&&(u=this.options.extensions.renderers[s.type].call({parser:this},s),u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type))){r+=u||"";continue}switch(s.type){case"escape":{r+=n.text(s.text);break}case"html":{r+=n.html(s.text);break}case"link":{r+=n.link(s.href,s.title,this.parseInline(s.tokens,n));break}case"image":{r+=n.image(s.href,s.title,s.text);break}case"strong":{r+=n.strong(this.parseInline(s.tokens,n));break}case"em":{r+=n.em(this.parseInline(s.tokens,n));break}case"codespan":{r+=n.codespan(s.text);break}case"br":{r+=n.br();break}case"del":{r+=n.del(this.parseInline(s.tokens,n));break}case"text":{r+=n.text(s.text);break}default:{const o='Token with "'+s.type+'" type was not found.';if(this.options.silent){console.error(o);return}else throw new Error(o)}}}return r}}function Z(t,e,n){if(typeof t>"u"||t===null)throw new Error("marked(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");if(typeof e=="function"&&(n=e,e=null),e=mt({},Z.defaults,e||{}),Uo(e),n){const i=e.highlight;let s;try{s=St.lex(t,e)}catch(o){return n(o)}const u=function(o){let l;if(!o)try{e.walkTokens&&Z.walkTokens(s,e.walkTokens),l=Bt.parse(s,e)}catch(c){o=c}return e.highlight=i,o?n(o):n(null,l)};if(!i||i.length<3||(delete e.highlight,!s.length))return u();let a=0;Z.walkTokens(s,function(o){o.type==="code"&&(a++,setTimeout(()=>{i(o.text,o.lang,function(l,c){if(l)return u(l);c!=null&&c!==o.text&&(o.text=c,o.escaped=!0),a--,a===0&&u()})},0))}),a===0&&u();return}function r(i){if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Ne(i.message+"",!0)+"</pre>";throw i}try{const i=St.lex(t,e);if(e.walkTokens){if(e.async)return Promise.all(Z.walkTokens(i,e.walkTokens)).then(()=>Bt.parse(i,e)).catch(r);Z.walkTokens(i,e.walkTokens)}return Bt.parse(i,e)}catch(i){r(i)}}Z.options=Z.setOptions=function(t){return mt(Z.defaults,t),Ld(Z.defaults),Z};Z.getDefaults=Mo;Z.defaults=Kn;Z.use=function(...t){const e=Z.defaults.extensions||{renderers:{},childTokens:{}};t.forEach(n=>{const r=mt({},n);if(r.async=Z.defaults.async||r.async,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if(i.renderer){const s=e.renderers[i.name];s?e.renderers[i.name]=function(...u){let a=i.renderer.apply(this,u);return a===!1&&(a=s.apply(this,u)),a}:e.renderers[i.name]=i.renderer}if(i.tokenizer){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");e[i.level]?e[i.level].unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),n.renderer){const i=Z.defaults.renderer||new cs;for(const s in n.renderer){const u=i[s];i[s]=(...a)=>{let o=n.renderer[s].apply(i,a);return o===!1&&(o=u.apply(i,a)),o}}r.renderer=i}if(n.tokenizer){const i=Z.defaults.tokenizer||new ls;for(const s in n.tokenizer){const u=i[s];i[s]=(...a)=>{let o=n.tokenizer[s].apply(i,a);return o===!1&&(o=u.apply(i,a)),o}}r.tokenizer=i}if(n.walkTokens){const i=Z.defaults.walkTokens;r.walkTokens=function(s){let u=[];return u.push(n.walkTokens.call(this,s)),i&&(u=u.concat(i.call(this,s))),u}}Z.setOptions(r)})};Z.walkTokens=function(t,e){let n=[];for(const r of t)switch(n=n.concat(e.call(Z,r)),r.type){case"table":{for(const i of r.header)n=n.concat(Z.walkTokens(i.tokens,e));for(const i of r.rows)for(const s of i)n=n.concat(Z.walkTokens(s.tokens,e));break}case"list":{n=n.concat(Z.walkTokens(r.items,e));break}default:Z.defaults.extensions&&Z.defaults.extensions.childTokens&&Z.defaults.extensions.childTokens[r.type]?Z.defaults.extensions.childTokens[r.type].forEach(function(i){n=n.concat(Z.walkTokens(r[i],e))}):r.tokens&&(n=n.concat(Z.walkTokens(r.tokens,e)))}return n};Z.parseInline=function(t,e){if(typeof t>"u"||t===null)throw new Error("marked.parseInline(): input parameter is undefined or null");if(typeof t!="string")throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected");e=mt({},Z.defaults,e||{}),Uo(e);try{const n=St.lexInline(t,e);return e.walkTokens&&Z.walkTokens(n,e.walkTokens),Bt.parseInline(n,e)}catch(n){if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e.silent)return"<p>An error occurred:</p><pre>"+Ne(n.message+"",!0)+"</pre>";throw n}};Z.Parser=Bt;Z.parser=Bt.parse;Z.Renderer=cs;Z.TextRenderer=zo;Z.Lexer=St;Z.lexer=St.lex;Z.Tokenizer=ls;Z.Slugger=hs;Z.parse=Z;Z.options;Z.setOptions;Z.use;Z.walkTokens;Z.parseInline;Bt.parse;St.lex;const Ho={};function ep(t){let e;return{c(){e=j(t[1])},m(n,r){b(n,e,r)},p(n,r){r&2&&ve(e,n[1])},i:$,o:$,d(n){n&&w(e)}}}function tp(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h6"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function np(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h5"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function rp(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h4"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function ip(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h3"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function sp(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h2"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function up(t){let e,n;const r=t[5].default,i=we(r,t,t[4],null);return{c(){e=E("h1"),i&&i.c(),B(e,"id",t[2])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&16)&&ye(i,r,s,s[4],n?be(r,s[4],u,null):Ae(s[4]),null),(!n||u&4)&&B(e,"id",s[2])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function ap(t){let e,n,r,i;const s=[up,sp,ip,rp,np,tp,ep],u=[];function a(o,l){return o[0]===1?0:o[0]===2?1:o[0]===3?2:o[0]===4?3:o[0]===5?4:o[0]===6?5:6}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function op(t,e,n){let r,{$$slots:i={},$$scope:s}=e,{depth:u}=e,{raw:a}=e,{text:o}=e;const{slug:l,getOptions:c}=Yo(Ho),h=c();return t.$$set=f=>{"depth"in f&&n(0,u=f.depth),"raw"in f&&n(1,a=f.raw),"text"in f&&n(3,o=f.text),"$$scope"in f&&n(4,s=f.$$scope)},t.$$.update=()=>{t.$$.dirty&8&&n(2,r=h.headerIds?h.headerPrefix+l(o):void 0)},[u,a,r,o,s,i]}class lp extends ue{constructor(e){super(),se(this,e,op,ap,re,{depth:0,raw:1,text:3})}}function cp(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("p"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function hp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class fp extends ue{constructor(e){super(),se(this,e,hp,cp,re,{})}}function dp(t){let e;const n=t[3].default,r=we(n,t,t[2],null);return{c(){r&&r.c()},m(i,s){r&&r.m(i,s),e=!0},p(i,[s]){r&&r.p&&(!e||s&4)&&ye(r,n,i,i[2],e?be(n,i[2],s,null):Ae(i[2]),null)},i(i){e||(y(r,i),e=!0)},o(i){C(r,i),e=!1},d(i){r&&r.d(i)}}}function pp(t,e,n){let{$$slots:r={},$$scope:i}=e,{text:s}=e,{raw:u}=e;return t.$$set=a=>{"text"in a&&n(0,s=a.text),"raw"in a&&n(1,u=a.raw),"$$scope"in a&&n(2,i=a.$$scope)},[s,u,i,r]}class Dp extends ue{constructor(e){super(),se(this,e,pp,dp,re,{text:0,raw:1})}}function mp(t){let e,n;return{c(){e=E("img"),ft(e.src,n=t[0])||B(e,"src",n),B(e,"title",t[1]),B(e,"alt",t[2])},m(r,i){b(r,e,i)},p(r,[i]){i&1&&!ft(e.src,n=r[0])&&B(e,"src",n),i&2&&B(e,"title",r[1]),i&4&&B(e,"alt",r[2])},i:$,o:$,d(r){r&&w(e)}}}function gp(t,e,n){let{href:r=""}=e,{title:i=void 0}=e,{text:s=""}=e;return t.$$set=u=>{"href"in u&&n(0,r=u.href),"title"in u&&n(1,i=u.title),"text"in u&&n(2,s=u.text)},[r,i,s]}class wp extends ue{constructor(e){super(),se(this,e,gp,mp,re,{href:0,title:1,text:2})}}function bp(t){let e,n;const r=t[3].default,i=we(r,t,t[2],null);return{c(){e=E("a"),i&&i.c(),B(e,"href",t[0]),B(e,"title",t[1])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&4)&&ye(i,r,s,s[2],n?be(r,s[2],u,null):Ae(s[2]),null),(!n||u&1)&&B(e,"href",s[0]),(!n||u&2)&&B(e,"title",s[1])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function yp(t,e,n){let{$$slots:r={},$$scope:i}=e,{href:s=""}=e,{title:u=void 0}=e;return t.$$set=a=>{"href"in a&&n(0,s=a.href),"title"in a&&n(1,u=a.title),"$$scope"in a&&n(2,i=a.$$scope)},[s,u,i,r]}class Ap extends ue{constructor(e){super(),se(this,e,yp,bp,re,{href:0,title:1})}}function _p(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("em"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Cp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class Ep extends ue{constructor(e){super(),se(this,e,Cp,_p,re,{})}}function Fp(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("del"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function kp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class vp extends ue{constructor(e){super(),se(this,e,kp,Fp,re,{})}}function Bp(t){let e,n=t[0].replace(/`/g,"")+"",r;return{c(){e=E("code"),r=j(n)},m(i,s){b(i,e,s),v(e,r)},p(i,[s]){s&1&&n!==(n=i[0].replace(/`/g,"")+"")&&ve(r,n)},i:$,o:$,d(i){i&&w(e)}}}function Sp(t,e,n){let{raw:r}=e;return t.$$set=i=>{"raw"in i&&n(0,r=i.raw)},[r]}class xp extends ue{constructor(e){super(),se(this,e,Sp,Bp,re,{raw:0})}}function Ip(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("strong"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Tp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class $p extends ue{constructor(e){super(),se(this,e,Tp,Ip,re,{})}}function Rp(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("table"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Pp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class Mp extends ue{constructor(e){super(),se(this,e,Pp,Rp,re,{})}}function Op(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("thead"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Np(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class Lp extends ue{constructor(e){super(),se(this,e,Np,Op,re,{})}}function Up(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("tbody"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function zp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class Hp extends ue{constructor(e){super(),se(this,e,zp,Up,re,{})}}function qp(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("tr"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function jp(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class Wp extends ue{constructor(e){super(),se(this,e,jp,qp,re,{})}}function Vp(t){let e,n;const r=t[3].default,i=we(r,t,t[2],null);return{c(){e=E("td"),i&&i.c(),B(e,"align",t[1])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&4)&&ye(i,r,s,s[2],n?be(r,s[2],u,null):Ae(s[2]),null),(!n||u&2)&&B(e,"align",s[1])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Qp(t){let e,n;const r=t[3].default,i=we(r,t,t[2],null);return{c(){e=E("th"),i&&i.c(),B(e,"align",t[1])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&4)&&ye(i,r,s,s[2],n?be(r,s[2],u,null):Ae(s[2]),null),(!n||u&2)&&B(e,"align",s[1])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Kp(t){let e,n,r,i;const s=[Qp,Vp],u=[];function a(o,l){return o[0]?0:1}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function Gp(t,e,n){let{$$slots:r={},$$scope:i}=e,{header:s}=e,{align:u}=e;return t.$$set=a=>{"header"in a&&n(0,s=a.header),"align"in a&&n(1,u=a.align),"$$scope"in a&&n(2,i=a.$$scope)},[s,u,i,r]}class Zp extends ue{constructor(e){super(),se(this,e,Gp,Kp,re,{header:0,align:1})}}function Xp(t){let e,n;const r=t[3].default,i=we(r,t,t[2],null);return{c(){e=E("ul"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&4)&&ye(i,r,s,s[2],n?be(r,s[2],u,null):Ae(s[2]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Yp(t){let e,n;const r=t[3].default,i=we(r,t,t[2],null);return{c(){e=E("ol"),i&&i.c(),B(e,"start",t[1])},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,u){i&&i.p&&(!n||u&4)&&ye(i,r,s,s[2],n?be(r,s[2],u,null):Ae(s[2]),null),(!n||u&2)&&B(e,"start",s[1])},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function Jp(t){let e,n,r,i;const s=[Yp,Xp],u=[];function a(o,l){return o[0]?0:1}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,[l]){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function eD(t,e,n){let{$$slots:r={},$$scope:i}=e,{ordered:s}=e,{start:u}=e;return t.$$set=a=>{"ordered"in a&&n(0,s=a.ordered),"start"in a&&n(1,u=a.start),"$$scope"in a&&n(2,i=a.$$scope)},[s,u,i,r]}class tD extends ue{constructor(e){super(),se(this,e,eD,Jp,re,{ordered:0,start:1})}}function nD(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("li"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function rD(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class iD extends ue{constructor(e){super(),se(this,e,rD,nD,re,{})}}function sD(t){let e;return{c(){e=E("hr")},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}class uD extends ue{constructor(e){super(),se(this,e,null,sD,re,{})}}function aD(t){let e,n;return{c(){e=new Zo(!1),n=ae(),e.a=n},m(r,i){e.m(t[0],r,i),b(r,n,i)},p(r,[i]){i&1&&e.p(r[0])},i:$,o:$,d(r){r&&w(n),r&&e.d()}}}function oD(t,e,n){let{text:r}=e;return t.$$set=i=>{"text"in i&&n(0,r=i.text)},[r]}class lD extends ue{constructor(e){super(),se(this,e,oD,aD,re,{text:0})}}function cD(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("blockquote"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function hD(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class fD extends ue{constructor(e){super(),se(this,e,hD,cD,re,{})}}function dD(t){let e,n,r;return{c(){e=E("pre"),n=E("code"),r=j(t[1]),B(e,"class",t[0])},m(i,s){b(i,e,s),v(e,n),v(n,r)},p(i,[s]){s&2&&ve(r,i[1]),s&1&&B(e,"class",i[0])},i:$,o:$,d(i){i&&w(e)}}}function pD(t,e,n){let{lang:r}=e,{text:i}=e;return t.$$set=s=>{"lang"in s&&n(0,r=s.lang),"text"in s&&n(1,i=s.text)},[r,i]}class DD extends ue{constructor(e){super(),se(this,e,pD,dD,re,{lang:0,text:1})}}function mD(t){let e,n;const r=t[1].default,i=we(r,t,t[0],null);return{c(){e=E("br"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(s,u),n=!0},p(s,[u]){i&&i.p&&(!n||u&1)&&ye(i,r,s,s[0],n?be(r,s[0],u,null):Ae(s[0]),null)},i(s){n||(y(i,s),n=!0)},o(s){C(i,s),n=!1},d(s){s&&w(e),i&&i.d(s)}}}function gD(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$$set=s=>{"$$scope"in s&&n(0,i=s.$$scope)},[i,r]}class wD extends ue{constructor(e){super(),se(this,e,gD,mD,re,{})}}const bD={heading:lp,paragraph:fp,text:Dp,image:wp,link:Ap,em:Ep,strong:$p,codespan:xp,del:vp,table:Mp,tablehead:Lp,tablebody:Hp,tablerow:Wp,tablecell:Zp,list:tD,orderedlistitem:null,unorderedlistitem:null,listitem:iD,hr:uD,html:lD,blockquote:fD,code:DD,br:wD},yD={baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,xhtml:!1};function AD(t){let e,n;return e=new Cn({props:{tokens:t[0],renderers:t[1]}}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},p(r,[i]){const s={};i&1&&(s.tokens=r[0]),i&2&&(s.renderers=r[1]),e.$set(s)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function _D(t,e,n){let r,i,s,u,{source:a=[]}=e,{renderers:o={}}=e,{options:l={}}=e,{isInline:c=!1}=e;const h=zn();let f,d,p;return Xo(Ho,{slug:D=>i?i.slug(D):"",getOptions:()=>s}),yr(()=>{n(7,p=!0)}),t.$$set=D=>{"source"in D&&n(2,a=D.source),"renderers"in D&&n(3,o=D.renderers),"options"in D&&n(4,l=D.options),"isInline"in D&&n(5,c=D.isInline)},t.$$.update=()=>{t.$$.dirty&4&&n(8,r=Array.isArray(a)),t.$$.dirty&4&&(i=a?new hs:void 0),t.$$.dirty&16&&n(9,s={...yD,...l}),t.$$.dirty&869&&(r?n(0,f=a):(n(6,d=new St(s)),n(0,f=c?d.inlineTokens(a):d.lex(a)),h("parsed",{tokens:f}))),t.$$.dirty&8&&n(1,u={...bD,...o}),t.$$.dirty&385&&p&&!r&&h("parsed",{tokens:f})},[f,u,a,o,l,c,d,p,r,s]}class CD extends ue{constructor(e){super(),se(this,e,_D,AD,re,{source:2,renderers:3,options:4,isInline:5})}}function ju(t){let e,n,r,i,s;function u(c,h){return c[3]?ED:FD}let a=u(t),o=a(t),l={ctx:t,current:null,token:null,hasCatch:!1,pending:ND,then:SD,catch:BD,value:15,blocks:[,,,]};return mn(i=t[2],l),{c(){e=E("p"),o.c(),n=U(),r=ae(),l.block.c()},m(c,h){b(c,e,h),o.m(e,null),b(c,n,h),b(c,r,h),l.block.m(c,l.anchor=h),l.mount=()=>r.parentNode,l.anchor=r,s=!0},p(c,h){t=c,a===(a=u(t))&&o?o.p(t,h):(o.d(1),o=a(t),o&&(o.c(),o.m(e,null))),l.ctx=t,h&4&&i!==(i=t[2])&&mn(i,l)||Qr(l,t,h)},i(c){s||(y(l.block),s=!0)},o(c){for(let h=0;h<3;h+=1){const f=l.blocks[h];C(f)}s=!1},d(c){c&&w(e),o.d(),c&&w(n),c&&w(r),l.block.d(c),l.token=null,l=null}}}function ED(t){let e,n,r;function i(a,o){return a[4]?kD:vD}let s=i(t),u=s(t);return{c(){e=E("button"),u.c()},m(a,o){b(a,e,o),u.m(e,null),n||(r=oe(e,"click",t[10]),n=!0)},p(a,o){s!==(s=i(a))&&(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},d(a){a&&w(e),u.d(),n=!1,r()}}}function FD(t){let e,n,r;return{c(){e=E("button"),e.textContent="Get attachment"},m(i,s){b(i,e,s),n||(r=oe(e,"click",function(){wr(t[7](t[0]))&&t[7](t[0]).apply(this,arguments)}),n=!0)},p(i,s){t=i},d(i){i&&w(e),n=!1,r()}}}function kD(t){let e;return{c(){e=j("Show attachment")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function vD(t){let e;return{c(){e=j("Hide attachment")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function BD(t){return{c:$,m:$,p:$,i:$,o:$,d:$}}function SD(t){let e,n,r,i;const s=[ID,xD],u=[];function a(o,l){return o[4]?1:0}return e=a(t),n=u[e]=s[e](t),{c(){n.c(),r=ae()},m(o,l){u[e].m(o,l),b(o,r,l),i=!0},p(o,l){let c=e;e=a(o),e===c?u[e].p(o,l):(ee(),C(u[c],1,1,()=>{u[c]=null}),te(),n=u[e],n?n.p(o,l):(n=u[e]=s[e](o),n.c()),y(n,1),n.m(r.parentNode,r))},i(o){i||(y(n),i=!0)},o(o){C(n),i=!1},d(o){u[e].d(o),o&&w(r)}}}function xD(t){let e,n,r;return{c(){e=E("img"),B(e,"class","dnone svelte-1qahnoq"),ft(e.src,n=t[15])||B(e,"src",n),B(e,"alt",r=t[0].text)},m(i,s){b(i,e,s)},p(i,s){s&4&&!ft(e.src,n=i[15])&&B(e,"src",n),s&1&&r!==(r=i[0].text)&&B(e,"alt",r)},i:$,o:$,d(i){i&&w(e)}}}function ID(t){let e,n,r,i,s;const u=[OD,MD,PD,RD,$D,TD],a=[];function o(c,h){return c[5]=="image"?0:c[5]=="text"?1:c[5]=="audio"?2:c[5]=="markdown"?3:c[5]=="pdf"?4:5}e=o(t),n=a[e]=u[e](t);let l=t[1]!==void 0&&Wu(t);return{c(){n.c(),r=U(),l&&l.c(),i=ae()},m(c,h){a[e].m(c,h),b(c,r,h),l&&l.m(c,h),b(c,i,h),s=!0},p(c,h){let f=e;e=o(c),e===f?a[e].p(c,h):(ee(),C(a[f],1,1,()=>{a[f]=null}),te(),n=a[e],n?n.p(c,h):(n=a[e]=u[e](c),n.c()),y(n,1),n.m(r.parentNode,r)),c[1]!==void 0?l?l.p(c,h):(l=Wu(c),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},i(c){s||(y(n),s=!0)},o(c){C(n),s=!1},d(c){a[e].d(c),c&&w(r),l&&l.d(c),c&&w(i)}}}function TD(t){let e;return{c(){e=E("p"),e.textContent="Attachment type not supported"},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function $D(t){let e;return{c(){e=E("p"),e.textContent="Pdf preview to come"},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function RD(t){let e,n,r;return n=new CD({props:{source:t[15]}}),{c(){e=E("div"),X(n.$$.fragment),B(e,"class","markdown svelte-1qahnoq")},m(i,s){b(i,e,s),W(n,e,null),r=!0},p(i,s){const u={};s&4&&(u.source=i[15]),n.$set(u)},i(i){r||(y(n.$$.fragment,i),r=!0)},o(i){C(n.$$.fragment,i),r=!1},d(i){i&&w(e),V(n)}}}function PD(t){let e,n;return{c(){e=E("audio"),ft(e.src,n=t[15])||B(e,"src",n),e.controls=!0,B(e,"class","svelte-1qahnoq")},m(r,i){b(r,e,i)},p(r,i){i&4&&!ft(e.src,n=r[15])&&B(e,"src",n)},i:$,o:$,d(r){r&&w(e)}}}function MD(t){let e,n=t[15]+"",r;return{c(){e=E("p"),r=j(n)},m(i,s){b(i,e,s),v(e,r)},p(i,s){s&4&&n!==(n=i[15]+"")&&ve(r,n)},i:$,o:$,d(i){i&&w(e)}}}function OD(t){let e,n,r;return{c(){e=E("img"),ft(e.src,n=t[15])||B(e,"src",n),B(e,"alt",r=t[0].text),B(e,"class","svelte-1qahnoq")},m(i,s){b(i,e,s)},p(i,s){s&4&&!ft(e.src,n=i[15])&&B(e,"src",n),s&1&&r!==(r=i[0].text)&&B(e,"alt",r)},i:$,o:$,d(i){i&&w(e)}}}function Wu(t){let e,n,r,i;return{c(){e=E("p"),n=E("button"),n.textContent="Download attachment"},m(s,u){b(s,e,u),v(e,n),r||(i=oe(n,"click",t[11]),r=!0)},p:$,d(s){s&&w(e),r=!1,i()}}}function ND(t){let e;return{c(){e=j("Loading attachment...")},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function LD(t){let e,n=(t[6],"📎"),r,i,s,u,a,o,l=t[6]&&ju(t);return{c(){e=E("button"),r=j(n),i=U(),l&&l.c(),s=ae()},m(c,h){b(c,e,h),v(e,r),b(c,i,h),l&&l.m(c,h),b(c,s,h),u=!0,a||(o=oe(e,"click",t[9]),a=!0)},p(c,[h]){(!u||h&64)&&n!==(n=(c[6],"📎"))&&ve(r,n),c[6]?l?(l.p(c,h),h&64&&y(l,1)):(l=ju(c),l.c(),y(l,1),l.m(s.parentNode,s)):l&&(ee(),C(l,1,1,()=>{l=null}),te())},i(c){u||(y(l),u=!0)},o(c){C(l),u=!1},d(c){c&&w(e),c&&w(i),l&&l.d(c),c&&w(s),a=!1,o()}}}function UD(t,e,n){let r;Ze(t,_n,F=>n(13,r=F));let{doc:i}=e,s,u,a=!1,o=!0,l,c,h=!1;async function f(F){const _=await r.replica.getAttachment(F);let g=F.path.split(".").pop();if(console.log("fileExtension 1st",g),_!==void 0){console.log("fileExtension inside getAttach",g);const x=await _.bytes();console.log("docdata",x);let R=new Uint8Array(x.length);for(var S=0;S<x.length;S++)R[S]=x[S];if(console.log("bytes ",R),console.log("fileExtension 2 ",g),console.log("typeof fileExtension "+typeof g),g==="md")n(5,l="markdown"),n(5,l),n(1,s=String.fromCharCode(...R));else if(g=="mp3"||g=="ogg"||g=="webm")n(5,l="audio"),c="audio/"+g,n(5,l),c=c,console.log("this is audio"),console.log(l,c),n(1,s=URL.createObjectURL(new Blob([R],{type:c})));else if(g==="txt"){n(5,l="text"),n(5,l),console.log(l);var k=new TextDecoder("utf-8");n(1,s=k.decode(Uint8Array.from(R)))}else g=="png"||g=="gif"||g=="jpeg"?(n(5,l="image"),console.log("img fileExtension "+g),console.log("this is an image"),console.log("fileExtension "+g),c="image/"+g,n(5,l),c=c,console.log("mimetype "+c),n(1,s=URL.createObjectURL(new Blob([R],{type:c})))):(n(5,l="other"),n(5,l),console.log(l),n(1,s=URL.createObjectURL(new Blob([R],{type:"application/octet-stream"}))));return s}}function d(F){n(2,u=f(F)),n(3,a=!0),n(4,o=!1)}function p(){let F=document.createElement("a");console.log(s+"attachmentBytes"),s.split(":")[0]!=="blob"&&(console.log("attachmentBytes is a string"),n(1,s=URL.createObjectURL(new Blob([s]))),console.log("attachmentBytes is now a blob")),console.log("type of attachmentBytes ",typeof s);let _=s,g=i.path.split("/")[i.path.split("/").length-1];console.log("type of file",typeof _),F.href=_,F.download=g.slice(1),F.style.display="none",document.body.appendChild(F),F.click()}const D=()=>n(6,h=!h),m=()=>n(4,o=!o),A=()=>p();return t.$$set=F=>{"doc"in F&&n(0,i=F.doc)},[i,s,u,a,o,l,h,d,p,D,m,A]}class zD extends ue{constructor(e){super(),se(this,e,UD,LD,re,{doc:0})}}function Vu(t){let e;function n(s,u){if(!s[1])return qD;if(s[1])return HD}let r=n(t),i=r&&r(t);return{c(){e=E("div"),i&&i.c()},m(s,u){b(s,e,u),i&&i.m(e,null)},p(s,u){r===(r=n(s))&&i?i.p(s,u):(i&&i.d(1),i=r&&r(s),i&&(i.c(),i.m(e,null)))},d(s){s&&w(e),i&&i.d()}}}function HD(t){let e,n=t[0].path.split(".")[t[0].path.split(".").length-1]+"",r,i,s,u,a=t[0].attachmentSize/1e3+"",o,l;return{c(){e=j("Attachment type: "),r=j(n),i=U(),s=E("br"),u=j(`
            Attachment size: `),o=j(a),l=j(" kb")},m(c,h){b(c,e,h),b(c,r,h),b(c,i,h),b(c,s,h),b(c,u,h),b(c,o,h),b(c,l,h)},p(c,h){h&1&&n!==(n=c[0].path.split(".")[c[0].path.split(".").length-1]+"")&&ve(r,n),h&1&&a!==(a=c[0].attachmentSize/1e3+"")&&ve(o,a)},d(c){c&&w(e),c&&w(r),c&&w(i),c&&w(s),c&&w(u),c&&w(o),c&&w(l)}}}function qD(t){let e,n,r,i=t[0].author+"",s,u,a,o,l=t[0].format+"",c,h,f,d,p=t[0].share+"",D,m,A,F,_=t[0].shareSignature+"",g,S,k,x,R=t[0].signature+"",z,L,Q,De,he=t[0].textHash+"",Ue,tn,gt,En,nn=t[0].timestamp/1e3+"",Ye;return{c(){e=E("ul"),n=E("li"),r=j("author: "),s=j(i),u=U(),a=E("li"),o=j("format: "),c=j(l),h=U(),f=E("li"),d=j("share: "),D=j(p),m=U(),A=E("li"),F=j("share signature:"),g=j(_),S=U(),k=E("li"),x=j("doc signature: "),z=j(R),L=U(),Q=E("li"),De=j("textHash:"),Ue=j(he),tn=U(),gt=E("li"),En=j("timestamp: "),Ye=j(nn)},m(Je,et){b(Je,e,et),v(e,n),v(n,r),v(n,s),v(e,u),v(e,a),v(a,o),v(a,c),v(e,h),v(e,f),v(f,d),v(f,D),v(e,m),v(e,A),v(A,F),v(A,g),v(e,S),v(e,k),v(k,x),v(k,z),v(e,L),v(e,Q),v(Q,De),v(Q,Ue),v(e,tn),v(e,gt),v(gt,En),v(gt,Ye)},p(Je,et){et&1&&i!==(i=Je[0].author+"")&&ve(s,i),et&1&&l!==(l=Je[0].format+"")&&ve(c,l),et&1&&p!==(p=Je[0].share+"")&&ve(D,p),et&1&&_!==(_=Je[0].shareSignature+"")&&ve(g,_),et&1&&R!==(R=Je[0].signature+"")&&ve(z,R),et&1&&he!==(he=Je[0].textHash+"")&&ve(Ue,he),et&1&&nn!==(nn=Je[0].timestamp/1e3+"")&&ve(Ye,nn)},d(Je){Je&&w(e)}}}function jD(t){let e,n,r,i,s,u=t[2]&&Vu(t);return{c(){e=E("button"),e.textContent="📄",n=U(),u&&u.c(),r=ae()},m(a,o){b(a,e,o),b(a,n,o),u&&u.m(a,o),b(a,r,o),i||(s=oe(e,"click",t[3]),i=!0)},p(a,[o]){a[2]?u?u.p(a,o):(u=Vu(a),u.c(),u.m(r.parentNode,r)):u&&(u.d(1),u=null)},i:$,o:$,d(a){a&&w(e),a&&w(n),u&&u.d(a),a&&w(r),i=!1,s()}}}function WD(t,e,n){let{doc:r}=e,{attachment:i=!0}=e,s=!1;const u=()=>n(2,s=!s);return t.$$set=a=>{"doc"in a&&n(0,r=a.doc),"attachment"in a&&n(1,i=a.attachment)},[r,i,s,u]}class VD extends ue{constructor(e){super(),se(this,e,WD,jD,re,{doc:0,attachment:1})}}function Qu(t,e,n){const r=t.slice();return r[0]=e[n],r}function QD(t){let e,n=[],r=new Map,i,s=t[1];const u=a=>a[0].textHash;for(let a=0;a<s.length;a+=1){let o=Qu(t,s,a),l=u(o);r.set(l,n[a]=Ku(l,o))}return{c(){e=E("ul");for(let a=0;a<n.length;a+=1)n[a].c();B(e,"class","svelte-vnlowv")},m(a,o){b(a,e,o);for(let l=0;l<n.length;l+=1)n[l].m(e,null);i=!0},p(a,o){o&18&&(s=a[1],ee(),n=Qi(n,o,u,1,a,s,r,e,Vi,Ku,null,Qu),te())},i(a){if(!i){for(let o=0;o<s.length;o+=1)y(n[o]);i=!0}},o(a){for(let o=0;o<n.length;o+=1)C(n[o]);i=!1},d(a){a&&w(e);for(let o=0;o<n.length;o+=1)n[o].d()}}}function KD(t){let e=t[3]()+"",n;return{c(){n=j(e)},m(r,i){b(r,n,i)},p:$,i:$,o:$,d(r){r&&w(n)}}}function Ku(t,e){let n,r,i,s,u;return r=new fs({props:{title:e[0].text,doc:e[0],attachment:!1}}),r.$on("click",e[4]),{key:t,first:null,c(){n=E("li"),X(r.$$.fragment),i=U(),B(n,"id",s=e[0].textHash),B(n,"class","svelte-vnlowv"),this.first=n},m(a,o){b(a,n,o),W(r,n,null),v(n,i),u=!0},p(a,o){e=a;const l={};o&2&&(l.title=e[0].text),o&2&&(l.doc=e[0]),r.$set(l),(!u||o&2&&s!==(s=e[0].textHash))&&B(n,"id",s)},i(a){u||(y(r.$$.fragment,a),u=!0)},o(a){C(r.$$.fragment,a),u=!1},d(a){a&&w(n),V(r)}}}function GD(t){let e,n,r,i,s,u,a,o;const l=[KD,QD],c=[];function h(f,d){return f[1]===void 0?0:f[2]?1:-1}return~(r=h(t))&&(i=c[r]=l[r](t)),{c(){e=E("button"),e.textContent="Replies",n=U(),i&&i.c(),s=ae()},m(f,d){b(f,e,d),b(f,n,d),~r&&c[r].m(f,d),b(f,s,d),u=!0,a||(o=oe(e,"click",t[5]),a=!0)},p(f,[d]){let p=r;r=h(f),r===p?~r&&c[r].p(f,d):(i&&(ee(),C(c[p],1,1,()=>{c[p]=null}),te()),~r?(i=c[r],i?i.p(f,d):(i=c[r]=l[r](f),i.c()),y(i,1),i.m(s.parentNode,s)):i=null)},i(f){u||(y(i),u=!0)},o(f){C(i),u=!1},d(f){f&&w(e),f&&w(n),~r&&c[r].d(f),f&&w(s),a=!1,o()}}}function ZD(t,e,n){let r;Ze(t,os,c=>n(6,r=c));let{doc:i}=e,s=[],u=!0;const a=async()=>{let c=i.path.split("!");n(1,s=await r.cache.queryDocs({filter:{pathStartsWith:c[0]}})),n(1,s=s.filter(h=>h.path.split("/").length>4)),n(2,u=!0)};r.cache.onCacheUpdated(()=>{console.log("oncacheupdated"),console.log("oncacheupdated replies",s),a(),console.log("oncacheupdated after getreplies",s),n(1,s)});function o(){setTimeout(()=>{a()},1e3)}const l=()=>a();return t.$$set=c=>{"doc"in c&&n(0,i=c.doc)},t.$$.update=()=>{t.$$.dirty&2&&n(1,s),t.$$.dirty&2&&s.length>=1&&n(2,u=!0)},[i,s,u,a,o,l]}class XD extends ue{constructor(e){super(),se(this,e,ZD,GD,re,{doc:0})}}function YD(t){let e;return{c(){e=E("span"),e.textContent=`${t[1].kind}`},m(n,r){b(n,e,r)},p:$,d(n){n&&w(e)}}}function JD(t){let e,n,r,i,s,u,a,o,l,c,h,f,d=t[1]&&YD(t);return{c(){e=E("div"),n=E("p"),r=E("input"),i=U(),s=E("p"),u=E("button"),a=j("Send Reply"),l=U(),c=E("p"),d&&d.c(),B(r,"class","svelte-1bvmg1w"),u.disabled=o=Gu(t[0])},m(p,D){b(p,e,D),v(e,n),v(n,r),Pr(r,t[0]),v(e,i),v(e,s),v(s,u),v(u,a),v(e,l),v(e,c),d&&d.m(c,null),h||(f=[oe(r,"input",t[4]),oe(u,"click",t[2])],h=!0)},p(p,[D]){D&1&&r.value!==p[0]&&Pr(r,p[0]),D&1&&o!==(o=Gu(p[0]))&&(u.disabled=o),p[1]&&d.p(p,D)},i:$,o:$,d(p){p&&w(e),d&&d.d(),h=!1,ot(f)}}}function Gu(t){return t=="Reply here"}function e1(t,e,n){let r,i;Ze(t,Dn,f=>n(5,r=f)),Ze(t,_n,f=>n(6,i=f));const s=zn();let u;async function a(){let f=r.address.slice(1,5),d=o.path.split("!"),p=o.path.split("/"),D=Date.now();const m=await i.replica.set(r,{text:f+" replied: "+l,path:d[0]+D+"/!reply-by-"+f,deleteAfter:c}),A=await i.replica.set(r,{text:f+" replied: "+l,path:"/studio/"+p[2]+"/"+D+"/reply-by-"+f});return console.log("result ",m),console.log("studio ",A),s("success"),m}let{doc:o}=e,l="Reply here",c=(Date.now()+36e5)*1e3;function h(){l=this.value,n(0,l)}return t.$$set=f=>{"doc"in f&&n(3,o=f.doc)},[l,u,a,o,h]}class t1 extends ue{constructor(e){super(),se(this,e,e1,JD,re,{doc:3})}}function Zu(t){let e,n,r,i;return e=new XD({props:{doc:t[0]}}),e.$on("success",t[3]),r=new t1({props:{doc:t[0]}}),r.$on("success",t[4]),{c(){X(e.$$.fragment),n=U(),X(r.$$.fragment)},m(s,u){W(e,s,u),b(s,n,u),W(r,s,u),i=!0},p(s,u){const a={};u&1&&(a.doc=s[0]),e.$set(a);const o={};u&1&&(o.doc=s[0]),r.$set(o)},i(s){i||(y(e.$$.fragment,s),y(r.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(r.$$.fragment,s),i=!1},d(s){V(e,s),s&&w(n),V(r,s)}}}function n1(t){let e,n,r,i,s,u,a=t[1]&&Zu(t);return{c(){e=E("div"),n=E("button"),n.textContent="↩️",r=U(),a&&a.c()},m(o,l){b(o,e,l),v(e,n),v(e,r),a&&a.m(e,null),i=!0,s||(u=oe(n,"click",t[2]),s=!0)},p(o,[l]){o[1]?a?(a.p(o,l),l&2&&y(a,1)):(a=Zu(o),a.c(),y(a,1),a.m(e,null)):a&&(ee(),C(a,1,1,()=>{a=null}),te())},i(o){i||(y(a),i=!0)},o(o){C(a),i=!1},d(o){o&&w(e),a&&a.d(),s=!1,u()}}}function r1(t,e,n){let{doc:r}=e,i=!1;function s(){n(1,i=!i)}function u(o){Mr.call(this,t,o)}function a(o){Mr.call(this,t,o)}return t.$$set=o=>{"doc"in o&&n(0,r=o.doc)},[r,i,s,u,a]}class i1 extends ue{constructor(e){super(),se(this,e,r1,n1,re,{doc:0})}}function s1(t){let e,n,r;return{c(){e=E("h3"),n=U(),r=E("h4")},m(i,s){b(i,e,s),e.innerHTML=t[0],b(i,n,s),b(i,r,s),r.innerHTML=t[6]},p(i,s){s&1&&(e.innerHTML=i[0]),s&64&&(r.innerHTML=i[6])},d(i){i&&w(e),i&&w(n),i&&w(r)}}}function u1(t){let e;return{c(){e=E("h3")},m(n,r){b(n,e,r),e.innerHTML=t[0]},p(n,r){r&1&&(e.innerHTML=n[0])},d(n){n&&w(e)}}}function Xu(t){let e,n,r,i,s,u,a,o=t[3]&&Yu(t);i=new VD({props:{doc:t[1],attachment:t[3]}});let l=t[3]&&Ju(t),c=!t[2]&&ea(t);return{c(){e=E("div"),o&&o.c(),n=U(),r=E("div"),X(i.$$.fragment),s=U(),l&&l.c(),u=U(),c&&c.c(),B(e,"class","flex svelte-wqdvf2")},m(h,f){b(h,e,f),o&&o.m(e,null),v(e,n),v(e,r),W(i,r,null),v(e,s),l&&l.m(e,null),v(e,u),c&&c.m(e,null),a=!0},p(h,f){h[3]?o?(o.p(h,f),f&8&&y(o,1)):(o=Yu(h),o.c(),y(o,1),o.m(e,n)):o&&(ee(),C(o,1,1,()=>{o=null}),te());const d={};f&2&&(d.doc=h[1]),f&8&&(d.attachment=h[3]),i.$set(d),h[3]?l?(l.p(h,f),f&8&&y(l,1)):(l=Ju(h),l.c(),y(l,1),l.m(e,u)):l&&(ee(),C(l,1,1,()=>{l=null}),te()),h[2]?c&&(ee(),C(c,1,1,()=>{c=null}),te()):c?(c.p(h,f),f&4&&y(c,1)):(c=ea(h),c.c(),y(c,1),c.m(e,null))},i(h){a||(y(o),y(i.$$.fragment,h),y(l),y(c),a=!0)},o(h){C(o),C(i.$$.fragment,h),C(l),C(c),a=!1},d(h){h&&w(e),o&&o.d(),V(i),l&&l.d(),c&&c.d()}}}function Yu(t){let e,n,r;return n=new zD({props:{doc:t[1]}}),{c(){e=E("div"),X(n.$$.fragment)},m(i,s){b(i,e,s),W(n,e,null),r=!0},p(i,s){const u={};s&2&&(u.doc=i[1]),n.$set(u)},i(i){r||(y(n.$$.fragment,i),r=!0)},o(i){C(n.$$.fragment,i),r=!1},d(i){i&&w(e),V(n)}}}function Ju(t){let e,n,r;return n=new i1({props:{doc:t[1]}}),{c(){e=E("div"),X(n.$$.fragment)},m(i,s){b(i,e,s),W(n,e,null),r=!0},p(i,s){const u={};s&2&&(u.doc=i[1]),n.$set(u)},i(i){r||(y(n.$$.fragment,i),r=!0)},o(i){C(n.$$.fragment,i),r=!1},d(i){i&&w(e),V(n)}}}function ea(t){let e,n,r;return n=new pd({props:{doc:t[1]}}),n.$on("update",t[9]),{c(){e=E("div"),X(n.$$.fragment)},m(i,s){b(i,e,s),W(n,e,null),r=!0},p(i,s){const u={};s&2&&(u.doc=i[1]),n.$set(u)},i(i){r||(y(n.$$.fragment,i),r=!0)},o(i){C(n.$$.fragment,i),r=!1},d(i){i&&w(e),V(n)}}}function a1(t){let e,n,r,i,s,u,a,o;n=new od({props:{style:"margin-bottom:-3px;",email:t[1].text,size:"18",default:"retro"}});function l(d,p){if(d[0])return u1;if(d[5])return s1}let c=l(t),h=c&&c(t),f=t[4]&&Xu(t);return{c(){e=E("button"),X(n.$$.fragment),r=U(),h&&h.c(),i=U(),f&&f.c(),s=ae()},m(d,p){b(d,e,p),W(n,e,null),b(d,r,p),h&&h.m(d,p),b(d,i,p),f&&f.m(d,p),b(d,s,p),u=!0,a||(o=[oe(e,"click",t[7]),oe(e,"keypress",t[8])],a=!0)},p(d,[p]){const D={};p&2&&(D.email=d[1].text),n.$set(D),c===(c=l(d))&&h?h.p(d,p):(h&&h.d(1),h=c&&c(d),h&&(h.c(),h.m(i.parentNode,i))),d[4]?f?(f.p(d,p),p&16&&y(f,1)):(f=Xu(d),f.c(),y(f,1),f.m(s.parentNode,s)):f&&(ee(),C(f,1,1,()=>{f=null}),te())},i(d){u||(y(n.$$.fragment,d),y(f),u=!0)},o(d){C(n.$$.fragment,d),C(f),u=!1},d(d){d&&w(e),V(n),d&&w(r),h&&h.d(d),d&&w(i),f&&f.d(d),d&&w(s),a=!1,ot(o)}}}function o1(t,e,n){let r=!1,{doc:i}=e,{studio:s=!1}=e,{attachment:u=!0}=e,{title:a=void 0}=e,o=!1,l;a!==void 0&&a.includes("<br>")&&(l=a.split("<br>").pop(),a=a,o=!0);const c=()=>n(4,r=!r),h=()=>n(4,r=!r);function f(d){Mr.call(this,t,d)}return t.$$set=d=>{"doc"in d&&n(1,i=d.doc),"studio"in d&&n(2,s=d.studio),"attachment"in d&&n(3,u=d.attachment),"title"in d&&n(0,a=d.title)},t.$$.update=()=>{t.$$.dirty&4&&console.log("studio",s)},[a,i,s,u,r,o,l,c,h,f]}class fs extends ue{constructor(e){super(),se(this,e,o1,a1,re,{doc:1,studio:2,attachment:3,title:0})}}function ta(t,e,n){const r=t.slice();return r[4]=e[n],r}function l1(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:d1,then:f1,catch:h1,value:0,blocks:[,,,]};return mn(n=t[0],i),{c(){e=ae(),i.block.c()},m(s,u){b(s,e,u),i.block.m(s,i.anchor=u),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(s,u){t=s,i.ctx=t,u&1&&n!==(n=t[0])&&mn(n,i)||Qr(i,t,u)},i(s){r||(y(i.block),r=!0)},o(s){for(let u=0;u<3;u+=1){const a=i.blocks[u];C(a)}r=!1},d(s){s&&w(e),i.block.d(s),i.token=null,i=null}}}function c1(t){let e;return{c(){e=E("p"),e.textContent="No files yet"},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function h1(t){return{c:$,m:$,p:$,i:$,o:$,d:$}}function f1(t){let e=[],n=new Map,r,i,s=t[0];const u=a=>a[4].textHash;for(let a=0;a<s.length;a+=1){let o=ta(t,s,a),l=u(o);n.set(l,e[a]=na(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ae()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);b(a,r,o),i=!0},p(a,o){o&3&&(s=a[0],ee(),e=Qi(e,o,u,1,a,s,n,r.parentNode,Vi,na,r,ta),te())},i(a){if(!i){for(let o=0;o<s.length;o+=1)y(e[o]);i=!0}},o(a){for(let o=0;o<e.length;o+=1)C(e[o]);i=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&w(r)}}}function na(t,e){let n,r,i,s,u;return r=new fs({props:{doc:e[4]}}),r.$on("update",e[1]),{key:t,first:null,c(){n=E("div"),X(r.$$.fragment),i=U(),B(n,"id",s=e[4].textHash),B(n,"class","svelte-l1f12u"),this.first=n},m(a,o){b(a,n,o),W(r,n,null),v(n,i),u=!0},p(a,o){e=a;const l={};o&1&&(l.doc=e[4]),r.$set(l),(!u||o&1&&s!==(s=e[4].textHash))&&B(n,"id",s)},i(a){u||(y(r.$$.fragment,a),u=!0)},o(a){C(r.$$.fragment,a),u=!1},d(a){a&&w(n),V(r)}}}function d1(t){let e;return{c(){e=E("p"),e.textContent="Loading..."},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function p1(t){let e,n,r,i,s,u,a;const o=[c1,l1],l=[];function c(h,f){return h[0].length===0?0:1}return s=c(t),u=l[s]=o[s](t),{c(){e=E("div"),n=E("h2"),n.textContent="Commons",r=U(),i=E("div"),u.c(),B(i,"class","flex svelte-l1f12u")},m(h,f){b(h,e,f),v(e,n),v(e,r),v(e,i),l[s].m(i,null),a=!0},p(h,[f]){let d=s;s=c(h),s===d?l[s].p(h,f):(ee(),C(l[d],1,1,()=>{l[d]=null}),te(),u=l[s],u?u.p(h,f):(u=l[s]=o[s](h),u.c()),y(u,1),u.m(i,null))},i(h){a||(y(u),a=!0)},o(h){C(u),a=!1},d(h){h&&w(e),l[s].d()}}}function D1(t,e,n){let r;Ze(t,os,a=>n(2,r=a));let i=[];const s=async()=>{n(0,i=r.cache.queryDocs({filter:{pathStartsWith:"/documents"}})),n(0,i=i.filter(a=>a.path.split("/").length<=4)),console.log("Docs",i)};r.cache.onCacheUpdated(()=>{s()}),yr(()=>{s()});function u(){setTimeout(()=>{s()},1e3)}return t.$$.update=()=>{t.$$.dirty&1&&n(0,i)},[i,u]}class m1 extends ue{constructor(e){super(),se(this,e,D1,p1,re,{})}}function ra(t,e,n){const r=t.slice();return r[4]=e[n],r}function g1(t){let e,n,r,i={ctx:t,current:null,token:null,hasCatch:!1,pending:A1,then:y1,catch:b1,value:0,blocks:[,,,]};return mn(n=t[0],i),{c(){e=ae(),i.block.c()},m(s,u){b(s,e,u),i.block.m(s,i.anchor=u),i.mount=()=>e.parentNode,i.anchor=e,r=!0},p(s,u){t=s,i.ctx=t,u&1&&n!==(n=t[0])&&mn(n,i)||Qr(i,t,u)},i(s){r||(y(i.block),r=!0)},o(s){for(let u=0;u<3;u+=1){const a=i.blocks[u];C(a)}r=!1},d(s){s&&w(e),i.block.d(s),i.token=null,i=null}}}function w1(t){let e;return{c(){e=E("li"),e.textContent="No files yet",B(e,"class","svelte-wd0ees")},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function b1(t){return{c:$,m:$,p:$,i:$,o:$,d:$}}function y1(t){let e=[],n=new Map,r,i,s=t[0];const u=a=>a[4].textHash;for(let a=0;a<s.length;a+=1){let o=ra(t,s,a),l=u(o);n.set(l,e[a]=ia(l,o))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ae()},m(a,o){for(let l=0;l<e.length;l+=1)e[l].m(a,o);b(a,r,o),i=!0},p(a,o){o&3&&(s=a[0],ee(),e=Qi(e,o,u,1,a,s,n,r.parentNode,Vi,ia,r,ra),te())},i(a){if(!i){for(let o=0;o<s.length;o+=1)y(e[o]);i=!0}},o(a){for(let o=0;o<e.length;o+=1)C(e[o]);i=!1},d(a){for(let o=0;o<e.length;o+=1)e[o].d(a);a&&w(r)}}}function ia(t,e){let n,r,i,s,u;return r=new fs({props:{doc:e[4],studio:!0}}),r.$on("update",e[1]),{key:t,first:null,c(){n=E("li"),X(r.$$.fragment),i=U(),B(n,"id",s=e[4].textHash),B(n,"class","svelte-wd0ees"),this.first=n},m(a,o){b(a,n,o),W(r,n,null),v(n,i),u=!0},p(a,o){e=a;const l={};o&1&&(l.doc=e[4]),r.$set(l),(!u||o&1&&s!==(s=e[4].textHash))&&B(n,"id",s)},i(a){u||(y(r.$$.fragment,a),u=!0)},o(a){C(r.$$.fragment,a),u=!1},d(a){a&&w(n),V(r)}}}function A1(t){let e;return{c(){e=E("li"),e.textContent="Loading...",B(e,"class","svelte-wd0ees")},m(n,r){b(n,e,r)},p:$,i:$,o:$,d(n){n&&w(e)}}}function _1(t){let e,n,r,i,s,u,a;const o=[w1,g1],l=[];function c(h,f){return h[0].length===0?0:1}return s=c(t),u=l[s]=o[s](t),{c(){e=E("div"),n=E("h2"),n.textContent="Studio",r=U(),i=E("ul"),u.c(),B(i,"class","svelte-wd0ees")},m(h,f){b(h,e,f),v(e,n),v(e,r),v(e,i),l[s].m(i,null),a=!0},p(h,[f]){let d=s;s=c(h),s===d?l[s].p(h,f):(ee(),C(l[d],1,1,()=>{l[d]=null}),te(),u=l[s],u?u.p(h,f):(u=l[s]=o[s](h),u.c()),y(u,1),u.m(i,null))},i(h){a||(y(u),a=!0)},o(h){C(u),a=!1},d(h){h&&w(e),l[s].d()}}}function C1(t,e,n){let r;Ze(t,os,a=>n(2,r=a));let i=[];const s=async()=>{n(0,i=r.cache.queryDocs({filter:{pathStartsWith:"/studio"}})),n(0,i=i.filter(a=>a.path.split("/").length<=4)),console.log("Docs",i)};r.cache.onCacheUpdated(()=>{s()}),yr(()=>{s()});function u(){setTimeout(()=>{s()},1e3),console.log("UI updated")}return t.$$.update=()=>{t.$$.dirty&1&&n(0,i)},[i,u]}class E1 extends ue{constructor(e){super(),se(this,e,C1,_1,re,{})}}function sa(t){let e,n,r;return{c(){e=E("button"),e.textContent="Generate new Identity"},m(i,s){b(i,e,s),n||(r=oe(e,"click",t[4]),n=!0)},p:$,d(i){i&&w(e),n=!1,r()}}}function F1(t){let e,n,r,i,s,u,a,o,l;const c=[S1,B1,v1],h=[];function f(m,A){return m[2]?m[3]?1:2:0}r=f(t),i=h[r]=c[r](t);function d(m,A){return m[2]?I1:x1}let p=d(t),D=p(t);return{c(){e=E("button"),e.textContent="Show details",n=U(),i.c(),s=U(),u=E("button"),D.c(),B(e,"class","topleft svelte-1nocf6a"),B(u,"class","topright svelte-1nocf6a")},m(m,A){b(m,e,A),b(m,n,A),h[r].m(m,A),b(m,s,A),b(m,u,A),D.m(u,null),a=!0,o||(l=[oe(e,"click",t[6]),oe(u,"click",t[9])],o=!0)},p(m,A){let F=r;r=f(m),r===F?h[r].p(m,A):(ee(),C(h[F],1,1,()=>{h[F]=null}),te(),i=h[r],i?i.p(m,A):(i=h[r]=c[r](m),i.c()),y(i,1),i.m(s.parentNode,s)),p!==(p=d(m))&&(D.d(1),D=p(m),D&&(D.c(),D.m(u,null)))},i(m){a||(y(i),a=!0)},o(m){C(i),a=!1},d(m){m&&w(e),m&&w(n),h[r].d(m),m&&w(s),m&&w(u),D.d(),o=!1,ot(l)}}}function k1(t){let e,n,r;function i(a,o){return a[1]?$1:T1}let s=i(t),u=s(t);return{c(){e=E("button"),u.c(),B(e,"class","topleft svelte-1nocf6a")},m(a,o){b(a,e,o),u.m(e,null),n||(r=oe(e,"click",t[5]),n=!0)},p(a,o){s!==(s=i(a))&&(u.d(1),u=s(a),u&&(u.c(),u.m(e,null)))},i:$,o:$,d(a){a&&w(e),u.d(),n=!1,r()}}}function v1(t){let e,n;return e=new m1({}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},p:$,i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function B1(t){let e,n;return e=new E1({}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},p:$,i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function S1(t){let e,n,r,i,s;return n=new L0({props:{inStudio:t[3]}}),n.$on("success",t[7]),i=new V0({props:{inStudio:t[3]}}),i.$on("upload",t[8]),{c(){e=E("div"),X(n.$$.fragment),r=U(),X(i.$$.fragment),B(e,"class","flex-row svelte-1nocf6a")},m(u,a){b(u,e,a),W(n,e,null),v(e,r),W(i,e,null),s=!0},p:$,i(u){s||(y(n.$$.fragment,u),y(i.$$.fragment,u),s=!0)},o(u){C(n.$$.fragment,u),C(i.$$.fragment,u),s=!1},d(u){u&&w(e),V(n),V(i)}}}function x1(t){let e;return{c(){e=j("Show file")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function I1(t){let e;return{c(){e=j("Upload file")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function T1(t){let e;return{c(){e=j("Hide details")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function $1(t){let e;return{c(){e=j("Show details")},m(n,r){b(n,e,r)},d(n){n&&w(e)}}}function ua(t){let e,n;return e=new R0({}),{c(){X(e.$$.fragment)},m(r,i){W(e,r,i),n=!0},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){V(e,r)}}}function R1(t){let e,n,r,i,s,u,a,o,l=!t[0]&&sa(t);const c=[k1,F1],h=[];function f(p,D){return p[0]&&!p[1]?0:p[0]&&p[1]?1:-1}~(i=f(t))&&(s=h[i]=c[i](t));let d=t[0]&&ua();return{c(){e=E("main"),n=E("div"),l&&l.c(),r=U(),s&&s.c(),u=U(),a=E("div"),d&&d.c(),B(a,"class","svelte-1nocf6a"),Ds(a,"showDetails",t[1]),B(e,"class","svelte-1nocf6a")},m(p,D){b(p,e,D),v(e,n),l&&l.m(n,null),v(n,r),~i&&h[i].m(n,null),v(e,u),v(e,a),d&&d.m(a,null),o=!0},p(p,[D]){p[0]?l&&(l.d(1),l=null):l?l.p(p,D):(l=sa(p),l.c(),l.m(n,r));let m=i;i=f(p),i===m?~i&&h[i].p(p,D):(s&&(ee(),C(h[m],1,1,()=>{h[m]=null}),te()),~i?(s=h[i],s?s.p(p,D):(s=h[i]=c[i](p),s.c()),y(s,1),s.m(n,null)):s=null),p[0]?d?D&1&&y(d,1):(d=ua(),d.c(),y(d,1),d.m(a,null)):d&&(ee(),C(d,1,1,()=>{d=null}),te()),(!o||D&2)&&Ds(a,"showDetails",p[1])},i(p){o||(y(s),y(d),o=!0)},o(p){C(s),C(d),o=!1},d(p){p&&w(e),l&&l.d(),~i&&h[i].d(),d&&d.d()}}}function P1(t,e,n){let r;Ze(t,_n,F=>n(10,r=F));let i=!1,s=!1,u=!0;const a=new Wa;a.addReplica(r.replica);const o=a.sync("https://earthstar-server.fly.dev/sync",!0),l=a.sync("https://languid-sand-parallelogram.glitch.me/",!0);o.onStatusChange(F=>{console.log(F)}),l.onStatusChange(F=>{console.log(F)}),o.isDone().then(()=>{console.log("Sync complete")}).catch(F=>{console.error("Sync failed",F)});const h=new URLSearchParams(window.location.search).has("studio");return[i,s,u,h,()=>n(0,i=!i),()=>n(1,s=!s),()=>n(1,s=!s),()=>n(2,u=!u),()=>n(2,u=!u),()=>n(2,u=!u)]}class M1 extends ue{constructor(e){super(),se(this,e,P1,R1,re,{})}}new M1({target:document.getElementById("app")});
